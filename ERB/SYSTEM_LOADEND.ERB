

;-------------------------------------------------------------------------------------------
;ロードの後に実行される一連の処理
;主にキャラのCSVが前回プレイから新たに増えた時など
;-------------------------------------------------------------------------------------------

@SYSTEM_LOADEND
#DIM 追加キャラ保存, 100
VARSET 追加キャラ保存
LOCAL:1 = 0

;CSVを全部読んでキャラがADDってなければADDる
FOR LOCAL, 1, キャラクタ数上限
	SIF !EXISTCSV(LOCAL)
		CONTINUE
	SIF LOCAL == 999
		CONTINUE
	SIF GETCHARA(LOCAL) >= 0
		CONTINUE
	追加キャラ保存:(LOCAL:1) = CHARANUM
	ADDCHARA LOCAL
	LOCAL:1 += 1
NEXT

FOR LOCAL, 0, LOCAL:1
	LOCAL:2 = 追加キャラ保存:LOCAL
	CALL キャラクター初期化(LOCAL:2)
NEXT

ボタン化用カラーマトリクス:0:0 = 768,256,256,  0,  0
ボタン化用カラーマトリクス:1:0 = 256,768,256,  0,  0
ボタン化用カラーマトリクス:2:0 = 256,256,256,  0,  0
ボタン化用カラーマトリクス:3:0 =   0,  0,  0,256,  0
ボタン化用カラーマトリクス:4:0 =   0,  0,  0,  0,256

;旧セーブとの互換のために入れる処理
IF DT_EXIST("所持耳飾りデータベース") == 0
	CALL 耳飾りデータベースセット
ENDIF
IF DT_EXIST("所持服装データベース") == 0
	CALL 服装データベースセット
ENDIF
CALL 制服登録処理("バニー服")
CALL 制服登録処理("メイド服")
;ここまで互換のための処理

CALL イベント追加チェック
IF TFLAG:100 == 0
	CALL イベント発生条件チェック
ENDIF
