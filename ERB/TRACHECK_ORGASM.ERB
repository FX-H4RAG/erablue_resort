;────────────────────────────────────
;絶頂系の処理など
;────────────────────────────────────
;-------------------------------------------------
;絶頂処理
;-------------------------------------------------
@ORGASM_ADD(ARG)
C = 0
V = 0
A = 0
B = 0
S = 0


;絶頂Ｃ
IF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ >= PALAMLV:4 * 5
	C = 5
	CDOWN:ARG:快Ｃ = (PALAMLV:4 * 5 - 1000)
	NOWEX:ARG:Ｃ絶頂 = 5
	;PRINTFORML 究極絶頂Ｃ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ >= PALAMLV:4 * 4
	C = 4
	CDOWN:ARG:快Ｃ = (PALAMLV:4 * 4 - 1000)
	NOWEX:ARG:Ｃ絶頂 = 4
	;PRINTFORML 最強絶頂Ｃ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ >= PALAMLV:4 * 3
	C = 3
	CDOWN:ARG:快Ｃ = (PALAMLV:4 * 3 - 1000)
	NOWEX:ARG:Ｃ絶頂 = 3
	;PRINTFORML 超強絶頂Ｃ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ >= PALAMLV:4 * 2
	C = 2
	CDOWN:ARG:快Ｃ = (PALAMLV:4 * 2 - 1000)
	NOWEX:ARG:Ｃ絶頂 = 2
	;PRINTFORML 強絶頂Ｃ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ >= PALAMLV:4
	C = 1
	CDOWN:ARG:快Ｃ = (PALAMLV:4 - 1000)
	NOWEX:ARG:Ｃ絶頂 = 1
	;PRINTFORML 絶頂Ｃ\@ARG == PLAYER?(調教者)#\@
ENDIF
;CDOWN:ARG:0で下げても絶頂以上なら
;その値-1になるように調整（10000で絶頂なら9999）
SIF CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ - CDOWN:ARG:快Ｃ >= PALAMLV:4
	CDOWN:ARG:快Ｃ = CUP:ARG:快Ｃ + PALAM:ARG:快Ｃ - PALAMLV:4 + 1

;絶頂Ｖ
IF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ >= PALAMLV:4 * 5
	V = 5
	CDOWN:ARG:快Ｖ = (PALAMLV:4 * 5 - 1000)
	NOWEX:ARG:Ｖ絶頂 = 5
	;PRINTFORML 究極絶頂Ｖ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ >= PALAMLV:4 * 4
	V = 4
	CDOWN:ARG:快Ｖ = (PALAMLV:4 * 4 - 1000)
	NOWEX:ARG:Ｖ絶頂 = 4
	;PRINTFORML 最強絶頂Ｖ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ >= PALAMLV:4 * 3
	V = 3
	CDOWN:ARG:快Ｖ = (PALAMLV:4 * 3 - 1000)
	NOWEX:ARG:Ｖ絶頂 = 3
	;PRINTFORML 超強絶頂Ｖ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ >= PALAMLV:4 * 2
	V = 2
	CDOWN:ARG:快Ｖ = (PALAMLV:4 * 2 - 1000)
	NOWEX:ARG:Ｖ絶頂 = 2
	;PRINTFORML 強絶頂Ｖ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ >= PALAMLV:4
	V = 1
	CDOWN:ARG:快Ｖ = (PALAMLV:4 - 1000)
	NOWEX:ARG:Ｖ絶頂 = 1
	;PRINTFORML 絶頂Ｖ\@ARG == PLAYER?(調教者)#\@
ENDIF
;CDOWN:ARG:1で下げても絶頂以上なら
;その値-1になるように調整（10000で絶頂なら9999）
SIF CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ - CDOWN:ARG:快Ｖ >= PALAMLV:4
	CDOWN:ARG:快Ｖ = CUP:ARG:快Ｖ + PALAM:ARG:快Ｖ - PALAMLV:4 + 1

;絶頂Ａ
IF CUP:ARG:快Ａ + PALAM:ARG:快Ａ >= PALAMLV:4 * 5
	A = 5
	CDOWN:ARG:快Ａ = (PALAMLV:4 * 5 - 1000)
	NOWEX:ARG:Ａ絶頂 = 5
	;PRINTFORML 究極絶頂Ａ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ａ + PALAM:ARG:快Ａ >= PALAMLV:4 * 4
	A = 4
	CDOWN:ARG:快Ａ = (PALAMLV:4 * 4 - 1000)
	NOWEX:ARG:Ａ絶頂 = 4
	;PRINTFORML 最強絶頂Ａ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ａ + PALAM:ARG:快Ａ >= PALAMLV:4 * 3
	A = 3
	CDOWN:ARG:快Ａ = (PALAMLV:4 * 3 - 1000)
	NOWEX:ARG:Ａ絶頂 = 3
	;PRINTFORML 超強絶頂Ａ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ａ + PALAM:ARG:快Ａ >= PALAMLV:4 * 2
	A = 2
	CDOWN:ARG:快Ａ = (PALAMLV:4 * 2 - 1000)
	NOWEX:ARG:Ａ絶頂 = 2
	;PRINTFORML 強絶頂Ａ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ａ + PALAM:ARG:快Ａ >= PALAMLV:4
	A = 1
	CDOWN:ARG:快Ａ = (PALAMLV:4 - 1000)
	NOWEX:ARG:Ａ絶頂 = 1
	;PRINTFORML 絶頂Ａ\@ARG == PLAYER?(調教者)#\@
ENDIF
;CDOWN:ARG:2で下げても絶頂以上なら
;その値-1になるように調整（10000で絶頂なら9999）
SIF CUP:ARG:快Ａ + PALAM:ARG:快Ａ - CDOWN:ARG:快Ａ >= PALAMLV:4
	CDOWN:ARG:快Ａ = CUP:ARG:快Ａ + PALAM:ARG:快Ａ - PALAMLV:4 + 1

;絶頂Ｂ
IF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ >= PALAMLV:4 * 5
	B = 5
	CDOWN:ARG:快Ｂ = (PALAMLV:4 * 5 - 1000)
	NOWEX:ARG:Ｂ絶頂 = 5
	;PRINTFORML 究極絶頂Ｂ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ >= PALAMLV:4 * 4
	B = 4
	CDOWN:ARG:快Ｂ = (PALAMLV:4 * 4 - 1000)
	NOWEX:ARG:Ｂ絶頂 = 4
	;PRINTFORML 最強絶頂Ｂ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ >= PALAMLV:4 * 3
	B = 3
	CDOWN:ARG:快Ｂ = (PALAMLV:4 * 3 - 1000)
	NOWEX:ARG:Ｂ絶頂 = 3
	;PRINTFORML 超強絶頂Ｂ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ >= PALAMLV:4 * 2
	B = 2
	CDOWN:ARG:快Ｂ = (PALAMLV:4 * 2 - 1000)
	NOWEX:ARG:Ｂ絶頂 = 2
	;PRINTFORML 強絶頂Ｂ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ >= PALAMLV:4
	B = 1
	CDOWN:ARG:快Ｂ = (PALAMLV:4 - 1000)
	NOWEX:ARG:Ｂ絶頂 = 1
	;PRINTFORML 絶頂Ｂ\@ARG == PLAYER?(調教者)#\@
ENDIF
;CDOWN:ARG:快Ｂで下げても絶頂以上なら
;その値-1になるように調整（10000で絶頂なら9999）
SIF CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ - CDOWN:ARG:快Ｂ >= PALAMLV:4
	CDOWN:ARG:快Ｂ = CUP:ARG:快Ｂ + PALAM:ARG:快Ｂ - PALAMLV:4 + 1

;絶頂Ｓ
IF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ >= PALAMLV:4 * 5
	S = 5
	CDOWN:ARG:快Ｓ = (PALAMLV:4 * 5 - 1000)
	NOWEX:ARG:Ｓ絶頂 = 5
	;PRINTFORML 究極絶頂Ｓ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ >= PALAMLV:4 * 4
	S = 4
	CDOWN:ARG:快Ｓ = (PALAMLV:4 * 4 - 1000)
	NOWEX:ARG:Ｓ絶頂 = 4
	;PRINTFORML 最強絶頂Ｓ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ >= PALAMLV:4 * 3
	S = 3
	CDOWN:ARG:快Ｓ = (PALAMLV:4 * 3 - 1000)
	NOWEX:ARG:Ｓ絶頂 = 3
	;PRINTFORML 超強絶頂Ｓ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ >= PALAMLV:4 * 2
	S = 2
	CDOWN:ARG:快Ｓ = (PALAMLV:4 * 2 - 1000)
	NOWEX:ARG:Ｓ絶頂 = 2
	;PRINTFORML 強絶頂Ｓ\@ARG == PLAYER?(調教者)#\@
ELSEIF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ >= PALAMLV:4
	S = 1
	CDOWN:ARG:快Ｓ = (PALAMLV:4 - 1000)
	NOWEX:ARG:Ｓ絶頂 = 1
	;PRINTFORML 絶頂Ｓ\@ARG == PLAYER?(調教者)#\@
ENDIF
;CDOWN:ARG:快Ｓで下げても絶頂以上なら
;その値-1になるように調整（10000で絶頂なら9999）
SIF CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ - CDOWN:ARG:快Ｓ >= PALAMLV:4
	CDOWN:ARG:快Ｓ = CUP:ARG:快Ｓ + PALAM:ARG:快Ｓ - PALAMLV:4 + 1

;-------------------------------------------------
;絶頂時の追加処理
;-------------------------------------------------
RCVAR:ARG:絶頂の強度 = C + V + A + B + S
IF ARG == PLAYER
	TFLAG:調教者絶頂強度 = C + V + A + B + S
ENDIF
IF ARG == TARGET
	RCVAR:ARG:絶頂の強度 = C + V + A + B + S
	;快楽刻印の処理
	IF RCVAR:ARG:絶頂の強度 > 3 && MARK:ARG:1 < 3
		RCVAR:ARG:快楽強度 = 3
	;Rが3以上で快楽刻印２に相当
	ELSEIF RCVAR:ARG:絶頂の強度 > 2 && MARK:ARG:1 < 2
		RCVAR:ARG:快楽強度 = 2
	;Rが2以上で快楽刻印１に相当
	ELSEIF RCVAR:ARG:絶頂の強度 > 1 && MARK:ARG:1 < 1
		RCVAR:ARG:快楽強度 = 1
	ELSEIF RCVAR:ARG:絶頂の強度 >= 1
		RCVAR:ARG:快楽強度 = 0
	ENDIF
ENDIF

;オナニーの場合はここを通らないので、通った時点で＝あなたによる絶頂とする
;例外はジータ-ルリアの感覚共有だけなのでそこだけ弾く
IF !CFLAG:ARG:快楽計算フラグ || CFLAG:ARG:うふふ
	SIF 初体験日:ARG:あなたの手で初絶頂 == 0
		初体験日:ARG:あなたの手で初絶頂 = DAY
ENDIF

;同時絶頂による補正
L = 0
SELECTCASE MIN(C, V, A, B, S)
	CASE 5
		L = 5
		C *= 60
		V *= 60
		A *= 60
		B *= 60
		S *= 60
	CASE 4
		L = 5
		C *= 48
		V *= 48
		A *= 48
		B *= 48
		S *= 48
	CASE 3
		L = 5
		C *= 36
		V *= 36
		A *= 36
		B *= 36
		S *= 36
	CASE 2
		L = 5
		C *= 24
		V *= 24
		A *= 24
		B *= 24
		S *= 24
	CASE 1
		L = 5
		C *= 12
		V *= 12
		A *= 12
		B *= 12
		S *= 12
	CASEELSE
		;絶頂状態部位がいくつあるかを検索
		SELECTCASE GROUPMATCH(0, C, V, A, B, S)
			CASE 1
				L = 4
				LOCAL = 8
			CASE 2
				L = 3
				LOCAL = 4
			CASE 3
				L = 2
				LOCAL = 2
			CASE 4
				L = 1
				LOCAL = 1
			ENDSELECT
		C *= LOCAL
		V *= LOCAL
		A *= LOCAL
		B *= LOCAL
		S *= LOCAL
ENDSELECT

IF C
	SOURCE:ARG:露出 += 500 * C
	SOURCE:ARG:屈従 += 200 * C
	CUP:ARG:潤滑 += 1000 * C
ENDIF
IF V
	SOURCE:ARG:欲情 += 800 * V
	SOURCE:ARG:恭順 += 500 * V
	SOURCE:ARG:露出 += 700 * V
	SOURCE:ARG:屈従 += 400 * V
	CUP:ARG:潤滑 += 1500 * V
ENDIF
IF A
	SOURCE:ARG:欲情 += 500 * A
	SOURCE:ARG:恭順 += 700 * A
	SOURCE:ARG:露出 += 900 * A
	SOURCE:ARG:屈従 += 500 * A
	SOURCE:ARG:逸脱 += 200 * A
	CUP:ARG:潤滑 += 1500 * A
ENDIF
IF B
	SOURCE:ARG:露出 += 500 * B
	SOURCE:ARG:屈従 += 200 * B
	CUP:ARG:潤滑 += 800 * B
	SIF TALENT:ARG:性別  == 10
		SOURCE:ARG:逸脱 += 100 * B
ENDIF
IF S
	SOURCE:ARG:露出 += 500 * S
	SOURCE:ARG:屈従 += 200 * S
	SOURCE:ARG:逸脱 += 100 * S
	CUP:ARG:潤滑 += 500 * S
ENDIF

NOWEX:ARG:多重絶頂 = L

;絶頂回数を増やす
EX:ARG:Ｃ絶頂 += NOWEX:ARG:Ｃ絶頂
EX:ARG:Ｖ絶頂 += NOWEX:ARG:Ｖ絶頂
EX:ARG:Ａ絶頂 += NOWEX:ARG:Ａ絶頂
EX:ARG:Ｂ絶頂 += NOWEX:ARG:Ｂ絶頂
EX:ARG:Ｓ絶頂 += NOWEX:ARG:Ｓ絶頂
EX:ARG:多重絶頂 += L

;絶頂経験を増やす
EXP:ARG:絶頂経験 += RCVAR:ARG:絶頂の強度
EXP:ARG:Ｃ絶頂経験 += NOWEX:ARG:Ｃ絶頂
EXP:ARG:Ｖ絶頂経験 += NOWEX:ARG:Ｖ絶頂
EXP:ARG:Ａ絶頂経験 += NOWEX:ARG:Ａ絶頂
EXP:ARG:Ｂ絶頂経験 += NOWEX:ARG:Ｂ絶頂
EXP:ARG:Ｓ絶頂経験 += NOWEX:ARG:Ｓ絶頂
SIF RCVAR:ARG:露出コマンドフラグ
	EXP:ARG:露出絶頂経験 += RCVAR:ARG:絶頂の強度
SIF RCVAR:ARG:苦痛コマンドフラグ
	EXP:ARG:苦痛絶頂経験 += RCVAR:ARG:絶頂の強度
SIF RCVAR:ARG:嗜虐コマンドフラグ
	EXP:ARG:嗜虐絶頂経験 += RCVAR:ARG:絶頂の強度
SIF RCVAR:ARG:奉仕コマンドフラグ
	EXP:ARG:奉仕絶頂経験 += RCVAR:ARG:絶頂の強度
SIF RCVAR:ARG:道具コマンドフラグ
	EXP:ARG:道具絶頂経験 += RCVAR:ARG:絶頂の強度
SIF RCVAR:ARG:触手コマンドフラグ
	EXP:ARG:触手絶頂経験 += RCVAR:ARG:絶頂の強度

;性知識経験値を増やす
性知識経験値:ARG:0 += RCVAR:ARG:絶頂の強度

;絶頂による欲望ＬＶアップ
IF ARG == TARGET && ARG
	;自制心があると１下がる
	SIF TALENT:ARG:自制心
		L -= 1
	IF ABL:ARG:欲望 < L
		ABL:ARG:欲望 = L
		PRINT そして欲望がLV
		PRINTV L
		PRINTL になった
	ENDIF
ENDIF

;-------------------------------------------------
;絶頂時の追加処理
;-------------------------------------------------

;射精
IF TALENT:ARG:性別 & 2 && ARG == PLAYER
	NOWEX:ARG:射精 = TFLAG:調教者絶頂強度
ELSEIF TALENT:ARG:性別 & 2
	NOWEX:ARG:射精 = RCVAR:ARG:絶頂の強度
	SIF NOWEX:ARG:射精
		CALL EVENT_SHOOT(ARG)
ENDIF

;ZPの取得
IF RCVAR:ARG:絶頂の強度 > 0
	CALL 絶頂体力減少処理(ARG, NOWEX:ARG:Ｃ絶頂, NOWEX:ARG:Ｖ絶頂, NOWEX:ARG:Ａ絶頂, NOWEX:ARG:Ｂ絶頂, NOWEX:ARG:Ｓ絶頂)
	CALL ZP_取得処理(ARG, RCVAR:ARG:絶頂の強度)
	CFLAG:ARG:体力成長値 += RCVAR:ARG:絶頂の強度
ENDIF

RETURN 1


@MESSAGE_PALAMCNG_絶頂強度表示
IF NOWEX:8 > 3
	IF !GETBIT(CFLAG:3,2)
		EXP:異常経験 ++
		SETBIT CFLAG:3,2
	ENDIF
	DRAWLINE
	PRINTL 昇　天
	DRAWLINE
ELSEIF NOWEX:8 > 2
	DRAWLINE
	PRINTL 超強絶頂
	DRAWLINE
ELSEIF NOWEX:8 > 1
	DRAWLINE
	PRINTL 強絶頂
	DRAWLINE
ELSEIF NOWEX:8 >= 1
	DRAWLINE
	PRINTL 絶頂
	DRAWLINE
ENDIF

;絶頂による欲望ＬＶアップ
LOCAL = NOWEX:8
;自制心があると１下がる
SIF TALENT:自制心
	LOCAL -= 1

IF ABL:欲望 < LOCAL
	ABL:欲望 ++
	PRINTFORML そして欲望がLV{LOCAL}になった
ENDIF
PRINTL 
;-------------------------------------------------
;調教対象の噴乳チェック
;-------------------------------------------------
@TARGET_MILK_CHECK(ARG)
SIF !TALENT:ARG:母乳体質
	RETURN 0

LOCAL = CUP:ARG:快Ｃ / 5 + CUP:ARG:快Ｖ / 5 + CUP:ARG:快Ａ / 5 + CUP:ARG:快Ｂ * 3

;自制心
SIF TALENT:ARG:自制心
	LOCAL /= 2

;快感に素直
SIF TALENT:ARG:快感応答 > 0
	TIMES LOCAL , 1.20

;快感の否定
SIF TALENT:ARG:快感応答 < 0 && !TALENT:ARG:淫乱
	TIMES LOCAL , 0.80

;B敏感
SIF TALENT:ARG:Ｂ感度 > 0
	TIMES LOCAL , 1.20

;媚薬
SIF TEQUIP:ARG:媚薬
	LOCAL *= 2

;利尿剤
SIF TEQUIP:ARG:利尿剤
	LOCAL /= 2

;調教者が幼児退行
SIF TALENT:PLAYER:幼児／幼児退行
	TIMES LOCAL , 1.20

;調教者が幼稚
SIF TALENT:PLAYER:幼稚
	TIMES LOCAL , 1.20

;貧乳
SIF TALENT:ARG:バストサイズ < 0
	TIMES LOCAL , 0.50
LOCAL = TIME_PROGRESS(TFLAG:行動前時刻) * 2 + LOCAL / 2
BASE:ARG:母乳 += LOCAL
SIF !CFLAG:ARG:うふふ
	BASE:ARG:母乳 = MIN(BASE:ARG:母乳, MAXBASE:ARG:母乳 - 1)

IF  BASE:ARG:母乳 > MAXBASE:ARG:母乳 * 2
	LOCAL = 1
ELSEIF BASE:ARG:母乳 > MAXBASE:ARG:母乳
	LOCAL = 0
ELSE
	RETURN 0
ENDIF
LOCAL ++
IF EXP:ARG:噴乳経験 < EXPLV:1
	SOURCE:ARG:露出 += 5000 * LOCAL
	SOURCE:ARG:屈従 += 2500 * LOCAL
	SOURCE:ARG:不潔 += 1000 * LOCAL
ELSEIF EXP:ARG:噴乳経験 < EXPLV:2
	SOURCE:ARG:露出 += 2500 * LOCAL
	SOURCE:ARG:屈従 += 1500 * LOCAL
	SOURCE:ARG:不潔 += 750 * LOCAL
ELSEIF EXP:ARG:噴乳経験 < EXPLV:3
	SOURCE:ARG:露出 += 1500 * LOCAL
	SOURCE:ARG:屈従 += 750 * LOCAL
	SOURCE:ARG:不潔 += 500 * LOCAL
ELSEIF EXP:ARG:噴乳経験 < EXPLV:4
	SOURCE:ARG:露出 += 750 * LOCAL
	SOURCE:ARG:屈従 += 400 * LOCAL
	SOURCE:ARG:不潔 += 350 * LOCAL
ELSEIF EXP:ARG:噴乳経験 < EXPLV:5
	SOURCE:ARG:露出 += 500 * LOCAL
	SOURCE:ARG:屈従 += 250 * LOCAL
	SOURCE:ARG:不潔 += 200 * LOCAL
ELSE
	SOURCE:ARG:露出 += 250 * LOCAL
	SOURCE:ARG:屈従 += 150 * LOCAL
ENDIF
	PRINTFORML %CALLNAME:ARG%は乳首から\@ LOCAL == 2 ? 大量の # \@母乳を噴出した
IF EXP:ARG:噴乳経験 == 0
	EXP:ARG:異常経験 ++
ENDIF
EXP:ARG:噴乳経験 += LOCAL
;Ｂに母乳汚れ
SIF BASE:ARG:母乳 >= MAXBASE:ARG:母乳
	BASE:ARG:母乳 = MAXBASE:ARG:母乳 - 1
NOWEX:ARG:10 += LOCAL
EX:ARG:10 += LOCAL

;ビデオ
IF TEQUIP:ARG:ビデオ撮影
	IF NOWEX:ARG:10 == 1
		LOCALS = MILK/
	ELSEIF NOWEX:ARG:10 == 2
		LOCALS = MILK/MILK/
	ENDIF
	TSTR:1 += LOCALS
ENDIF


@絶頂体力減少処理(キャラ番号, Ｃ絶頂強度, Ｖ絶頂強度, Ａ絶頂強度, Ｂ絶頂強度, Ｓ絶頂強度)
#DIM キャラ番号
#DIM Ｃ絶頂強度
#DIM Ｖ絶頂強度
#DIM Ａ絶頂強度
#DIM Ｂ絶頂強度
#DIM Ｓ絶頂強度
#DIM 絶頂保存配列, 5
#DIM 部位番号
#DIM 体力減少量計算値

絶頂保存配列:0 = Ｃ絶頂強度
絶頂保存配列:1 = Ｖ絶頂強度
絶頂保存配列:2 = Ａ絶頂強度
絶頂保存配列:3 = Ｂ絶頂強度
絶頂保存配列:4 = Ｓ絶頂強度

FOR 部位番号, 0, 5
	IF 絶頂保存配列:部位番号 > 0
		;基礎200を素質や経験などで増減させる
		体力減少量計算値 = 200

		;各絶頂経験の分減らす（最大50）
		体力減少量計算値 -= MIN(50, EXP:キャラ番号:(部位番号 + 5))

		;素質による上下
		体力減少量計算値 -= TALENT:キャラ番号:性欲 * 5
		体力減少量計算値 -= TALENT:キャラ番号:快感応答 * 5

		;発情期
		SIF CFLAG:キャラ番号:発情期フラグ < 0
			体力減少量計算値 -= 20

		IF 絶頂保存配列:部位番号 > 1
			;強い絶頂の分は1/4して計算
			体力減少量計算値 = 体力減少量計算値 + (体力減少量計算値 * (絶頂保存配列:部位番号 - 1) / 4)
		ENDIF

		;最後に配列に計算値を保存
		絶頂保存配列:部位番号 = 体力減少量計算値
	ENDIF
NEXT

IF MATCH(絶頂保存配列, 0) < 4
	;他部位絶頂パターン
	;最も大きい絶頂をそのままにし、他の絶頂計算値を1/2にして合算する
	VARSET LOCAL
	FOR 部位番号, 0, 5
		IF 絶頂保存配列:部位番号 > LOCAL
			LOCAL = 絶頂保存配列:部位番号
			LOCAL:1 = 部位番号
		ENDIF
	NEXT
	FOR 部位番号, 0, 5
		SIF LOCAL:1 != 部位番号
			絶頂保存配列:部位番号 = 絶頂保存配列:部位番号 / 2
	NEXT
ENDIF
体力減少量計算値 = SUMARRAY(絶頂保存配列)

DOWNBASE:キャラ番号:体力 += 体力減少量計算値
CALL SOURCE_DOWNBASE(キャラ番号)
TCVAR:キャラ番号:うふふ中消費体力累積 += 体力減少量計算値
