;TRAINの骨格

@TRAIN_MAIN_LOOP
FLAG:一日終了 = 0

IF TFLAG:オートコマンドフラグ
ELSE
	CALL 画像描画終了
	CALL SHOW_STATUS
	CALL SHOW_USERCOM
	RESULT = -1
	RESULTS = 
	SIF NEXTCOM == -1
		INPUTANY
	
	SIF RESULTS != ""
		RSTR:SELECTCOM_S受け渡し = %RESULTS%
	CALL USERCOM
	
	;コマンドが呼ばれていない、実行不能
	IF RESULT
		CALL R系列フラグリセット
		RESTART
	ENDIF
ENDIF

CALL SOURCE_CHECK
;コマンド中に戻る場合-1が帰ってくるのでリスタート
IF RESULT == -1
	CALL R系列フラグリセット
	RESTART
ENDIF
CALL EVENTCOMEND0
;TRAIN終了フラグ
IF FLAG:一日終了
	RETURN 0
ELSE
	RESTART
ENDIF


@TRAIN_MAIN
;変数初期化
CALL TRAIN_VAR_RESET
;TRAIN開始前処理
CALL EVENTTRAIN0

;メインループ
CALL TRAIN_MAIN_LOOP

;TRAIN終了処理
CALL EVENTEND0

;これが終わるとABLUPに移行し、EVENTTURNENDに続く

@TRAIN_VAR_RESET
#LOCALSIZE 1
VARSET PREVCOM, 0
VARSET コマンド履歴, -2
VARSET 派生コマンド履歴, 
VARSET NEXTCOM, -1
VARSET SELECTCOM, 0
VARSET TFLAG, 0
VARSET TSTR, ""
VARSET UP, 0
VARSET DOWN, 0
FOR LOCAL, 0, CHARANUM
	SIF CFLAG:LOCAL:滞在期間 < 0
		CONTINUE
	VARSET GOTJUEL:LOCAL:0, 0
	VARSET PALAM:LOCAL:0, 0
	VARSET TEQUIP:LOCAL:0, 0
	VARSET EX:LOCAL:0, 0
	VARSET SOURCE:LOCAL:0, 0
	VARSET TCVAR:LOCAL:0, 0


	VARSET CUP:LOCAL:0, 0
	VARSET CDOWN:LOCAL:0, 0
	VARSET DOWNBASE:LOCAL:0, 0
	VARSET TCVAR:LOCAL:0, 0
NEXT
