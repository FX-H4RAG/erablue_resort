
@COMNAME414
#FUNCTIONS
TSTR:コマンド名受渡 = 写真を撮る

;===================================================
;コマンドタイプ
;===================================================
@COMTYPE_414
#FUNCTION
TFLAG:コマンドタイプ受渡 = COMTYPE("単独可能_うふふ")

@COM_TOOLTIP_414
LOCALS = <br>■写真を撮る<br>
LOCALS += "景切鏡を使って、景色を紙に写し取るコマンド。<br>実行した時の状況によって様々な写真が撮れる。"
LOCALS += "<br>COMタイプ：単独可能orうふふ<br>取得ソース：なし"
LOCALS += "<br>固有の取得経験：なし<br>"
TSTR:ツールチップ受渡 = %LOCALS%


;-------------------------------------------------
;休憩
;-------------------------------------------------
@COM414
#DIM 覗き許可フラグ

;覗ける状態かどうかを見る
CALL COM_ABLE404
覗き許可フラグ = RESULT
IF CFLAG:TARGET:睡眠
	CALL その他写真文字列算出
	RFLAG:コマンド結果受渡し変数３ = 1
ELSEIF CFLAG:PLAYER:うふふ && CFLAG:TARGET:うふふ
	;カテゴリ１
	;ハメ撮り
	CALL ハメ撮り系写真文字列算出
	RFLAG:コマンド結果受渡し変数３ = 2
ELSEIF 覗き許可フラグ
	;カテゴリ２
	;盗撮
	CALL 盗撮系写真文字列算出
	RFLAG:コマンド結果受渡し変数３ = 3
ELSEIF 現在仕事:TARGET:0 > 0 && CFLAG:TARGET:同行 < 1 && TIME < 1170
	;カテゴリ３
	;仕事中
	CALL 仕事中写真文字列算出
	RFLAG:コマンド結果受渡し変数３ = 4
ELSE
	;カテゴリ４
	;その他
	CALL その他写真文字列算出
	RFLAG:コマンド結果受渡し変数３ = 5
ENDIF
;ハーヴィンオナホ時禁止
SIF MODE_確認_ターゲット側("ハーヴィンオナホ系", TARGET) > -1
	RETURN 0

TIME += 1
RETURN 1
;-------------------------------------------------
;実行判定
;-------------------------------------------------
@COM_ABLE414
;作成中のため封印
;RETURN 0

;移動実行判定
SIF !TFLAG:ゲームフェイズ管理
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(414)
	RETURN RESULT
;カメラ持ってる？
SIF 景切鏡取得フラグ == 0
	RETURN 0
;覗きが出来ず、TARGETもいないなら不可
CALL COM_ABLE404
SIF RESULT == 0 && TARGET == 0
	RETURN 0
SIF MODE_確認_ターゲット側("ハーヴィンオナホ系", TARGET) > -1
	RETURN 0
RETURN 1

;-------------------------------------------------
;実行時メッセージ
;-------------------------------------------------
@MESSAGE_COM414
;複雑な分岐結果を一箇所で管理出来るよう、メッセージを文字列で管理する
HTML_PRINT RSTR:コマンド結果受渡し文字列

;口上用のパラメータは追加してある最新の写真データベース行から持ってくる



@ハメ撮り系写真文字列算出
#DIMS 写真タイトル一時記録
#DIMS 撮影日時一時記録
#DIMS ランダム文字列
#DIMS 体位モード一時保存
#DIM 前ターン絶頂の強度
#DIM 配列番号
;パターンの優先度は絶頂後＞好感度分岐
;それにプラスしてハメ撮り（V・A）＞コスプレや全裸で分岐

写真タイトル一時記録 = 
;実行時メッセージを同時に入れ込む
RSTR:コマンド結果受渡し文字列 = %CALLNAME:PLAYER%は景切鏡で

;ハメた場所登録
IF CFLAG:PLAYER:隠密
	写真タイトル一時記録 += "物陰でこっそりと、"
ELSEIF BEDROOM(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
	写真タイトル一時記録 += "ベッドの上、"
ELSE
	写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:MASTER:現在位置)%で、"
ENDIF

IF TCVAR:TARGET:前ターン絶頂
	;絶頂時はオートコマンド発生しないので、これで絶頂直後が撮れるはず
	;一番強度の強い部位で文字列を決定、同じ場合はV>A>C>B>Sの優先度
	前ターン絶頂の強度 = MAX(TCVAR:TARGET:前ターンＶ絶頂, TCVAR:TARGET:前ターンＡ絶頂, TCVAR:TARGET:前ターンＣ絶頂, TCVAR:TARGET:前ターンＢ絶頂, TCVAR:TARGET:前ターンＳ絶頂)
	IF TCVAR:LOCAL:連続絶頂記録 > 1
		写真タイトル一時記録 += "幾度も連続で"
	ELSEIF TCVAR:TARGET:前ターンＶ絶頂 == 前ターン絶頂の強度
		SIF TALENT:TARGET:Ｖ感度 > 0
			写真タイトル一時記録 += "敏感な"
		写真タイトル一時記録 += "膣で"
	ELSEIF TCVAR:TARGET:前ターンＡ絶頂 == 前ターン絶頂の強度
		SIF TALENT:TARGET:Ａ感度 > 0
			写真タイトル一時記録 += "敏感な"
		写真タイトル一時記録 += "アナルで"
	ELSEIF TCVAR:TARGET:前ターンＣ絶頂 == 前ターン絶頂の強度
		SIF TALENT:TARGET:Ｃ感度 > 0
			写真タイトル一時記録 += "敏感な"
		SIF フレーバー素質:TARGET:クリ大きさ == 3
			写真タイトル一時記録 +="大きめの"
		SIF フレーバー素質:TARGET:クリ大きさ == 4
			写真タイトル一時記録 +="小さな陰茎のような"
		写真タイトル一時記録 += "クリトリスで"
	ELSEIF TCVAR:TARGET:前ターンＢ絶頂 == 前ターン絶頂の強度
		SIF TALENT:TARGET:Ｂ感度 > 0
			写真タイトル一時記録 += "敏感な"
		SIF TALENT:TARGET:バストサイズ > 1
			写真タイトル一時記録 += "大きな"
		SIF TALENT:TARGET:バストサイズ < 0
			写真タイトル一時記録 += "小さな"
		写真タイトル一時記録 += "乳で"
	ELSEIF TCVAR:TARGET:前ターンＳ絶頂 == 前ターン絶頂の強度
		SIF TALENT:TARGET:Ｓ感度 > 0
			写真タイトル一時記録 += "敏感な"
		写真タイトル一時記録 += "体に触れられ"
	ENDIF
	写真タイトル一時記録 += @"絶頂する%CALLNAME:TARGET%"
	履歴用実績:TARGET:絶頂ハメ撮り回数 += 1
	CALL 履歴登録チェック(TARGET, "被写体_ハメ撮り_絶頂時")
ELSE
	;絶頂後でないなら服装とモードを判定する
	IF CSTR:TARGET:着せ替え服 != ""
		IF CSTR:TARGET:着せ替え服 == "全裸"
			写真タイトル一時記録 += "全裸で"
		ELSE
			IF CSTR:TARGET:着せ替え服 == "浴衣"
				写真タイトル一時記録 += "ユカタヴィラ"
			ELSE
				写真タイトル一時記録 += @"%CSTR:TARGET:着せ替え服%"
			ENDIF
			IF CSTR:TARGET:着せ替え服追加名 != ""
				写真タイトル一時記録 += @"（%CSTR:TARGET:着せ替え服追加名%）を着て"
			ELSE
				写真タイトル一時記録 += "を着て"
			ENDIF
		ENDIF
	ELSE
		写真タイトル一時記録 += "普段着のまま"
	ENDIF
	体位モード一時保存 = 
	詳細文文字列受け渡し変数 = 
	FOR 配列番号, 0, DT_ROW_LENGTH("体位モードデータベース")
		IF DT_CELL_GET("体位モードデータベース", 配列番号, "実行キャラ") == TARGET
			体位モード一時保存 = %DT_CELL_GETS("体位モードデータベース", 配列番号, "モード名")%
			TRYCALLFORM MODETYPE_%体位モード一時保存%(-1, "写真用文字列_プレイヤー", DT_CELL_GET("体位モードデータベース", 配列番号, "実行キャラ"), DT_CELL_GET("体位モードデータベース", 配列番号, "対象キャラ"))
			BREAK
		ELSEIF DT_CELL_GET("体位モードデータベース", 配列番号, "対象キャラ") == TARGET
			体位モード一時保存 = %DT_CELL_GETS("体位モードデータベース", 配列番号, "モード名")%
			TRYCALLFORM MODETYPE_%体位モード一時保存%(-1, "写真用文字列_ターゲット", DT_CELL_GET("体位モードデータベース", 配列番号, "実行キャラ"), DT_CELL_GET("体位モードデータベース", 配列番号, "対象キャラ"))
			BREAK
		ENDIF
	NEXT
	IF 体位モード一時保存 != ""
		IF 詳細文文字列受け渡し変数 != ""
			写真タイトル一時記録 += @"%詳細文文字列受け渡し変数%"
		ELSE
			写真タイトル一時記録 += @"%体位モード一時保存%をする"
		ENDIF
	ELSE
		STRDATA ランダム文字列
			DATA 頬を赤く染めた
			DATA 潤んだ瞳で見つめる
			DATA どこか期待するような顔をする
			DATA 少し恥ずかしそうに顔を伏せた
			DATA 手で目元を隠す
			DATA なんとなくピースをする
		ENDDATA
		写真タイトル一時記録 += @"%ランダム文字列%"
	ENDIF
	写真タイトル一時記録 += @"%CALLNAME:TARGET%"
ENDIF

RSTR:コマンド結果受渡し文字列 += @"『%写真タイトル一時記録%』の写真を撮った。"
;データベース登録
撮影日時一時記録 = %TOSTR(DAY, "00000")%%TOSTR(TIME, "0000")%
DT_ROW_ADD "写真データベース", "写真タイトル", 写真タイトル一時記録, "撮影日時", 撮影日時一時記録, "撮影マップ種別", CFLAG:TARGET:現在マップ種別, "撮影場所", CFLAG:TARGET:現在位置, "撮影場所名前", GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置), "撮影対象NAME", NAME:TARGET, "撮影対象NO", NO:TARGET, "撮影シチュカテゴリ", 1

履歴用実績:TARGET:被写体回数 += 1
CALL 履歴登録チェック(TARGET, "被写体")
履歴用実績:TARGET:ハメ撮り回数 += 1
CALL 履歴登録チェック(TARGET, "被写体_ハメ撮り")

@盗撮系写真文字列算出
#DIMS 写真タイトル一時記録
#DIMS 撮影日時一時記録
#DIMS ランダム文字列
#DIM 前ターン絶頂の強度

写真タイトル一時記録 = 
;実行時メッセージを同時に入れ込む
RSTR:コマンド結果受渡し文字列 = %CALLNAME:PLAYER%は

IF GETBIT(覗き_ABLE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), 1) && GETBIT(覗き_ABLE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), 3)
	DRAWLINE
	PRINTFORM %CALLNAME:PLAYER%は反対側
	PRINTL を盗撮しようとしたが、誰かが隠れている気配も感じた…
	PRINTBUTTONLC "[1]反対側を覗く", 1
	PRINTBUTTONLC "[3]物陰を覗く", 3
	PRINTL
	$INPUT_LOOP
	INPUT
	IF RESULT == 1 || RESULT == 3
		RFLAG:コマンド結果受渡し変数 = RESULT
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ELSE
	FOR LOCAL, 1, 5
		IF GETBIT(覗き_ABLE(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置), LOCAL)
			RFLAG:コマンド結果受渡し変数 = LOCAL
			BREAK
		ENDIF
	NEXT
ENDIF

;RFLAG:コマンド結果受渡し変数２に覗き対象が入ってくる
CALL 覗き候補選定

SELECTCASE CFLAG:PLAYER:現在マップ種別
	CASE 0
		SELECTCASE RFLAG:コマンド結果受渡し変数
			CASE 1
				;反対側を覗く
				RSTR:コマンド結果受渡し文字列 += "反対側を景切鏡で盗撮した<br>"
				IF RFLAG:コマンド結果受渡し変数２
					SELECTCASE CFLAG:PLAYER:現在位置
						CASE 7, 8
							写真タイトル一時記録 += "服を脱いでいる途中の"
						CASE 9, 11
							STRDATA ランダム文字列
								DATA 裸で湯船に浸かっている
								DATA 石鹸で体を洗っている
							ENDDATA
							写真タイトル一時記録 += @"%ランダム文字列%"
						CASE 13, 14
							写真タイトル一時記録 += "水着に着替えている途中の"
					ENDSELECT
				ELSE
					RSTR:コマンド結果受渡し文字列 += "しかし、向こう側には誰もいないようだ…"
					RETURN 0
				ENDIF
				写真タイトル一時記録 += @"%CALLNAME:(RFLAG:コマンド結果受渡し変数２)%"
				;履歴用に回数登録
				IF GROUPMATCH(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置, 7, 8, 13, 14)
					;着替え覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):着替え覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_着替え")
				ELSE
					;入浴覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):風呂覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_入浴")
				ENDIF
			CASE 2
				;隠れて覗く
				RSTR:コマンド結果受渡し文字列 += @"物陰に隠れながら、景切鏡でこっそり盗撮した…<br>"
				SELECTCASE CFLAG:PLAYER:現在位置
					CASE 7, 8
						写真タイトル一時記録 += "服を脱いでいる途中の"
					CASE 9, 11
						STRDATA ランダム文字列
							DATA 裸で湯船に浸かっている
							DATA 石鹸で体を洗っている
						ENDDATA
						写真タイトル一時記録 += @"%ランダム文字列%"
					CASE 13, 14
						写真タイトル一時記録 += "水着に着替えている途中の"
				ENDSELECT
				写真タイトル一時記録 += @"%CALLNAME:(RFLAG:コマンド結果受渡し変数２)%"
				IF GROUPMATCH(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置, 7, 8, 13, 14)
					;着替え覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):着替え覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_着替え")
				ELSE
					;入浴覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):風呂覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_入浴")
				ENDIF
			CASE 3
				;物陰で野外オナニーを見つける
				RFLAG:コマンド結果受渡し変数４ = TCVAR:(RFLAG:コマンド結果受渡し変数２):野外オナニー_部位
				RSTR:コマンド結果受渡し文字列 += @"こっそりと物陰を景切鏡で盗撮した…<br>"
				IF TCVAR:(RFLAG:コマンド結果受渡し変数２):野外オナニー_絶頂
					;絶頂シーン
					写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在マップ種別, CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置)%の物陰で自身の%PART_DESCRIPTION(RFLAG:コマンド結果受渡し変数２, TCVAR:(RFLAG:コマンド結果受渡し変数２):野外オナニー_部位)%を弄り、絶頂する%CALLNAME:(RFLAG:コマンド結果受渡し変数２)%"
				ELSE
					;オナニーシーン
					写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在マップ種別, CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置)%の物陰で自身の%PART_DESCRIPTION(RFLAG:コマンド結果受渡し変数２, TCVAR:(RFLAG:コマンド結果受渡し変数２):野外オナニー_部位)%を弄る%CALLNAME:(RFLAG:コマンド結果受渡し変数２)%"
				ENDIF
				;履歴用に回数登録
				履歴用実績:(RFLAG:コマンド結果受渡し変数２):野外オナニー覗かれ回数 += 1
				CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_野外オナニー")
			CASE 4
				;覗き専用場所から覗く
				RSTR:コマンド結果受渡し文字列 += @"壁の仕掛けを通じて%GETPLACENAME(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在マップ種別, CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置)%を盗撮した…<br>"
				IF RFLAG:コマンド結果受渡し変数２
					SELECTCASE CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置
						CASE 702, 802
							写真タイトル一時記録 += "服を脱いでいる途中の"
						CASE 703, 803
							写真タイトル一時記録 += "石鹸で体を洗っている"
						CASE 704, 804
							写真タイトル一時記録 += "裸で湯船に浸かっている"
						CASE 705, 805
							写真タイトル一時記録 += "裸で変わり湯に浸かっている"
						CASE 706, 806
							写真タイトル一時記録 += "サウナで汗を流している"
						CASE 707, 807
							写真タイトル一時記録 += "裸で露天風呂に浸かっている"
						CASE 708, 808
							写真タイトル一時記録 += "裸で壺湯に浸かっている"
					ENDSELECT
				ELSE
					RSTR:コマンド結果受渡し文字列 += "しかし、向こう側には誰もいないようだ…"
					RETURN 0
				ENDIF
				写真タイトル一時記録 += @"%CALLNAME:(RFLAG:コマンド結果受渡し変数２)%"
				IF GROUPMATCH(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置, 702, 802)
					;着替え覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):着替え覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_着替え")
				ELSE
					;入浴覗きパターン
					履歴用実績:(RFLAG:コマンド結果受渡し変数２):風呂覗かれ回数 += 1
					CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "覗かれ_入浴")
				ENDIF
		ENDSELECT
ENDSELECT

RSTR:コマンド結果受渡し文字列 += @"写真を確認すると、『%写真タイトル一時記録%』の写真が撮れていた。"
;データベース登録
撮影日時一時記録 = %TOSTR(DAY, "00000")%%TOSTR(TIME, "0000")%
DT_ROW_ADD "写真データベース", "写真タイトル", 写真タイトル一時記録, "撮影日時", 撮影日時一時記録, "撮影マップ種別", CFLAG:(RFLAG:コマンド結果受渡し変数２):現在マップ種別, "撮影場所", CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置, "撮影場所名前", GETPLACENAME(CFLAG:(RFLAG:コマンド結果受渡し変数２):現在マップ種別, CFLAG:(RFLAG:コマンド結果受渡し変数２):現在位置), "撮影対象NAME", NAME:(RFLAG:コマンド結果受渡し変数２), "撮影対象NO", NO:(RFLAG:コマンド結果受渡し変数２), "撮影シチュカテゴリ", 2

履歴用実績:(RFLAG:コマンド結果受渡し変数２):被写体回数 += 1
CALL 履歴登録チェック(RFLAG:コマンド結果受渡し変数２, "被写体")

@仕事中写真文字列算出
#DIMS 写真タイトル一時記録
#DIMS 撮影日時一時記録
#DIMS ランダム文字列
#DIM 前ターン絶頂の強度

写真タイトル一時記録 = 
;実行時メッセージを同時に入れ込む
RSTR:コマンド結果受渡し文字列 = %CALLNAME:PLAYER%は景切鏡で

;仕事内容
IF 現在仕事:TARGET:0 == 2
	;ちゃんと仕事場にいるかで分岐
	IF GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置) == GETPLACENAME(現在仕事:TARGET:1 / 10000, 現在仕事:TARGET:1 % 10000)
		写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置)%で%MAP_GET("常駐業務名", GETPLACENAME(現在仕事:TARGET:1 / 10000, 現在仕事:TARGET:1 % 10000))%の仕事をしている"
	ELSE
		写真タイトル一時記録 += @"%MAP_GET("常駐業務名", GETPLACENAME(現在仕事:TARGET:1 / 10000, 現在仕事:TARGET:1 % 10000))%の仕事に向かうところの、"
	ENDIF
ELSEIF 現在仕事:TARGET:0 == 5
	;ちゃんと仕事場にいるかで分岐
	IF CFLAG:TARGET:現在マップ種別 == 0 && CFLAG:TARGET:現在位置 == 308
		写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置)%で訓練をしている"
	ELSE
		写真タイトル一時記録 += @"訓練場に向かうところの、"
	ENDIF
ELSE
	写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置)%で%現在仕事数字文字列変換(現在仕事:TARGET:0, 0, TARGET)%の仕事をしている"
ENDIF
;服装
IF CSTR:TARGET:着せ替え服 != ""
	IF CSTR:TARGET:着せ替え服 == "全裸"
		写真タイトル一時記録 += "全裸の"
	ELSE
		IF CSTR:TARGET:着せ替え服 == "浴衣"
			写真タイトル一時記録 += "ユカタヴィラ姿の"
		ELSE
			写真タイトル一時記録 += @"%CSTR:TARGET:着せ替え服%"
			IF CSTR:TARGET:着せ替え服追加名 != ""
				写真タイトル一時記録 += @"（%CSTR:TARGET:着せ替え服追加名%）を着た"
			ELSE
				写真タイトル一時記録 += "を着た"
			ENDIF
		ENDIF
	ENDIF
ELSEIF CSTR:TARGET:服名称 == "全裸"
	;普段から全裸だと服装は入れない
ELSE
	写真タイトル一時記録 += "普段着の"
ENDIF
写真タイトル一時記録 += @"%CALLNAME:TARGET%"


RSTR:コマンド結果受渡し文字列 += @"『%写真タイトル一時記録%』の写真を撮った。"
;データベース登録
撮影日時一時記録 = %TOSTR(DAY, "00000")%%TOSTR(TIME, "0000")%
DT_ROW_ADD "写真データベース", "写真タイトル", 写真タイトル一時記録, "撮影日時", 撮影日時一時記録, "撮影マップ種別", CFLAG:TARGET:現在マップ種別, "撮影場所", CFLAG:TARGET:現在位置, "撮影場所名前", GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置), "撮影対象NAME", NAME:TARGET, "撮影対象NO", NO:TARGET, "撮影シチュカテゴリ", 3

履歴用実績:TARGET:被写体回数 += 1
CALL 履歴登録チェック(TARGET, "被写体")


@その他写真文字列算出
#DIMS 写真タイトル一時記録
#DIMS 撮影日時一時記録
#DIMS ランダム文字列
#DIMS 服装一時記録
#DIM 前ターン絶頂の強度

写真タイトル一時記録 = 
;実行時メッセージを同時に入れ込む
RSTR:コマンド結果受渡し文字列 = %CALLNAME:PLAYER%は景切鏡で

;服装を先に取得
服装一時記録 = 
IF CSTR:TARGET:着せ替え服 != ""
	IF CSTR:TARGET:着せ替え服 == "全裸"
		服装一時記録 += "全裸の"
	ELSE
		IF CSTR:TARGET:着せ替え服 == "浴衣"
			服装一時記録 += "ユカタヴィラ姿の"
		ELSE
			服装一時記録 += @"%CSTR:TARGET:着せ替え服%"
		ENDIF
		IF CSTR:TARGET:着せ替え服追加名 != ""
			服装一時記録 += @"（%CSTR:TARGET:着せ替え服追加名%）を着た"
		ELSE
			服装一時記録 += "を着た"
		ENDIF
	ENDIF
ELSE
	服装一時記録 += "普段着の"
ENDIF

IF CFLAG:TARGET:睡眠
	写真タイトル一時記録 += @"すやすやと眠る%服装一時記録%%CALLNAME:TARGET%"
ELSE
	SELECTCASE RAND:3
		CASE 0
			写真タイトル一時記録 += @"%服装一時記録%%CALLNAME:TARGET%と%CALLNAME:PLAYER%のツーショット"
		CASE 1
			IF ENJOYROOM(CFLAG:PLAYER:現在マップ種別, CFLAG:PLAYER:現在位置)
				写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置)%で"
				SIF GET_TARGETNUM() > 1
					写真タイトル一時記録 += "みんなと"
				写真タイトル一時記録 += "遊ぶ"
				写真タイトル一時記録 += @"%服装一時記録%%CALLNAME:TARGET%"
			ELSE
				写真タイトル一時記録 += @"%GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置)%"
				IF GET_TARGETNUM() > 1
					写真タイトル一時記録 += "で他の人と話している"
				ELSE
					写真タイトル一時記録 += "にいる"
				ENDIF
				写真タイトル一時記録 += @"%服装一時記録%%CALLNAME:TARGET%"
			ENDIF
		CASE 2
				写真タイトル一時記録 += "こっちに気づいて"
				IF TALENT:TARGET:羞恥心 > 0
					STRDATA ランダム文字列
						DATA 小さくピースをする
						DATA 少し恥ずかしそうにはにかむ
						DATA 思わず隠れてしまった
					ENDDATA
				ELSEIF TALENT:TARGET:目立ちたがり > 0
					STRDATA ランダム文字列
						DATA びしっとポーズを取る
						DATA キメ顔で目線を送る
						DATA 近づいてきて、ドアップになった
					ENDDATA
				ELSE
					STRDATA ランダム文字列
						DATA ピースをする
						DATA こちらに手を振る
						DATA 笑顔を浮かべた
					ENDDATA
				ENDIF
				写真タイトル一時記録 += @"%ランダム文字列%%服装一時記録%%CALLNAME:TARGET%"
	ENDSELECT
ENDIF

RSTR:コマンド結果受渡し文字列 += @"『%写真タイトル一時記録%』の写真を撮った。"
;データベース登録
撮影日時一時記録 = %TOSTR(DAY, "00000")%%TOSTR(TIME, "0000")%
DT_ROW_ADD "写真データベース", "写真タイトル", 写真タイトル一時記録, "撮影日時", 撮影日時一時記録, "撮影マップ種別", CFLAG:TARGET:現在マップ種別, "撮影場所", CFLAG:TARGET:現在位置, "撮影場所名前", GETPLACENAME(CFLAG:TARGET:現在マップ種別, CFLAG:TARGET:現在位置), "撮影対象NAME", NAME:TARGET, "撮影対象NO", NO:TARGET, "撮影シチュカテゴリ", 4

履歴用実績:TARGET:被写体回数 += 1
CALL 履歴登録チェック(TARGET, "被写体")

@所持写真一覧表示
#DIM ページ数
#DIM 表示数カウント
#DIM ボタン記録
#DIM DAY算出
#DIM TIME算出
#DIM 一括削除モード
#DIM 一括削除件数
#DIMS 削除番号
#DIMS 削除番号配列, 101

DRAWLINE
PRINTL 所持している写真の一覧です
IF 一括削除モード
	PRINTL 選択した写真を一括削除出来ます（１００件まで）
ELSE
	PRINTL 選択すると詳細の表示・削除が可能です
ENDIF
DRAWLINE

FOR 表示数カウント, ページ数 * 15, ページ数 * 15 + 15
	IF DT_ROW_LENGTH("写真データベース") > 表示数カウント
		SIF 一括削除モード && STRCOUNT(削除番号, @"_{表示数カウント}_")
			SETCOLOR カラーパレット("黄")
		PRINTBUTTON @"[{表示数カウント, 3}] - 『%DT_CELL_GETS("写真データベース", 表示数カウント, "写真タイトル")%』", 表示数カウント
		RESETCOLOR
		PRINTL
	ELSE
		PRINTL
	ENDIF
NEXT

DRAWLINE
IF ページ数 > 0
	PRINTBUTTONLC "[1000] 前のページ", 1000
ELSE
	PRINTC  
ENDIF
PRINTBUTTONLC "[999] 戻る", 999
IF 一括削除モード && 削除番号 != ""
	PRINTBUTTONLC "[998] 削除する", 998
ELSEIF 一括削除モード
	SETCOLOR カラーパレット("グレーアウト")
	PRINTPLAIN [998] 削除する
	PRINT            
	RESETCOLOR
ELSE
	PRINTBUTTONLC "[998] 一括削除", 998
ENDIF
IF DT_ROW_LENGTH("写真データベース") > ページ数 * 15 + 15
	PRINTBUTTONLC "[1001] 次のページ", 1001
ENDIF

BINPUT
ボタン記録 = RESULT
SELECTCASE ボタン記録
	CASE 999
		IF 一括削除モード
			一括削除件数 = 0
			一括削除モード = 0
			削除番号 = 
			RESTART
		ENDIF
		RETURN 0
	CASE 998
		;一括削除へ
		IF 一括削除モード
			VARSET 削除番号配列
			SPLIT 削除番号, "_", 削除番号配列
			FOR 表示数カウント, 1, 一括削除件数 + 1
				DT_ROW_REMOVE "写真データベース", DT_CELL_GET("写真データベース", TOINT(削除番号配列:表示数カウント), "id")
			NEXT
			PRINTFORMW {一括削除件数}枚の写真を削除しました
			一括削除モード = 0
			一括削除件数 = 0
			削除番号 = 
		ELSE
			一括削除モード = 1
			一括削除件数 = 0
			削除番号 = 
		ENDIF
		RESTART
	CASE 1000
		ページ数 -= 1
		RESTART
	CASE 1001
		ページ数 += 1
		RESTART
	CASEELSE
		IF 一括削除モード
			SIF 一括削除件数 > 99
				RESTART
			IF STRCOUNT(削除番号, @"_{表示数カウント}_") == 0
				IF 削除番号 != ""
					削除番号 += @"{ボタン記録}_"
				ELSE
					削除番号 += @"_{ボタン記録}_"
				ENDIF
				一括削除件数 += 1
			ELSE
				VARSET 削除番号配列
				SPLIT 削除番号, @"_{ボタン記録}_", 削除番号配列
				削除番号 = %削除番号配列:0%_%削除番号配列:1%
				一括削除件数 -= 1
			ENDIF
		ELSE
			;写真詳細表示
			$写真表示
			DRAWLINE
			PRINTL
			PRINTFORML ■%DT_CELL_GETS("写真データベース", ボタン記録, "写真タイトル")%
			PRINTL
			DAY算出 = TOINT(DT_CELL_GETS("写真データベース", ボタン記録, "撮影日時")) / 10000
			TIME算出 = TOINT(DT_CELL_GETS("写真データベース", ボタン記録, "撮影日時")) % 10000
			PRINTFORML 　　撮影日時：{DAY算出 / 120 + 1}年目　%月登録:((DAY算出 / 30) % 4)%　{DAY算出 % 30 + 1}日(%曜日登録:(DAY算出 % 7)%)　{TIME算出 / 60}時{TIME算出 % 60}分
			PRINTFORML 　　撮影場所：%DT_CELL_GETS("写真データベース", ボタン記録, "撮影場所名前")%
			PRINTFORML 　　撮影対象：%DT_CELL_GETS("写真データベース", ボタン記録, "撮影対象NAME")%
			PRINTL
			
			PRINTBUTTONLC "[999] 戻る", 999
			PRINTBUTTONLC "[1000] この写真を削除する", 1000
			BINPUT
			IF RESULT == 1000
				DRAWLINE
				PRINTFORML 『%DT_CELL_GETS("写真データベース", ボタン記録, "写真タイトル")%』を削除してよろしいですか？
				PRINTBUTTONLC "[0] はい", 0
				PRINTBUTTONLC "[1] いいえ", 1
				BINPUT
				IF RESULT == 0
					PRINTFORMW 『%DT_CELL_GETS("写真データベース", ボタン記録, "写真タイトル")%』を削除しました。
					DT_ROW_REMOVE "写真データベース", DT_CELL_GET("写真データベース", ボタン記録, "id")
				ELSE
					GOTO 写真表示
				ENDIF
			ENDIF
		ENDIF
		RESTART
ENDSELECT
