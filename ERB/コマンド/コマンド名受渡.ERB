
@TRAIN_COMNAME(ARG)
#FUNCTIONS

SIF ARG < 0
	RETURNF

TSTR:コマンド名受渡 = 
TRYCALLFORMF COMNAME{ARG}

RETURNF TSTR:コマンド名受渡


@TRAIN_COMNAME_S(ARGS)
;派生コマンド用
#FUNCTIONS

SIF ARGS == ""
	RETURNF

TSTR:コマンド名受渡 = 
TRYCALLFORMF COMNAME_S%ARGS%

RETURNF TSTR:コマンド名受渡
;-------------------------------------------------
;ボツコマンドも一応残す
; ;-------------------------------------------------
; @COMNAME100
; #FUNCTIONS
; TSTR:コマンド名受渡 = スパンキング

; @COMNAME101
; #FUNCTIONS
; TSTR:コマンド名受渡 = 鞭

; @COMNAME102
; #FUNCTIONS
; TSTR:コマンド名受渡 = 蝋燭

; @COMNAME103
; #FUNCTIONS
; TSTR:コマンド名受渡 = 針

; @COMNAME122
; #FUNCTIONS
; TSTR:コマンド名受渡 = 助手を犯させる

; @COMNAME183
; #FUNCTIONS
; TSTR:コマンド名受渡 = ビデオカメラ

; @COMNAME185
; #FUNCTIONS
; TSTR:コマンド名受渡 = 助手を犯す


;-------------------------------------------------
;-------------------------------------------------

;複数モード時の分岐番号を返す。
;ダミー変数に値があればそれに従い、
;なければFLAG:モード管理を参照する。
;
;1:通常 2:同時 3:助手
@COMMODE()
#FUNCTION
;助手オートモードは通常モードと同じ表記
SELECTCASE FLAG:モード管理
CASE 0 TO 1
	LOCAL = 1
CASE 2
	LOCAL = 2
CASE 3
	LOCAL = 3
ENDSELECT

;複数モード_ダミーを参照して数値があれば上書き
;1:通常 2:同時 3:助手


IF 複数モード_ダミー
	IF GROUPMATCH(複数モード_ダミー, 1, 2, 3)
		LOCAL = 複数モード_ダミー
	ELSE
		複数モード_ダミー = 0
	ENDIF
ENDIF

RETURNF LOCAL

@同時モード設定()
#DIM 同室番号
#DIM 選択キャラカウント
#DIM 選択キャラ一時保存
;同室者から、同時コマンドのターゲットを指定する
;まず候補を並べる

選択キャラカウント = 0
DRAWLINE
FOR 同室番号, 1, CHARANUM
	SIF TARGET:同室番号 < 1
		BREAK
	SIF CFLAG:(TARGET:同室番号):うふふ == 0
		CONTINUE
	;うふふ同室者は全部並べる
	IF GETBIT(選択キャラ一時保存, 同室番号)
		SETCOLOR カラーパレット("えっちな色")
		選択キャラカウント += 1
	ENDIF
	PRINTBUTTON @"[{同室番号}] %NAME:(TARGET:同室番号)%", 同室番号
	RESETCOLOR
	PRINTL
NEXT
PRINTL
IF 選択キャラカウント < 2
	SETCOLOR カラーパレット("グレーアウト")
	PRINTPLAIN [998] これで決定
	RESETCOLOR
ELSE
	PRINTBUTTON "[998] これで決定", 998
ENDIF
PRINTL
PRINTBUTTON "[999] 戻る", 999
PRINTL
DRAWLINE

BINPUT
SELECTCASE RESULT
	CASE 999
		選択キャラ一時保存 = 0
		RETURN 0
	CASE 998
		VARSET 同時モード_選択キャラ, -1
		同時モード_選択数 = 選択キャラカウント
		選択キャラカウント = 0
		FOR 同室番号, 1, CHARANUM
			SIF TARGET:同室番号 < 1
				BREAK
			IF GETBIT(選択キャラ一時保存, 同室番号)
				同時モード_選択キャラ:選択キャラカウント = TARGET:同室番号
				選択キャラカウント += 1
			ENDIF
		NEXT
		TFLAG:TARGET変更用 = 同時モード_選択キャラ:0
		選択キャラ一時保存 = 0
		RETURN 1
	CASEELSE
		INVERTBIT 選択キャラ一時保存, RESULT
		RESTART
ENDSELECT
