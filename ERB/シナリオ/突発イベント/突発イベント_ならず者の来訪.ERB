
@イベント発生条件_突発イベント_ならず者の来訪
;開放条件を満たしたら1を返すこと

イベント消滅日数渡し = 3
イベント消滅確率渡し = 30
イベント再発生日数渡し = 20
イベント再発生確率渡し = 10

;開放条件を満たしたら1を返すこと
IF 空艇港初来訪イベントフラグ
	RETURN 1
ENDIF
RETURN 0

@イベント関数_突発イベント_ならず者の来訪(ARG)
#DIM 最大レベル

LOCAL = DT_CELL_GET("各イベント用変数配列", ARG, "イベント再発生CT")
IF LOCAL == 0
	;初回
	DRAWLINE
	PRINTL ［ならず者の来訪］
	DRAWLINE
	PRINTW
	PRINTFORMW どうやら山中の小さな開けた場所にならず者たちの船が降りてきたらしい。
	PRINTFORMW 放置すれば泥棒や資源の乱獲をして逃げるだろう。
	PRINTFORMW そうなればリゾートの人気が落ちてしまうのは火を見るより明らかなのは確かだ。
	PRINTFORMW 被害が出る前に倒してしまおう。
	PRINTL
	PRINTL 山中に降りてきたならず者たちと戦います。準備はよろしいですか？
	PRINTBUTTON "[0]はい", 0
	PRINTL
	PRINTBUTTON "[1]いいえ", 1
	PRINTL
	BINPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORMW %CALLNAME:PLAYER%たちは山中に降りてきたならず者たちを襲撃した！（２連戦あります！）

			敵BATTLE_STATE_STR:1:エネミー名 = Lv10_ならず者の構成員
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_ならず者の構成員
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_ならず者の構成員
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				敵BATTLE_STATE_STR:1:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:2:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:3:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:4:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:7:エネミー名 = Lv15_ならず者の頭領
				CALL 雑魚敵遭遇汎用処理
				IF RESULT == 0
					;勝利
					PRINTFORMW %CALLNAME:PLAYER%たちは無事にならず者たちを掃討した。
					IF RAND:100 < 5
						;5%だけ起こる処理
						PRINTFORMW 残された船の残骸からそこそこの品があったが、ならず者には価値が分からなかったようで無造作に置かれていた。
						STRDATA LOCALS
							DATA 古ぼけた指輪・銀
							DATA 白銀の古紋
							DATA 古ぼけた耳飾り・銀
							DATA 宝晶原石
						ENDDATA
						CALL 素材入手処理(LOCALS, 1)
						PRINTFORMW 「%LOCALS%」を手に入れた。
					ELSE
						LOCAL = RAND(0, 10)
						IF LOCAL == 0
							LOCAL = RAND(2500, 7501)
							MONEY += LOCAL
							PRINTFORMW 残された船の残骸から{LOCAL}ルピが出てきたので押収した。
						ELSEIF LOCAL == 1
							PRINTFORMW 残された船の残骸はもぬけの殻だった。
						ELSEIF LOCAL == 2
							LOCALS = %ランダム素材名("ダンジョン素材", 0)%
							CALL 素材入手処理(LOCALS, 1)
							PRINTFORMW 残された船の残骸から「%LOCALS%」があったので押収した。
						ELSEIF LOCAL == 3
							LOCALS = %ランダム素材名("食物素材", 1)%
							CALL 素材入手処理(LOCALS, 1)
							PRINTFORMW 残された船の残骸から手つかずの 「%LOCALS%」が残されていたので押収した。
						ELSEIF LOCAL == 4
							LOCAL = RAND(1000, 5001)
							MONEY += LOCAL
							PRINTFORMW 残された船はもぬけの殻だったが、その残骸から{LOCAL}ルピになるパーツが出てきたので売却した。
						ELSE
							LOCAL = RAND(500, 2501)
							MONEY += LOCAL
							PRINTFORMW 残された船の残骸から{LOCAL}ルピが出てきたので押収した。
						ENDIF
					ENDIF
					CALL イベント完了フラグ汎用処理("ならず者の来訪")
				ELSEIF RESULT == 1
					;全滅
					PRINTW 不覚を取ってしまった。ここは一旦撤退しよう。
				ELSEIF RESULT == -1
					;逃走
					PRINTW 思ったよりも手強いようだ。ここは一旦撤退しよう。
				ENDIF
			ELSEIF RESULT == 1
				;全滅
				PRINTW 不覚を取ってしまった。ここは一旦撤退しよう。
			ELSEIF RESULT == -1
				;逃走
				PRINTW 思ったよりも手強いようだ。ここは一旦撤退しよう。
			ENDIF
			CALL ダンジョン終了時処理
		CASE 1
			PRINTW いや、油断は良くない。ここはしっかりと準備をしてからにしよう。
	ENDSELECT
ELSE
	;二回目以降
	DRAWLINE
	PRINTL ［ならず者の来訪］
	DRAWLINE
	PRINTW
	PRINTFORMW またならず者たちの船が降りてきたらしい。
	PRINTFORMW 被害が出る前にさっさと倒してしまおう。
	PRINTL
	PRINTL 山中に降りてきたならず者たちと戦います。準備はよろしいですか？
	PRINTBUTTON "[0]はい", 0
	PRINTL
	PRINTBUTTON "[1]いいえ", 1
	PRINTL
	BINPUT
	SELECTCASE RESULT
		CASE 0
			PRINTFORMW %CALLNAME:PLAYER%たちは山中に降りてきたならず者たちを襲撃した！（２連戦あります！）

			敵BATTLE_STATE_STR:1:エネミー名 = Lv10_ならず者の構成員
			敵BATTLE_STATE_STR:2:エネミー名 = Lv10_ならず者の構成員
			敵BATTLE_STATE_STR:4:エネミー名 = Lv10_ならず者の構成員
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				敵BATTLE_STATE_STR:1:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:2:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:3:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:4:エネミー名 = Lv10_ならず者の構成員
				敵BATTLE_STATE_STR:7:エネミー名 = Lv15_ならず者の頭領
				CALL 雑魚敵遭遇汎用処理
				IF RESULT == 0
					;勝利
					PRINTFORMW %CALLNAME:PLAYER%たちは無事にならず者たちを掃討した。
					IF RAND:100 < 5
						;5%だけ起こる処理
						PRINTFORMW 残された船の残骸からそこそこの品があったが、ならず者には価値が分からなかったようで無造作に置かれていた。
						STRDATA LOCALS
							DATA 古ぼけた指輪・銀
							DATA 白銀の古紋
							DATA 古ぼけた耳飾り・銀
							DATA 宝晶原石
						ENDDATA
						CALL 素材入手処理(LOCALS, 1)
						PRINTFORMW 「%LOCALS%」を手に入れた。
					ELSE
						LOCAL = RAND(0, 10)
						IF LOCAL == 0
							LOCAL = RAND(2500, 7501)
							MONEY += LOCAL
							PRINTFORMW 残された船の残骸から{LOCAL}ルピが出てきたので押収した。
						ELSEIF LOCAL == 1
							PRINTFORMW 残された船の残骸はもぬけの殻だった。
						ELSEIF LOCAL == 2
							LOCALS = %ランダム素材名("ダンジョン素材", 0)%
							CALL 素材入手処理(LOCALS, 1)
							PRINTFORMW 残された船の残骸から「%LOCALS%」があったので押収した。
						ELSEIF LOCAL == 3
							LOCALS = %ランダム素材名("食物素材", 1)%
							CALL 素材入手処理(LOCALS, 1)
							PRINTFORMW 残された船の残骸から手つかずの 「%LOCALS%」が残されていたので押収した。
						ELSEIF LOCAL == 4
							LOCAL = RAND(1000, 5001)
							MONEY += LOCAL
							PRINTFORMW 残された船はもぬけの殻だったが、その残骸から{LOCAL}ルピになるパーツが出てきたので売却した。
						ELSE
							LOCAL = RAND(500, 2501)
							MONEY += LOCAL
							PRINTFORMW 残された船の残骸から{LOCAL}ルピが出てきたので押収した。
						ENDIF
					ENDIF
					CALL イベント完了フラグ汎用処理("ならず者の来訪")
				ELSEIF RESULT == 1
					;全滅
					PRINTW 不覚を取ってしまった。ここは一旦撤退しよう。
				ELSEIF RESULT == -1
					;逃走
					PRINTW 思ったよりも手強いようだ。ここは一旦撤退しよう。
				ENDIF
			ELSEIF RESULT == 1
				;全滅
				PRINTW 不覚を取ってしまった。ここは一旦撤退しよう。
			ELSEIF RESULT == -1
				;逃走
				PRINTW 思ったよりも手強いようだ。ここは一旦撤退しよう。
			ENDIF
			CALL ダンジョン終了時処理
		CASE 1
			PRINTW いや、油断は良くない。ここはしっかりと準備をしてからにしよう。
	ENDSELECT
ENDIF








