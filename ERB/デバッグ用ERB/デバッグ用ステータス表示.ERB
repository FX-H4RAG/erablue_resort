
@OPTION_DEBUG
#DIM ループ用
#DIMS 名前格納


FOR ループ用,0,CHARANUM
	SIF CFLAG:ループ用:滞在期間 < 1
		CONTINUE
	PRINTFORM %NAME:ループ用%
	PRINTFORML 　現在位置は？　{CFLAG:ループ用:現在マップ種別}:{CFLAG:ループ用:現在位置}
NEXT


					; CALL 汎用衣装取得処理("ファイターの服")
					; CALL 汎用衣装取得処理("ナイトの服")
					; CALL 汎用衣装取得処理("プリーストの服")
					; CALL 汎用衣装取得処理("ウィザードの服")

; CALL 汎用耳飾り取得処理("火の耳飾り")
; CALL 汎用耳飾り取得処理("水の耳飾り")
; CALL 汎用耳飾り取得処理("風の耳飾り")
; CALL 汎用耳飾り取得処理("土の耳飾り")

; FOR LOCAL, 0, 4
; 	SIF BATTLE_STATE:LOCAL:キャラ番号 < 1
; 		CONTINUE
; 	基礎BATTLE_STATE:(BATTLE_STATE:LOCAL:キャラ番号):蓄積EXP = 5000
; 	CALL レベルアップ処理(BATTLE_STATE:LOCAL:キャラ番号)
; NEXT

; CALL 戦闘初期処理_味方(1)
; CALL 探索用顔グラフィック生成
; BATTLE_STATE:2:行動速度 = 999
; 敵BATTLE_STATE_STR:0:エネミー名 = Lv4_人食い鳥
; 敵BATTLE_STATE_STR:1:エネミー名 = Lv4_人食い鳥
; 敵BATTLE_STATE_STR:2:エネミー名 = Lv4_人食い鳥
; 敵BATTLE_STATE_STR:3:エネミー名 = Lv4_人食い鳥
; CALL 雑魚敵遭遇汎用処理

;CALL 周回引き継ぎ処理

; SAVECHARA "ariza", "test", 92
; LOADCHARA "ariza"

; DT_TOXML "所持素材データベース"
; DT_RELEASE "所持素材データベース"
; LOADTEXT "素材DT_XML.txt"
; LOCALS:0 = %RESULTS%
; LOADTEXT "素材DT_schema.txt"
; LOCALS:1 = %RESULTS%
; DT_FROMXML "所持素材データベース", LOCALS:1, LOCALS:0

WAIT


@テスト用(ARG, スタート地点, ARG:1)
#FUNCTION
#DIM スタート地点
#DIM スタートマップ
#DIM 目的マップ
#DIM 移動キャラ

;現在位置取得
移動キャラ = 0

;マップ間を移動する際の処理
;（下のパターン分けでやると爆発的に量が増えていくため追加）
;マップ種別取得
スタートマップ = 派生マップ番号取得(0, スタート地点)
目的マップ = 派生マップ番号取得(0, ARG)
IF スタートマップ != 目的マップ
	;スタート種別ごとに場合分け
	SELECTCASE スタートマップ
		CASE 0
			SELECTCASE 目的マップ
				CASE 3
					ARG = 3
				CASE 5
					ARG = 5
				CASE 7
					ARG = 7
				CASE 8
					ARG = 8
				CASE 15
					ARG = 15
			ENDSELECT
		CASE 3
			ARG = 2
		CASE 5
			ARG = 2
		CASE 7
			ARG = 6
		CASE 8
			ARG = 6
		CASE 15
			IF (TALENT:移動キャラ:性別 & 1 == 1)
				;女部分があれば女子
				ARG = 14
			ELSE
				ARG = 13
			ENDIF
	ENDSELECT
ENDIF

;暫定目的地に直接移動できる場合
IF CAN_MOVE_1(CFLAG:移動キャラ:現在マップ種別, スタート地点, ARG) & 1
	;そこに移動
	RETURNF ARG
ENDIF

;袋小路から行ける場所は固定なので、そこを目指す
SELECTCASE スタート地点
	CASE 1
		RETURNF 2
	CASE 3
		RETURNF 2
	CASE 4
		RETURNF 2
	CASE 5
		RETURNF 2
	CASE 10
		RETURNF 9
	CASE 12
		RETURNF 11
	CASE 20
		RETURNF 6
	CASE 302 TO 308
		RETURNF 302
	CASE 504 TO 506
		RETURNF 503
	CASE 703 TO 711
		RETURNF 702
	CASE 803 TO 811
		RETURNF 802
	CASE 1503 TO 1507
		IF TALENT:移動キャラ:性別 == 2
			RETURNF 1513
		ELSE
			RETURNF 1514
		ENDIF
ENDSELECT


;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
;地点追加時要フォロー（全ケース修正すること）
SELECTCASE ARG
CASE 1
;玄関
	;玄関へはロビー経由必須
	RETURNF 2
CASE 2
;ロビー
	;7と8（脱衣所）からは廊下を目指す
	IF (スタート地点 == 7) || (スタート地点 == 8)
		RETURNF 6
	;9と11（男湯女湯）からはそれぞれ脱衣所を経由する
	ELSEIF (スタート地点 == 9)
		RETURNF 7
	ELSEIF (スタート地点 == 11)
		RETURNF 8
	;15（プール）からは入れる方の更衣室を経由する
	ELSEIF (スタート地点 == 15)
		IF (TALENT:移動キャラ:性別 & 1 == 1)
			;女部分があれば女子
			RETURNF 14
		ELSE
			RETURNF 13
		ENDIF
	ENDIF
CASE 3
;庭
	;庭へはロビー経由必須
	RETURNF 2
CASE 4
;ショー会場
	;ショー会場へはロビー経由必須
	RETURNF 2
CASE 5
;遊戯場
	;遊戯場へはロビー経由必須
	RETURNF 2
CASE 6
;廊下
	;1.3.4.5.13.14からは2を目指す
	IF GROUPMATCH(スタート地点,1,3,4,5,13,14)
		RETURNF 2
	;9と11（男湯女湯）からはそれぞれ脱衣所を経由する
	ELSEIF (スタート地点 == 9)
		RETURNF 7
	ELSEIF (スタート地点 == 11)
		RETURNF 8
	;15（プール）からは入れる方の更衣室を経由する
	ELSEIF (スタート地点 == 15)
		IF (TALENT:移動キャラ:性別 & 1 == 1)
			;女部分があれば女子
			RETURNF 14
		ELSE
			RETURNF 13
		ENDIF
	ENDIF
CASE 7
;男子脱衣所
	;内部からは袋小路処理や直接移動処理でOKなので外から目指す場合
	;男子脱衣所へは廊下経由必須
	RETURNF 6
CASE 8
;女子脱衣所
	;内部からは袋小路処理や直接移動処理でOKなので外から目指す場合
	;女子脱衣所へは廊下経由必須
	RETURNF 6
CASE 9
;男湯
	;男湯へは脱衣所経由必須
	RETURNF 7
CASE 10
;男露天
	;男露天へは男湯経由必須
	RETURNF 9
CASE 11
;女湯
	;女湯へは脱衣所経由必須
	RETURNF 8
CASE 12
;女露天
	;女露天へは女湯経由必須
	RETURNF 11
CASE 13
;男更衣室
	;更衣室へはロビー経由必須
	RETURNF 2
CASE 14
;女更衣室
	;更衣室へはロビー経由必須
	RETURNF 2
CASE 15
;プール
	;入れる方の更衣室を目指す
	IF (TALENT:移動キャラ:性別 & 1 == 1)
		;女部分があれば女子
		RETURNF 14
	ELSE
		RETURNF 13
	ENDIF
CASE 20
;自室
	;自室へはロビー経由必須
	RETURNF 6

;バーエリアは現状全エリアが相互通行可能ではないため、CASE分けを一つだけ追加
CASE 504 TO 506
;ボドゲ・卓球
	;バーエリアを目指す
	RETURNF 503

;温泉は現状全エリアが相互通行可能ではないため、CASE分けを追加
CASE 703 TO 711
	RETURNF 702
CASE 803 TO 811
	RETURNF 802

ENDSELECT
