;Ver0.045と旧バージョンとの互換のための処理
;Ver0.048にしたとき消す、互換を46に
 
;追加TALENT、追加CSTRのチェック
@VERUP_45_CHARA(ARG)
#DIM ループ用
#DIM キャラ番号
#DIMS 経験道具

IF 初体験データベースフォロー_初うふふ == 0
	IF 初体験日:ARG:初うふふ
		CALL 初体験日登録処理(ARG, MASTER, "初うふふ", 初体験日:ARG:初うふふ * 1440 + 720, @"%CALLNAME:MASTER%の部屋", "押し倒す", "", 1)
		CALL 初体験日登録処理(ARG, MASTER, "うふふ", 初体験日:ARG:初うふふ * 1440 + 720, @"%CALLNAME:MASTER%の部屋", "押し倒す", "", 0)
		CALL 初体験日登録処理(MASTER, ARG, "初うふふ", 初体験日:ARG:初うふふ * 1440 + 720, @"%CALLNAME:MASTER%の部屋", "押し倒す", "", 1)
		CALL 初体験日登録処理(MASTER, ARG, "うふふ", 初体験日:ARG:初うふふ * 1440 + 720, @"%CALLNAME:MASTER%の部屋", "押し倒す", "", 0)
	ENDIF
	IF 経験相手:ARG:初うふふ != ""
		VARSET RESULTS
		SPLIT 経験相手:ARG:初うふふ, "_", RESULTS
		FOR ループ用, 0, RESULT
			SIF ISNUMERIC(RESULTS:ループ用) == 0
				CONTINUE
			キャラ番号 = FIND_CHARA_FROM_PERSON_ID(TOINT(RESULTS:ループ用))
			CALL 初体験日登録処理(ARG, キャラ番号, "初うふふ", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", "押し倒す", "", 1)
			CALL 初体験日登録処理(ARG, キャラ番号, "うふふ", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", "押し倒す", "", 0)
			CALL 初体験日登録処理(キャラ番号, ARG, "初うふふ", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", "押し倒す", "", 1)
			CALL 初体験日登録処理(キャラ番号, ARG, "うふふ", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", "押し倒す", "", 0)
		NEXT
	ENDIF
ENDIF

IF 初体験データベースフォロー_挿入系 == 0
	IF GETBIT(TALENT:MASTER:性別, 1)
		経験道具 = ペニス
	ELSE
		経験道具 = ペニスバンド
	ENDIF
	IF 初体験日:ARG:Ｖ挿入初体験
		CALL 初体験日登録処理(ARG, MASTER, "Ｖ挿入初体験", 初体験日:ARG:Ｖ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(ARG, MASTER, "Ｖ挿入体験", 初体験日:ARG:Ｖ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
		CALL 初体験日登録処理(MASTER, ARG, "Ｖ挿入初体験_男側", 初体験日:ARG:Ｖ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(MASTER, ARG, "Ｖ挿入体験_男側", 初体験日:ARG:Ｖ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
	ENDIF
	IF 初体験日:ARG:Ａ挿入初体験
		CALL 初体験日登録処理(ARG, MASTER, "Ａ挿入初体験", 初体験日:ARG:Ａ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(ARG, MASTER, "Ａ挿入体験", 初体験日:ARG:Ａ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
		CALL 初体験日登録処理(MASTER, ARG, "Ａ挿入初体験_男側", 初体験日:ARG:Ａ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(MASTER, ARG, "Ａ挿入体験_男側", 初体験日:ARG:Ａ挿入初体験 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
	ENDIF
	IF GETBIT(TALENT:ARG:性別, 1)
		経験道具 = ペニス
	ELSE
		経験道具 = ペニスバンド
	ENDIF
	IF 初体験日:ARG:Ｖ挿入初体験_男側
		CALL 初体験日登録処理(ARG, MASTER, "Ｖ挿入初体験_男側", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(ARG, MASTER, "Ｖ挿入体験_男側", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
		CALL 初体験日登録処理(MASTER, ARG, "Ｖ挿入初体験", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(MASTER, ARG, "Ｖ挿入体験", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
	ENDIF
	IF 初体験日:ARG:Ａ挿入初体験_男側
		CALL 初体験日登録処理(ARG, MASTER, "Ａ挿入初体験_男側", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(ARG, MASTER, "Ａ挿入体験_男側", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
		CALL 初体験日登録処理(MASTER, ARG, "Ａ挿入初体験", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
		CALL 初体験日登録処理(MASTER, ARG, "Ａ挿入体験", 初体験日:ARG:Ｖ挿入初体験_男側 * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
	ENDIF
	IF 経験相手:ARG:初うふふ != ""
		VARSET RESULTS
		SPLIT 経験相手:ARG:初うふふ, "_", RESULTS
		FOR ループ用, 0, RESULT
			SIF ISNUMERIC(RESULTS:ループ用) == 0
				CONTINUE
			キャラ番号 = FIND_CHARA_FROM_PERSON_ID(TOINT(RESULTS:ループ用))
			
			IF キャラ番号 < 0 || GETBIT(TALENT:キャラ番号:性別, 1)
				経験道具 = ペニス
			ELSE
				経験道具 = ペニスバンド
			ENDIF
			IF 初体験日:ARG:Ｖ挿入初体験
				CALL 初体験日登録処理(ARG, キャラ番号, "Ｖ挿入初体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(ARG, キャラ番号, "Ｖ挿入体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ｖ挿入初体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ｖ挿入体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
			ENDIF
			IF 初体験日:ARG:Ａ挿入初体験
				CALL 初体験日登録処理(ARG, キャラ番号, "Ａ挿入初体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(ARG, キャラ番号, "Ａ挿入体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ａ挿入初体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ａ挿入体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
			ENDIF
			IF GETBIT(TALENT:ARG:性別, 1)
				経験道具 = ペニス
			ELSE
				経験道具 = ペニスバンド
			ENDIF
			IF 初体験日:ARG:Ｖ挿入初体験_男側
				CALL 初体験日登録処理(ARG, キャラ番号, "Ｖ挿入初体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(ARG, キャラ番号, "Ｖ挿入体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ｖ挿入初体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ｖ挿入体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
			ENDIF
			IF 初体験日:ARG:Ａ挿入初体験_男側
				CALL 初体験日登録処理(ARG, キャラ番号, "Ａ挿入初体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(ARG, キャラ番号, "Ａ挿入体験_男側", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ａ挿入初体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
				CALL 初体験日登録処理(キャラ番号, ARG, "Ａ挿入体験", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
			ENDIF
		NEXT
	ENDIF
ENDIF

IF 初体験データベースフォロー_キス == 0
	IF CFLAG:ARG:ファーストキスフラグ
		SELECTCASE CFLAG:ARG:ファーストキスフラグ
			CASE 1
				経験道具 = 唇
			CASE 10
				経験道具 = クリトリス
			CASE 11
				経験道具 = 陰茎
			CASE 12
				経験道具 = アナル
		ENDSELECT
		キャラ番号 = FIND_CHARA_FROM_PERSON_ID(CFLAG:ARG:ファーストキス相手番号)
		IF キャラ番号 == MASTER
			CALL 初体験日登録処理(ARG, キャラ番号, "ファーストキス", DAY * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
			CALL 初体験日登録処理(キャラ番号, ARG, "ファーストキス", DAY * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 1)
			IF 経験道具 == "唇"
				CALL 初体験日登録処理(ARG, キャラ番号, "キス", DAY * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "キス", DAY * 1440 + 720, @"%CALLNAME:MASTER%の部屋", 経験道具, "", 0)
			ENDIF
		ELSE
			CALL 初体験日登録処理(ARG, キャラ番号, "ファーストキス", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
			CALL 初体験日登録処理(キャラ番号, ARG, "ファーストキス", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 1)
			IF 経験道具 == "唇"
				CALL 初体験日登録処理(ARG, キャラ番号, "キス", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
				CALL 初体験日登録処理(キャラ番号, ARG, "キス", DAY * 1440 + 720, @"%CALLNAME:ARG%の部屋", 経験道具, "", 0)
			ENDIF
		ENDIF
	ENDIF
ENDIF

;その他広域変数の書き換えなど
@VERUP_45()
#DIM 配列番号
#DIMS 弱点キー
 
; IF なんらかフォロー == 0
; 	;なんらかのフォロー処理
; 	;ここで"なんらかフォロー = 1"しない
; ENDIF

SIF 親子関係更新フォロー == 0
	CALL VERUP_45_ユニークキャラ親子関係セットフォロー()

SIF ダンジョン変数名ミスフォロー == 0
	ダンジョン構造配列_名前を亡くした遺跡:22:5 = ダンジョン構造配列_人食い鳥の島:22:5

SIF デートスコアデータベースフォロー == 0
	CALL デートスコアデータベースセット

SIF 弱点の欠片フォロー == 0
	CALL 弱点の欠片データベースセット

IF 弱点の欠片表示フラグフォロー == 0
	DT_COLUMN_ADD "弱点の欠片データベース", "表示フラグ", 1
	FOR 配列番号, 0, DT_ROW_LENGTH("弱点の欠片データベース")
		弱点キー '= DT_CELL_GETS("弱点の欠片データベース", 配列番号, "弱点キー")
		IF STRFIND(弱点キー, "MODE_") >= 0
			DT_CELL_SET "弱点の欠片データベース", 配列番号, "弱点キー", 1
		ELSEIF STRFIND(弱点キー, "SITUATION_") >= 0
			DT_CELL_SET "弱点の欠片データベース", 配列番号, "弱点キー", 2
		ELSEIF STRFIND(弱点キー, "MASSAGE_") >= 0
			DT_CELL_SET "弱点の欠片データベース", 配列番号, "弱点キー", 3
		ELSEIF STRFIND(弱点キー, "RAPE_") >= 0
			DT_CELL_SET "弱点の欠片データベース", 配列番号, "弱点キー", 4
		ELSE
			DT_CELL_SET "弱点の欠片データベース", 配列番号, "弱点キー", 5
		ENDIF
	NEXT
ENDIF

IF 連続デートフォロー == 0
	DT_COLUMN_ADD "縁結びデータベース", "連続デート回数", 1
	DT_COLUMN_ADD "関係性データベース", "連続デート回数", 1
ENDIF

@VERUP_45_ユニークキャラ親子関係セットフォロー()
#DIM アレーティア
#DIM ティナ
#DIM ルシウス
#DIM アギエルバ
#DIM アルドラ
#DIM エルバハ
#DIM ノイシュ
#DIM オイゲン
#DIM アポロ
#DIM ヘルツェロイデ
#DIM パーシヴァル
#DIM アグロヴァル
#DIM サブリナ
#DIM フェニー
#DIM イングヴェイ
#DIM エリカ
#DIM EX_不知火
#DIM EX_ゆきかぜ
#DIM EX_スイレンのママ
#DIM EX_スイレン
#DIM EX_ソネット
#DIM EX_クリス
#DIM EX_ルザミーネ
#DIM EX_リーリエ
#DIM EX_ヴァルダ
#DIM EX_アンジェラ

FOR LOCAL, 1, CHARANUM
	SIF キャラ一致チェック(LOCAL, "[剣の賢者]アレーティア")
		アレーティア = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[ゴブリンキラー]ティナ")
		ティナ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[ゴブリンスレイヤー]ルシウス")
		ルシウス = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[暁の大刀]アギエルバ")
		アギエルバ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[暁の愛娘]アルドラ")
		アルドラ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[護衛侍女]エルバハ")
		エルバハ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[竜騎士]ノイシュ")
		ノイシュ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[蒼醒の志士]オイゲン")
		オイゲン = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[黒騎士]アポロニア")
		アポロ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[理想の聖母]ヘルツェロイデ")
		ヘルツェロイデ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[炎帝]パーシヴァル")
		パーシヴァル = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[氷皇]アグロヴァル")
		アグロヴァル = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[宿命の女剣]サブリナ")
		サブリナ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[不死鳥の欠片]フェニー")
		フェニー = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[伊達と酔狂の伝説]イングヴェイ")
		イングヴェイ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[ラフィーユ・デ・リブラン]エリカ")
		エリカ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[幻影の対魔忍]水城不知火")
		EX_不知火 = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[雷撃の対魔忍]水城ゆきかぜ")
		EX_ゆきかぜ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[漁師の妻]スイレンのママ")
		EX_スイレンのママ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[アーカラ島キャプテン]スイレン")
		EX_スイレン = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[救済謳う声楽家]ソネット・Ｍ・ユキネ")
		EX_ソネット = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[魔弓・イチイバル]雪音クリス")
		EX_クリス = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[エーテル財団代表]ルザミーネ")
		EX_ルザミーネ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[ポケモントレーナー]リーリエ")
		EX_リーリエ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[理の女王]ヴァルダ")
		EX_ヴァルダ = CFLAG:LOCAL:人物番号
	SIF キャラ一致チェック(LOCAL, "[アルテナの魔法姫]アンジェラ")
		EX_アンジェラ = CFLAG:LOCAL:人物番号
NEXT
CALL SET_PERSON_父親(ルシウス, アレーティア)
CALL SET_PERSON_父親(ティナ, アレーティア)
CALL SET_PERSON_父親(アルドラ, アギエルバ)
CALL SET_PERSON_母親(ノイシュ, エルバハ)
CALL SET_PERSON_父親(アポロ, オイゲン)
CALL SET_PERSON_母親(アグロヴァル, ヘルツェロイデ)
CALL SET_PERSON_母親(パーシヴァル, ヘルツェロイデ)
CALL SET_PERSON_母親(フェニー, サブリナ)
CALL SET_PERSON_父親(エリカ, イングヴェイ)
CALL SET_PERSON_母親(EX_ゆきかぜ, EX_不知火)
CALL SET_PERSON_母親(EX_スイレン, EX_スイレンのママ)
CALL SET_PERSON_母親(EX_リーリエ, EX_ルザミーネ)
CALL SET_PERSON_母親(EX_クリス, EX_ソネット)
CALL SET_PERSON_母親(EX_アンジェラ, EX_ヴァルダ)

CALL SET_PERSON_出生順(ルシウス, 2)
CALL SET_PERSON_出生順(ティナ, 1)
CALL SET_PERSON_出生順(アグロヴァル, 3)
CALL SET_PERSON_出生順(パーシヴァル, 1)


;対応処理用フラグを対応済状態にセット
@VERUP_45_FINISH()
; なんらかフォロー = 1
 
初体験データベースフォロー_初うふふ = 1
初体験データベースフォロー_挿入系 = 1
初体験データベースフォロー_キス = 1
ダンジョン変数名ミスフォロー = 1
デートスコアデータベースフォロー = 1
弱点の欠片フォロー = 1
弱点の欠片表示フラグフォロー = 1
連続デートフォロー = 1

親子関係更新フォロー = 1
