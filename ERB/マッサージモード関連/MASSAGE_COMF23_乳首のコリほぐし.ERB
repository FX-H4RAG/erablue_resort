;-------------------------------------------------
;乳首のコリほぐし
;-------------------------------------------------
@MASSAGE_COMNAME23
#FUNCTIONS
TSTR:コマンド名受渡 = 乳首のコリほぐし
SIF TALENT:TARGET:陥没乳首 && !TCVAR:TARGET:陥没乳首露出フラグ
	TSTR:コマンド名受渡 = 陥没乳首ほじり出し


;===================================================
;コマンドタイプ
;===================================================
@MASSAGE_COMTYPE_23
#FUNCTION
TFLAG:コマンドタイプ受渡 = COMTYPE("エロマッサージ")

@MASSAGE_COM_TOOLTIP_23
IF TALENT:TARGET:陥没乳首 && !TCVAR:TARGET:陥没乳首露出フラグ
	LOCALS = <br>■陥没乳首ほじり出し<br>
	LOCALS += "乳房の中で『凝って』いる照れ屋な陥没乳首をほじり出す。"
	LOCALS += "<br>COMタイプ：エロマッサージ<br>取得ソース：快Ｂ・露出・接触・歓楽"
	LOCALS += "<br>固有の取得経験：なし<br>"
	TSTR:ツールチップ受渡 = %LOCALS%
ELSE
	LOCALS = <br>■乳首のコリほぐし<br>
	LOCALS += "マッサージ中の快楽で『凝って』しまった乳首を揉みほぐす。"
	LOCALS += "_-_揉みほぐしているはずなのにビンビンに硬くなっていく一方なのはご愛嬌。_"
	LOCALS += "<br>COMタイプ：エロマッサージ<br>取得ソース：快Ｂ・露出・接触・歓楽"
	LOCALS += "<br>固有の取得経験：なし<br>"
	TSTR:ツールチップ受渡 = %LOCALS%
ENDIF
@MASSAGE_COM23
;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------

;基盤ができたあとで理性を削る処理を入れる

;Ｂ愛撫より全体的に強め。勿論です、プロですから。
;性交ではなくマッサージの中での行為のため露出強め。エロマッサージなので歓楽は通常より弱め
CALL SOURCE_CALC_露出(TARGET, PLAYER, 100)
CALL SOURCE_CALC_接触(TARGET, PLAYER, 80)
CALL SOURCE_CALC_快Ｂ(TARGET, PLAYER, 175)
CALL SOURCE_CALC_歓楽(TARGET, PLAYER, 50)

;せっかくだから男性相手にはさらに効果が増すように。
;男への性感マッサージコマンドは数が少なめだから……
SIF TALENT:TARGET:性別 == 2
	CALL SOURCE_CALC_快Ｂ(TARGET, PLAYER, 50)

;陥没乳首をほじり出すときは刺激が強い。
SIF TALENT:TARGET:陥没乳首 && !TCVAR:TARGET:陥没乳首露出フラグ
	CALL SOURCE_CALC_快Ｂ(TARGET, PLAYER, 50)

;陥没乳首をほじり出す場合のみ、上半身下着を脱がす。
IF TALENT:TARGET:陥没乳首 && !TCVAR:TARGET:陥没乳首露出フラグ && TEQUIP:上半身下着あり
	TEQUIP:上半身下着あり = 0
	RFLAG:コマンド結果受渡し変数 = 1
ENDIF

RCVAR:乳首開発フラグ = 1

;-------------------------------------------------
;経験の処理
;-------------------------------------------------

RETURN 1

;-------------------------------------------------
;実行判定
;-------------------------------------------------

@MASSAGE_COM_ABLE23
SIF SAVESTR:ゲームフェイズ管理 != "マッサージモード"
	RETURN 0

;Bがない場合駄目
SIF TALENT:TARGET:Ｂ感度 == -2
	RETURN 0

;乳首が勃起するくらいの欲情が必要
SIF PALAM:欲情 <= PALAMLV:2
	RETURN 0

;このへんは現状よくわかんないのでとりあえず書かないでおく



RETURN 1

;-------------------------------------------------
;実行時メッセージ
;-------------------------------------------------
@MASSAGE_MESSAGE_COM23

IF TALENT:TARGET:陥没乳首 && !TCVAR:TARGET:陥没乳首露出フラグ
	PRINTFORM %CALLNAME:PLAYER%は、%CALLNAME:TARGET%の
		;胸の施術着があった場合
		SIF RFLAG:コマンド結果受渡し変数 == 1
			PRINTFORM 胸の施術着を脱がせ、
	PRINTFORML 乳房の中で硬くなっていた陥没乳首を指でほじり出した。
ELSE
	PRINTFORM %CALLNAME:PLAYER%は、
		;胸の施術着がある場合
		SIF TEQUIP:上半身下着あり
			PRINTFORM 施術着の上からでもわかるほど
	PRINTFORML %TEXTR("ビンビンにとがった/硬くしこった")%%CALLNAME:TARGET%の乳首を指先で丹念に揉みほぐした。
ENDIF

