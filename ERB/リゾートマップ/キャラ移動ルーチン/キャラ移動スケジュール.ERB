;------------------------------------------------------------------------------
;汎用移動処理
;------------------------------------------------------------------------------
@MOVE_ON_SCHEDULE(キャラ番号)
#DIM キャラ番号

;まずスケジュール実行
CALL RUN_SCHEDULE(キャラ番号)

IF スケジュール状態:キャラ番号:目的地 != 998 && CFLAG:キャラ番号:現在位置 == 999 && CFLAG:キャラ番号:現在マップ種別 == 0
		CFLAG:キャラ番号:現在位置 = 1
		CFLAG:キャラ番号:現在マップ種別 = 0
ENDIF

IF CFLAG:キャラ番号:現在マップ種別 == スケジュール状態:キャラ番号:目的マップ
	IF CFLAG:キャラ番号:現在位置 == スケジュール状態:キャラ番号:目的地
		;いるなら処理無し
	ELSEIF スケジュール状態:キャラ番号:目的地 == 998
		;でかけてるパターン
		CFLAG:キャラ番号:現在位置 = 999
		CFLAG:キャラ番号:現在マップ種別 = 0
	ELSE
		;いないならルーチン通りの場所へ向けて移動
		CALLFORM SKIP_MOVE_{CFLAG:キャラ番号:現在マップ種別}(スケジュール状態:キャラ番号:目的地, キャラ番号)
		CALL 汎用移動処理(キャラ番号, RESULT)
		RETURN 1
	ENDIF
ELSE
	CALLFORM エリア情報登録_{CFLAG:キャラ番号:現在マップ種別}("エリア移動可能場所")
	IF CFLAG:キャラ番号:現在位置 == RESULT || CFLAG:キャラ番号:現在マップ種別 == 999
		;マップ種別から違う場合は目的のマップへ移動
		CALL 汎用マップ間移動処理(キャラ番号)
	ELSE
		CALLFORM SKIP_MOVE_{CFLAG:キャラ番号:現在マップ種別}(RESULT, キャラ番号)
		CALL 汎用移動処理(キャラ番号, RESULT)
	ENDIF
	RETURN 1
ENDIF
RETURN 0

@汎用移動処理(キャラ番号, 移動先)
#DIM キャラ番号
#DIM 移動先
;同じ部屋にいるなら移動先PRINT
IF CFLAG:キャラ番号:同室 && !CFLAG:MASTER:睡眠
	PRINTFORMW %CALLNAME:キャラ番号%は【%GETPLACENAME(CFLAG:キャラ番号:現在マップ種別, CFLAG:キャラ番号:現在位置)%】から【%GETPLACENAME(CFLAG:キャラ番号:現在マップ種別, RESULT)%】に移動した
ENDIF

;移動処理
CFLAG:キャラ番号:現在位置 = 移動先

;同じ部屋に来たならPRINT
SIF CFLAG:キャラ番号:現在位置 == CFLAG:MASTER:現在位置 && !CFLAG:MASTER:睡眠 && CFLAG:キャラ番号:現在マップ種別 == CFLAG:MASTER:現在マップ種別 
	PRINTFORMW %CALLNAME:キャラ番号%が【%GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:MASTER:現在位置)%】に来た


@汎用マップ間移動処理(キャラ番号)
;仮処理置き
;マップ増やしたらちゃんと汎用化すること！！！！！！！！
#DIM キャラ番号

;同じ部屋にいるなら移動先PRINT
LOCALS = %マップエリア名取得(スケジュール状態:キャラ番号:目的マップ)%
SIF CFLAG:キャラ番号:同室 && !CFLAG:MASTER:睡眠
	PRINTFORMW %CALLNAME:キャラ番号%は【%GETPLACENAME(CFLAG:キャラ番号:現在マップ種別, CFLAG:キャラ番号:現在位置)%】から【%LOCALS%】に移動した
;移動処理
CFLAG:キャラ番号:現在位置 = マップ移動初期位置(CFLAG:キャラ番号:現在マップ種別, スケジュール状態:キャラ番号:目的マップ)
SIF CFLAG:キャラ番号:現在位置 == 999
	CFLAG:キャラ番号:現在位置 = キャラクター部屋検索(キャラ番号)
CFLAG:キャラ番号:現在マップ種別 = スケジュール状態:キャラ番号:目的マップ
;同じ部屋に来たならPRINT
SIF CFLAG:キャラ番号:現在位置 == CFLAG:MASTER:現在位置 && !CFLAG:MASTER:睡眠 && CFLAG:キャラ番号:現在マップ種別 == CFLAG:MASTER:現在マップ種別 
	PRINTFORMW %CALLNAME:キャラ番号%が【%GETPLACENAME(CFLAG:PLAYER:現在マップ種別, CFLAG:MASTER:現在位置)%】に来た


@マップ移動初期位置(移動前マップ, 移動後マップ)
#FUNCTION
#DIM 移動前マップ
#DIM 移動後マップ

SELECTCASE 移動後マップ
	CASE 0
		SELECTCASE 移動前マップ
			CASE 999
				RETURNF 6
			CASEELSE
				RETURNF 1
		ENDSELECT
	CASE 1
		RETURNF 1
	CASE 100
		CALLFORMF マップ移動初期位置_%開催予定祭り名%(移動前マップ, 移動後マップ)
		RETURNF RESULT
	CASE 999
		RETURNF 999
ENDSELECT


;------------------------------------------------------------------------------
;スケジュール遷移処理
;------------------------------------------------------------------------------
@RUN_SCHEDULE(キャラ番号)
#DIM キャラ番号
#DIM スケジュール番号
#DIM 次スケジュール番号

スケジュール番号 = スケジュール状態:キャラ番号:現在スケジュール
次スケジュール番号 = GET_NEXT_SCHEDULE(キャラ番号)

IF スケジュール番号 == 次スケジュール番号
	;今のスケジュールを続ける処理
	IF GROUPMATCH(スケジュール状態:キャラ番号:状況, スケジュール_未実行, スケジュール_開始中)
		;未実行～開始中なら開始処理の実行。0以外なら実行中状態、0なら開始中状態
		CALLFORM SCHEDULE_%移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール%(キャラ番号, 移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール小分類, "開始処理")
		IF RESULT
			スケジュール状態:キャラ番号:状況 = スケジュール_実行中
		ELSE
			スケジュール状態:キャラ番号:状況 = スケジュール_開始中
		ENDIF
	ENDIF
	IF スケジュール状態:キャラ番号:状況 == スケジュール_実行中
		;実行中なら経過処理の実行
		CALLFORM SCHEDULE_%移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール%(キャラ番号, 移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール小分類, "経過処理")
	ENDIF
ELSE
	;新しいスケジュールへ移行する処理
	IF スケジュール状態:キャラ番号:状況 == スケジュール_未実行
		;未実行ならキャンセル
		スケジュール状態:キャラ番号:状況 = スケジュール_キャンセル
	ELSEIF GROUPMATCH(スケジュール状態:キャラ番号:状況, スケジュール_開始中, スケジュール_実行中, スケジュール_終了中)
		;開始中～終了中なら終了処理の実行。0以外なら完了状態、0なら終了中状態
		CALLFORM SCHEDULE_%移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール%(キャラ番号, 移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール小分類, "終了処理")
		IF RESULT
			スケジュール状態:キャラ番号:状況 = スケジュール_完了
		ELSE
			スケジュール状態:キャラ番号:状況 = スケジュール_終了中
		ENDIF
	ENDIF
	IF GROUPMATCH(スケジュール状態:キャラ番号:状況, スケジュール_完了, スケジュール_キャンセル)
		スケジュール状態:キャラ番号:現在スケジュール = 次スケジュール番号
		スケジュール状態:キャラ番号:終了予定時間 = TIME + 移動スケジュール設定:キャラ番号:次スケジュール番号:所要時間
		スケジュール状態:キャラ番号:状況 = スケジュール_未実行
		RESTART
	ENDIF
ENDIF


;------------------------------------------------------------------------------
;次のスケジュールを求める
;------------------------------------------------------------------------------
@GET_NEXT_SCHEDULE(キャラ番号)
#FUNCTION
#DIM キャラ番号
#DIM 次スケジュール番号
#DIM 次優先度

次スケジュール番号 = スケジュール状態:キャラ番号:現在スケジュール
;終了予定時間まではなるべく今のスケジュールを続ける
IF TIME < スケジュール状態:キャラ番号:終了予定時間
	次優先度 = 移動スケジュール設定:キャラ番号:次スケジュール番号:優先度 + 1
ELSE
	次優先度 = __INT_MIN__
ENDIF

FOR LOCAL, (スケジュール状態:キャラ番号:現在スケジュール + 1), 最大スケジュール登録数
	SIF 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール == ""
		BREAK
	;予定時間を前倒しで開始することはない
	SIF TIME < 移動スケジュール設定:キャラ番号:LOCAL:開始予定時間
		BREAK
	;より優先度が同じか高いなら、後のスケジュールを採用する
	IF 次優先度 <= 移動スケジュール設定:キャラ番号:LOCAL:優先度
		次スケジュール番号 = LOCAL
		次優先度 = 移動スケジュール設定:キャラ番号:LOCAL:優先度
	ENDIF
NEXT
RETURNF 次スケジュール番号


;------------------------------------------------------------------------------
;スケジュール初期化処理
;------------------------------------------------------------------------------
@RESET_SCHEDULE(キャラ番号)
#DIM キャラ番号

VARSET スケジュール状態:キャラ番号:0, 0
VARSET 移動スケジュール設定:キャラ番号:0:0, 0
VARSET 移動スケジュール文字列:キャラ番号:0:0, ""


;------------------------------------------------------------------------------
;空のスケジュール枠を探す
;------------------------------------------------------------------------------
@FIND_BLANK_SCHEDULE(キャラ番号)
#FUNCTION
#DIM キャラ番号

FOR LOCAL, 0, 最大スケジュール登録数
	SIF 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール == ""
		RETURNF LOCAL
NEXT
RETURNF 最大スケジュール登録数


;------------------------------------------------------------------------------
;指定時刻より実行できる中で最も新しいスケジュール枠を探す
;------------------------------------------------------------------------------
@FIND_RUNNABLE_SCHEDULE(キャラ番号, 優先度考慮 = 1, 時刻 = -1)
#FUNCTION
#DIM キャラ番号
#DIM 優先度考慮
#DIM 時刻
#DIM 次スケジュール番号
#DIM 次優先度

SIF 時刻 < 0
	時刻 = TIME

次スケジュール番号 = -1
次優先度 = __INT_MIN__
FOR LOCAL, 0, 最大スケジュール登録数
	SIF 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール == ""
		BREAK
	SIF 時刻 < 移動スケジュール設定:キャラ番号:LOCAL:開始予定時間
		BREAK
	IF !優先度考慮 || 次優先度 <= 移動スケジュール設定:キャラ番号:LOCAL:優先度
		次スケジュール番号 = LOCAL
		次優先度 = 移動スケジュール設定:キャラ番号:LOCAL:優先度
	ENDIF
NEXT
RETURNF 次スケジュール番号


;------------------------------------------------------------------------------
;スケジュールセット処理
;------------------------------------------------------------------------------
@SET_SCHEDULE(キャラ番号, スケジュール番号, 開始予定, キー, ARGS:0 = "", ARGS:10 = "", ARGS:1 = "", ARGS:11 = "", ARGS:2 = "", ARGS:12 = "")
#DIM キャラ番号
#DIM スケジュール番号
#DIM 開始予定
#DIMS キー

移動スケジュール設定:キャラ番号:スケジュール番号:開始予定時間 = 開始予定
移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール '= キー
移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール小分類 '= ""
移動スケジュール設定:キャラ番号:スケジュール番号:所要時間 = 0
移動スケジュール設定:キャラ番号:スケジュール番号:優先度 = 0

FOR LOCAL, 0, 3
	SELECTCASE ARGS:LOCAL
		CASE "小分類"
			移動スケジュール文字列:キャラ番号:スケジュール番号:スケジュール小分類 '= ARGS:(LOCAL + 10)
		CASE "所要時間"
			移動スケジュール設定:キャラ番号:スケジュール番号:所要時間 = TOINT(ARGS:(LOCAL + 10))
		CASE "優先度"
			移動スケジュール設定:キャラ番号:スケジュール番号:優先度 = TOINT(ARGS:(LOCAL + 10))
	ENDSELECT
NEXT


;------------------------------------------------------------------------------
;スケジュール割り込み処理
;------------------------------------------------------------------------------
@INTERRUPT_SCHEDULE(キャラ番号, 復帰フラグ = 0, キー, ARGS:0 = "", ARGS:10 = "", ARGS:1 = "", ARGS:11 = "", ARGS:2 = "", ARGS:12 = "")
#DIM キャラ番号
#DIM 復帰フラグ
#DIMS キー
#DIM スケジュール番号
#DIM 実行時間
#DIM 移動数

スケジュール番号 = スケジュール状態:キャラ番号:現在スケジュール
IF 復帰フラグ
	実行時間 = TIME - (スケジュール状態:キャラ番号:終了予定時間 - 移動スケジュール設定:キャラ番号:スケジュール番号:所要時間)
	SIF 実行時間 > 移動スケジュール設定:キャラ番号:スケジュール番号:所要時間
		復帰フラグ = 0
ENDIF

移動数 = 復帰フラグ ? 2 # 1
FOR LOCAL, (最大スケジュール登録数 - 1 - 移動数), (スケジュール番号 - 1), -1
	SIF 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール == ""
		CONTINUE
	移動スケジュール文字列:キャラ番号:(LOCAL + 移動数):スケジュール '= 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール
	移動スケジュール文字列:キャラ番号:(LOCAL + 移動数):スケジュール小分類 '= 移動スケジュール文字列:キャラ番号:LOCAL:スケジュール小分類
	移動スケジュール設定:キャラ番号:(LOCAL + 移動数):開始予定時間 = 移動スケジュール設定:キャラ番号:LOCAL:開始予定時間
	移動スケジュール設定:キャラ番号:(LOCAL + 移動数):所要時間 = 移動スケジュール設定:キャラ番号:LOCAL:所要時間
	移動スケジュール設定:キャラ番号:(LOCAL + 移動数):優先度 = 移動スケジュール設定:キャラ番号:LOCAL:優先度
NEXT

CALL SET_SCHEDULE(キャラ番号, スケジュール番号 + 1, TIME, キー, ARGS:0, ARGS:10, ARGS:1, ARGS:11, ARGS:2, ARGS:12)

IF 復帰フラグ
	移動スケジュール設定:キャラ番号:(スケジュール番号 + 2):開始予定時間 = TIME
	移動スケジュール設定:キャラ番号:(スケジュール番号 + 2):所要時間 = 移動スケジュール設定:キャラ番号:スケジュール番号:所要時間 - 実行時間
	移動スケジュール設定:キャラ番号:スケジュール番号:所要時間 = 実行時間
ENDIF


;------------------------------------------------------------------------------
;同行のためのスケジュールコピー処理
;------------------------------------------------------------------------------
@COPY_SCHEDULE(コピー元キャラ番号, コピー先キャラ番号)
#DIM コピー元キャラ番号
#DIM コピー先キャラ番号
#DIM スケジュール番号

FOR スケジュール番号, 0, 最大スケジュール登録数
	移動スケジュール文字列:コピー先キャラ番号:スケジュール番号:スケジュール '= 移動スケジュール文字列:コピー元キャラ番号:スケジュール番号:スケジュール
	移動スケジュール文字列:コピー先キャラ番号:スケジュール番号:スケジュール小分類 '= 移動スケジュール文字列:コピー元キャラ番号:スケジュール番号:スケジュール小分類
	移動スケジュール設定:コピー先キャラ番号:スケジュール番号:開始予定時間 = 移動スケジュール設定:コピー元キャラ番号:スケジュール番号:開始予定時間
	移動スケジュール設定:コピー先キャラ番号:スケジュール番号:所要時間 = 移動スケジュール設定:コピー元キャラ番号:スケジュール番号:所要時間
	移動スケジュール設定:コピー先キャラ番号:スケジュール番号:優先度 = 移動スケジュール設定:コピー元キャラ番号:スケジュール番号:優先度
NEXT


;------------------------------------------------------------------------------
;目的地にいるか確認
;------------------------------------------------------------------------------
@IS_AT_DESTINATION(キャラ番号)
#FUNCTION
#DIM キャラ番号

RETURNF CFLAG:キャラ番号:現在マップ種別 == スケジュール状態:キャラ番号:目的マップ && CFLAG:キャラ番号:現在位置 == スケジュール状態:キャラ番号:目的地


;------------------------------------------------------------------------------
;休憩
;------------------------------------------------------------------------------
@SCHEDULE_休憩(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		IF 小分類 == "キャンプ" && 施設改造度:3:0
			スケジュール状態:キャラ番号:目的マップ = 0
			スケジュール状態:キャラ番号:目的地 = 303
		ELSE
			スケジュール状態:キャラ番号:目的マップ = 999
			スケジュール状態:キャラ番号:目的地 = キャラクター部屋検索(キャラ番号)
		ENDIF
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;交流
;------------------------------------------------------------------------------
@SCHEDULE_交流(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 0
		スケジュール状態:キャラ番号:目的地 = 2
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;食事
;------------------------------------------------------------------------------
@SCHEDULE_食事(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		IF 小分類 == "バーベキュー" && 施設改造度:3:0
			スケジュール状態:キャラ番号:目的マップ = 0
			スケジュール状態:キャラ番号:目的地 = 304
		ELSEIF 小分類 == "外食"
			スケジュール状態:キャラ番号:目的マップ = SCHEDULE_外食先決定関数(キャラ番号, 1)
			スケジュール状態:キャラ番号:目的地 = SCHEDULE_外食先決定関数(キャラ番号, 0)
		ELSEIF 小分類 == "お弁当" || 小分類 == "屋台"
		ELSE
			スケジュール状態:キャラ番号:目的マップ = 0
			スケジュール状態:キャラ番号:目的地 = 4
		ENDIF
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;お風呂
;------------------------------------------------------------------------------
@SCHEDULE_お風呂(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		SELECTCASE スケジュール状態:キャラ番号:状況
			CASE スケジュール_未実行
				スケジュール状態:キャラ番号:目的マップ = 0
				IF 施設改造度:7:0
					スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 702 # 802
				ELSE
					スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 7 # 8
				ENDIF
				TCVAR:キャラ番号:移動ルーチンインターバル時間 = 15
				RETURN 0
			CASE スケジュール_開始中
				RETURN IS_AT_DESTINATION(キャラ番号)
		ENDSELECT
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = 0
		IF 施設改造度:7:0
			スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? (703 + RAND:6) # (803 + RAND:6)
		ELSE
			スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? (9 + RAND:2) # (11 + RAND:2)
		ENDIF
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(30, 60)
	CASE "終了処理"
		SELECTCASE スケジュール状態:キャラ番号:状況
			CASE スケジュール_開始中
				RETURN 1
			CASE スケジュール_実行中
				スケジュール状態:キャラ番号:目的マップ = 0
				IF 施設改造度:7:0
					スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 702 # 802
				ELSE
					スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 7 # 8
				ENDIF
				TCVAR:キャラ番号:移動ルーチンインターバル時間 = 15
				RETURN 0
			CASE スケジュール_終了中
				RETURN IS_AT_DESTINATION(キャラ番号) && TCVAR:キャラ番号:移動ルーチンインターバル時間 <= 0
		ENDSELECT
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;プールで遊ぶ
;------------------------------------------------------------------------------
@SCHEDULE_プールで遊ぶ(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		SELECTCASE スケジュール状態:キャラ番号:状況
			CASE スケジュール_未実行
				スケジュール状態:キャラ番号:目的マップ = 0
				スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 13 # 14
				TCVAR:キャラ番号:移動ルーチンインターバル時間 = 15
				RETURN 0
			CASE スケジュール_開始中
				RETURN IS_AT_DESTINATION(キャラ番号)
		ENDSELECT
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = 0
		IF 施設改造度:15:0
			;プールサイド、メインプール、ボールプール、流れるプールの４択
			スケジュール状態:キャラ番号:目的地 = 1500 + (RAND:4 + 3)
			;ハーヴィンはメインプールに行かない
			SIF TALENT:キャラ番号:種族 == 4 && スケジュール状態:キャラ番号:目的地 == 1504
				スケジュール状態:キャラ番号:目的地 = 1505
		ELSE
			スケジュール状態:キャラ番号:目的地 = 15
		ENDIF
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(60, 120)
	CASE "終了処理"
		SELECTCASE スケジュール状態:キャラ番号:状況
			CASE スケジュール_開始中
				RETURN 1
			CASE スケジュール_実行中
				スケジュール状態:キャラ番号:目的マップ = 0
				スケジュール状態:キャラ番号:目的地 = (TALENT:キャラ番号:性別 == 2) ? 13 # 14
				TCVAR:キャラ番号:移動ルーチンインターバル時間 = 15
				RETURN 0
			CASE スケジュール_終了中
				RETURN IS_AT_DESTINATION(キャラ番号) && TCVAR:キャラ番号:移動ルーチンインターバル時間 <= 0
		ENDSELECT
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;外で遊ぶ
;------------------------------------------------------------------------------
@SCHEDULE_外で遊ぶ(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = 0
		IF 施設改造度:3:0
			;メインテント、バーベキューエリア、渓流エリア、サウナテントの４択
			LOCAL = 4
			;訓練場増築済みだと5択
			SIF 施設改造度:3:8
				LOCAL += 1
			スケジュール状態:キャラ番号:目的地 = 300 + (RAND:LOCAL + 3)
			;釣り好きはキャンプ場にいると絶対渓流に行く
			SIF 知識素質:キャラ番号:釣り好き
				スケジュール状態:キャラ番号:目的地 = 305
		ELSE
			スケジュール状態:キャラ番号:目的地 = 3
		ENDIF
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(60, 120)
	CASE "終了処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;遊戯室で遊ぶ
;------------------------------------------------------------------------------
@SCHEDULE_遊戯室で遊ぶ(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = 0
		IF 施設改造度:5:0
			;バーエリア、ボードゲームエリア、卓球場の３択
			LOCAL = 3
			;図書館増築済みだと4択
			SIF 施設改造度:5:6
				LOCAL += 1
			スケジュール状態:キャラ番号:目的地 = 500 + (RAND:LOCAL + 3)
		ELSE
			スケジュール状態:キャラ番号:目的地 = 5
		ENDIF
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(60, 120)
	CASE "終了処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;空艇港でショッピング
;------------------------------------------------------------------------------
@SCHEDULE_空艇港でショッピング(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = SCHEDULE_ショッピング先決定関数(キャラ番号, 1)
		スケジュール状態:キャラ番号:目的地 = SCHEDULE_ショッピング先決定関数(キャラ番号)
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(60, 120)
	CASE "終了処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
ENDSELECT

@SCHEDULE_ショッピング先決定関数(キャラ番号, マップ種別取得フラグ = 0)
#FUNCTION
#DIM キャラ番号
#DIM マップ種別取得フラグ
#DIM 店舗候補配列, 6
#DIM 候補数

SIF マップ種別取得フラグ
	RETURNF 1

VARSET 店舗候補配列
候補数 = 0
FOR LOCAL, 3, 9
	IF 空艇港店舗状況:LOCAL:0 > 0 && 空艇港店舗状況:LOCAL:0 != 3
		店舗候補配列:候補数 = LOCAL
		候補数 += 1
	ENDIF
NEXT
IF 候補数
	RETURNF 店舗候補配列:(RAND:候補数)
ELSE
	RETURNF 2
ENDIF

@SCHEDULE_外食先決定関数(キャラ番号, マップ種別取得フラグ = 0)
#FUNCTION
#DIM キャラ番号
#DIM マップ種別取得フラグ
#DIM 店舗候補配列, 6
#DIM 候補数

VARSET 店舗候補配列
候補数 = 0
FOR LOCAL, 3, 9
	IF 空艇港店舗状況:LOCAL:0 == 3
		SIF マップ種別取得フラグ
			RETURNF 1
		店舗候補配列:候補数 = LOCAL
		候補数 += 1
	ENDIF
NEXT
IF 候補数
	RETURNF 店舗候補配列:(RAND:候補数)
ELSEIF マップ種別取得フラグ
	RETURNF 0
ELSE
	RETURNF 4
ENDIF


;------------------------------------------------------------------------------
;雑務
;------------------------------------------------------------------------------
@SCHEDULE_雑務(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
	CASE "経過処理"
		SIF TCVAR:キャラ番号:移動ルーチンインターバル時間 > 0
			RETURN

		スケジュール状態:キャラ番号:目的マップ = SCHEDULE_雑務先決定関数(キャラ番号, 1)
		スケジュール状態:キャラ番号:目的地 = SCHEDULE_雑務先決定関数(キャラ番号)
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = RAND(60, 120)
	CASE "終了処理"
		TCVAR:キャラ番号:移動ルーチンインターバル時間 = 0
		RETURN 1
ENDSELECT

@SCHEDULE_雑務先決定関数(キャラ番号, マップ種別取得フラグ = 0)
#FUNCTION
#DIM キャラ番号
#DIM マップ種別取得フラグ
#DIM 雑務先候補配列, 200
#DIM 候補数

SIF マップ種別取得フラグ
	RETURNF 0

VARSET 雑務先候補配列
候補数 = 0
FOR LOCAL, 1, 2100
	IF 存在しない移動先(0, LOCAL) == 0
		IF TALENT:キャラ番号:性別 == 2 && FEMALEROOM(0, LOCAL)
			CONTINUE
		ELSEIF TALENT:キャラ番号:性別 != 2 && MALEROOM(0, LOCAL)
			CONTINUE
		ENDIF
		;隠し通路
		SIF LOCAL == 810 || LOCAL == 710
			CONTINUE
		雑務先候補配列:候補数 = LOCAL
		候補数 += 1
	ENDIF
NEXT

RETURNF 雑務先候補配列:(RAND:候補数)


;------------------------------------------------------------------------------
;常駐業務
;------------------------------------------------------------------------------
@SCHEDULE_常駐業務(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 現在仕事:キャラ番号:1 / 10000
		スケジュール状態:キャラ番号:目的地 = 現在仕事:キャラ番号:1 % 10000
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;宣伝
;------------------------------------------------------------------------------
@SCHEDULE_宣伝(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 999
		スケジュール状態:キャラ番号:目的地 = キャラクター部屋検索(キャラ番号)
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;訓練
;------------------------------------------------------------------------------
@SCHEDULE_訓練(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 0
		スケジュール状態:キャラ番号:目的地 = 308
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;自動探索前
;------------------------------------------------------------------------------
@SCHEDULE_自動探索前(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 0
		スケジュール状態:キャラ番号:目的地 = 1
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT


;------------------------------------------------------------------------------
;自動探索
;------------------------------------------------------------------------------
@SCHEDULE_自動探索(キャラ番号, 小分類, 処理内容)
#DIM キャラ番号
#DIMS 小分類
#DIMS 処理内容

SELECTCASE 処理内容
	CASE "開始処理"
		スケジュール状態:キャラ番号:目的マップ = 0
		スケジュール状態:キャラ番号:目的地 = 998
		RETURN 1
	CASE "経過処理"
	CASE "終了処理"
		RETURN 1
ENDSELECT
