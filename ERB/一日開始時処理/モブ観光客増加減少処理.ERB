@モブ観光客算出
#DIM 観光客減少補正

;人気度に応じてモブ観光客が増加する
;減少度は雑務ゲージの残量に応じて決定する
VARSET LOCAL

;雑務ゲージ平均値算出
FOR LOCAL, 1, 2100
	SIF LOCAL == 20
		CONTINUE
	IF 存在しない移動先(0, LOCAL) == 0
		LOCAL:1 += 雑務ゲージ:LOCAL
		LOCAL:2 += 1
	ENDIF
	SIF (LOCAL % 100) > 20
		LOCAL += 79
NEXT
LOCAL:1 = LOCAL:1 / LOCAL:2

;最大雑務ゲージは10000なので、まあ1割未満なら補正なしでいいか……？
;１割を超えるたびに減少補正を増加させる
観光客減少補正 = LOCAL:1 / 1000

;人気度（最大値9999）に応じて観光客量を計算する
LOCAL = リゾート人気度 * (10 - 観光客減少補正) / 10

;増加処理
;滞在キャラ上限*2を上限にして増加させる
モブ観光客数 = MIN(滞在キャラ上限 * 2, LOCAL)
モブ観光客数 = モブ観光客数 * RAND(95, 106) / 100

IF モブ観光客数 > 0
	DRAWLINE
	PRINTFORMW 今日のモブ観光客数は{モブ観光客数, 4}人です。
ENDIF
