@三妖精奥義発動確認(三妖精奥義フラグ)
#DIM REF 三妖精奥義フラグ, 0
#DIM ループ用
#DIM キャラ番号
#DIM 要素番号

FOR ループ用, 0, ターン中奥義回数保存
	キャラ番号 = BATTLE_STATE:(チェンバ基準キャラ保存:ループ用):キャラ番号
	IF CSVNAME(NO:キャラ番号) == "[輝ける日の光]サニーミルク"
		要素番号 = 0
	ELSEIF CSVNAME(NO:キャラ番号) == "[静かなる月の光]ルナチャイルド"
		要素番号 = 1
	ELSEIF CSVNAME(NO:キャラ番号) == "[降り注ぐ星の光]スターサファイア"
		要素番号 = 2
	ELSE
		CONTINUE
	ENDIF

	IF 基礎BATTLE_STATE:キャラ番号:Lv >= 38 && 陥落チェック(キャラ番号)
		三妖精奥義フラグ:要素番号 = 2
	ELSE
		三妖精奥義フラグ:要素番号 = 1
	ENDIF
NEXT


@固有奥義_1202(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 奥義威力
#DIMS 奥義名
#DIM 効果数値
#DIM 三妖精奥義フラグ, 3

VARSET 三妖精奥義フラグ, 0
SIF キャラ隊列検索(キャラ番号) >= 0
	CALL 三妖精奥義発動確認(三妖精奥義フラグ)

;他の三妖精が先に奥義を使用している場合(実装中)
;IF 三妖精奥義フラグ:1 && 三妖精奥義フラグ:2
IF 0
ELSE
	;効果が強くなっても名前は同じ
	奥義名 = サンシャインブラスト
	IF 基礎BATTLE_STATE:キャラ番号:Lv >= 14
		奥義威力 = 400
		効果数値 = 50
	ELSE
		奥義威力 = 300
		効果数値 = 20
	ENDIF

	アビ汎用文字列:実行時メッセージ１ = %CALLNAME:キャラ番号%のスぺルカード宣言！
	アビ汎用文字列:実行時メッセージ２ = 陽光「サンシャインブラスト」！

	SELECTCASE ARGS
		CASE "奥義名"
			TSTR:コマンド名受渡 = %奥義名%
		CASE "奥義説明文"
			詳細文文字列受け渡し変数 = 奥義威力：{奥義威力}％<br>敵単体に自属性のダメージを与える。
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 38 && 陥落チェック(キャラ番号)
				詳細文文字列受け渡し変数 += "<br>敵全体の"
			ELSE
				詳細文文字列受け渡し変数 += "<br>対象の"
			ENDIF
			詳細文文字列受け渡し変数 += @"命中率を3ターン［-{効果数値}％/独自枠］する。基礎成功率100％。"
			RETURN 奥義威力
		CASE "奥義前効果"
		CASE "奥義追加効果"
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 38 && 陥落チェック(キャラ番号)
				CALL アビ対象選択テンプレート_敵全体_生者のみ
			ENDIF
			アビ汎用文字列:バフ・デバフ枠 = 命中率_サンシャインブラスト
			アビ汎用文字列:バフ・デバフ対象能力 = 命中率
			アビ汎用変数:効果量 = 効果数値
			アビ汎用変数:持続ターン = 3
			アビ汎用変数:基礎成功確率 = 100
			CALL アビテンプレート_不利効果_デバフ効果セット
	ENDSELECT
ENDIF
