
@固有アビ_63_1(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM トーラの書
#DIM 対象一時保存

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
	アビ名 = ボアズ+
	消費ＭＰ = 100
ELSE
	アビ名 = ボアズ
	消費ＭＰ = 100
ENDIF

トーラの書 = バフ存在チェック_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>敵単体に5回水属性［攻撃力×100％］ダメージ
		詳細文文字列受け渡し変数 += @"<br>対象に月影の幻惑効果［永続/回復不可］"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 30
			詳細文文字列受け渡し変数 += @"<br>対象にスロウ効果［1回］"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>s◆トーラの書効果中、2回発動"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_敵単体
		対象一時保存 = アビテンプレート用_対象保存:0
		アビ汎用変数:効果割合 = 100
		FOR LOCAL, 0, 4
			CALL アビテンプレート_ダメージ処理_水属性
		NEXT
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_攻撃力
		アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_防御力
		アビ汎用文字列:バフ・デバフ対象能力 = 防御力
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_弱体耐性
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_命中率
		アビ汎用文字列:バフ・デバフ対象能力 = 命中率
		アビ汎用変数:効果割合 = 5
		アビ汎用変数:累積上限_割合 = 15
		アビ汎用変数:基礎成功確率 = 150
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		CALL アビテンプレート_不利効果_累積デバフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 1
			アビ汎用変数:基礎成功確率 = 120
			CALL アビテンプレート_不利効果_スロウ
		ENDIF
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 150
			CALL アビテンプレート_回復処理_MAXでも回復
		ENDIF
		
		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			アビテンプレート用_対象保存:0 = 対象一時保存
			アビ汎用変数:効果割合 = 100
			FOR LOCAL, 0, 4
				CALL アビテンプレート_ダメージ処理_水属性
			NEXT
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_攻撃力
			アビ汎用文字列:バフ・デバフ対象能力 = 攻撃力
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_防御力
			アビ汎用文字列:バフ・デバフ対象能力 = 防御力
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_弱体耐性
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体耐性
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月影の幻惑_命中率
			アビ汎用文字列:バフ・デバフ対象能力 = 命中率
			アビ汎用変数:効果割合 = 5
			アビ汎用変数:累積上限_割合 = 15
			アビ汎用変数:基礎成功確率 = 150
			アビ汎用変数:持続ターン = -1
			アビ汎用変数:消去不可オプション = 1
			CALL アビテンプレート_不利効果_累積デバフ効果セット
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 35
				CALL アビ汎用変数文字列リセット
				アビ汎用変数:効果量 = 1
				アビ汎用変数:基礎成功確率 = 120
				CALL アビテンプレート_不利効果_スロウ
			ENDIF
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_味方全体_生者のみ
				アビ汎用変数:効果量 = 150
				CALL アビテンプレート_回復処理_MAXでも回復
			ENDIF
		ENDIF
ENDSELECT



@固有アビ_63_2(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM トーラの書

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
	アビ名 = ヤヒン+
	消費ＭＰ = 100
ELSE
	アビ名 = ヤヒン
	消費ＭＰ = 100
ENDIF

トーラの書 = バフ存在チェック_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>味方単体に被ダメージ無効効果［1回］
		詳細文文字列受け渡し変数 += @"<br>対象に弱体無効効果［1回］"
		詳細文文字列受け渡し変数 += @"<br>対象に幻影効果［1回］"
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
			詳細文文字列受け渡し変数 += @"<br>対象にバリア効果［耐久300/永続］"
		ENDIF
		詳細文文字列受け渡し変数 += @"<br>◆トーラの書効果中、対象に加えて自身に対しても発動"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方単体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 被ダメージ無効
		アビ汎用文字列:バフ・デバフ対象能力 = ダメージ増減
		アビ汎用変数:効果割合 = 100
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 弱体無効
		アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 幻影
		アビ汎用文字列:バフ・デバフ対象能力 = 回避率
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = バリア
			アビ汎用文字列:バフ・デバフ対象能力 = バリア
			アビ汎用変数:効果量 = 300
			CALL アビテンプレート_有利効果_バフ効果セット
		ENDIF
		
		IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用変数:効果量 = 150
			CALL アビテンプレート_回復処理_MAXでも回復
		ENDIF
		
		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_自己のみ
			アビ汎用文字列:バフ・デバフ枠 = 被ダメージ無効
			アビ汎用文字列:バフ・デバフ対象能力 = ダメージ増減
			アビ汎用変数:効果割合 = 100
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 弱体無効
			アビ汎用文字列:バフ・デバフ対象能力 = 弱体無効
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 幻影
			アビ汎用文字列:バフ・デバフ対象能力 = 回避率
			アビ汎用変数:持続回数 = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
				CALL アビ汎用変数文字列リセット
				アビ汎用文字列:バフ・デバフ枠 = バリア
				アビ汎用文字列:バフ・デバフ対象能力 = バリア
				アビ汎用変数:効果量 = 300
				CALL アビテンプレート_有利効果_バフ効果セット
			ENDIF
			
			IF 基礎BATTLE_STATE:キャラ番号:Lv >= 70
				CALL アビ汎用変数文字列リセット
				CALL アビ対象選択テンプレート_味方全体_生者のみ
				アビ汎用変数:効果量 = 150
				CALL アビテンプレート_回復処理_MAXでも回復
			ENDIF
		ENDIF
ENDSELECT



@固有アビ_63_3(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 三日月
#DIM 上弦
#DIM 望
#DIM 隊列番号
#DIM バフ行数
#DIM 対象キャラ
#DIM トーラの書

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 65
	アビ名 = フェイスオブザムーン+
	消費ＭＰ = 75
ELSE
	アビ名 = フェイスオブザムーン
	消費ＭＰ = 100
ENDIF

隊列番号 = キャラ隊列検索(FINDCHARA(NO, 63))

三日月 = バフ存在チェック_枠("三日月", 戦闘行動キャラ)
上弦 = バフ存在チェック_枠("上弦", 戦闘行動キャラ)
トーラの書 = バフ存在チェック_枠("トーラの書", 戦闘行動キャラ)

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}
		詳細文文字列受け渡し変数 += @"<br>味方全体の水属性攻撃上昇［20/2ターン］"
		詳細文文字列受け渡し変数 += @"<br>対象に月狂の涙効果［2ターン］"
		詳細文文字列受け渡し変数 += @"<br>対象の奥義ゲージ［15％］アップ"
		詳細文文字列受け渡し変数 += @"<br>対象の月が少し満ちる"
		詳細文文字列受け渡し変数 += @"<br>◆トーラの書効果中、2回発動"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 水強化
		アビ汎用文字列:バフ・デバフ対象能力 = 水強化
		アビ汎用変数:効果量 = 20
		アビ汎用変数:持続ターン = 2
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用文字列:バフ・デバフ枠 = 月狂の涙
		アビ汎用文字列:バフ・デバフ対象能力 = 月狂の涙
		アビ汎用変数:持続ターン = 2
		アビ汎用変数:効果量 = 0
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		CALL アビ汎用変数文字列リセット
		アビ汎用変数:効果量 = 15
		CALL アビテンプレート_有利効果_奥義ゲージUP
		
		IF 三日月 > -1 || 上弦 > -1
			WSTR:(K++) = 月の時間が少し進んだ…
			戦闘中カウント:隊列番号:0 += 1
		ENDIF
		
		FOR 対象キャラ, 0, 4
			三日月 = バフ存在チェック_枠("三日月", 対象キャラ)
			上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
			望 = バフ存在チェック_枠("望", 対象キャラ)
			
			IF 望 > -1
				バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
				IF バフ行数 > -1
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
				ELSE
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
				ENDIF
				
				バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
				IF バフ行数 > -1
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
				ELSE
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
				ENDIF
				
				バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
				IF バフ行数 > -1
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
				ELSE
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
				ENDIF
				
				バフ行数 = バフ存在チェック_枠("月狂の涙_与ダメ増加", 対象キャラ)
				IF バフ行数 > -1
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
				ELSE
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_与ダメ増加", "バフ対象能力", "与ダメ増加", "バフ効果量_割合", 10, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
				ENDIF
			ELSEIF 上弦 > -1
				DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン") - 1
				
				IF 戦闘中カウント:隊列番号:0 < 5
					バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")

					バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					
					IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
						バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")

					ENDIF
				ELSEIF 戦闘中カウント:隊列番号:0 == 5
					WSTR:(K++) = 月が満ちきった！
					
					DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "バフ枠", "望"
					望 = バフ存在チェック_枠("望", 対象キャラ)
					
					バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_攻撃力"
					バフ行数 = バフ存在チェック_枠("望_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

					バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_防御力"
					バフ行数 = バフ存在チェック_枠("望_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

					
					バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_与ダメ増加", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_与ダメ増加", "バフ対象能力", "与ダメ増加", "バフ効果量_割合", 10, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
					バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメカ", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン"), "消去不可フラグ", 1
					
					IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
						バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 40
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

					ENDIF
				ENDIF
			ELSEIF 三日月 > -1
				IF 戦闘中カウント:隊列番号:0 < 3
					バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")

					バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
					
					IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
						バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 20
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
					ENDIF
				ELSEIF 戦闘中カウント:隊列番号:0 >= 3
					WSTR:(K++) = 月が満ちていく…！
					
					DT_CELL_SET @"バフデータベース_{対象キャラ}", 三日月, "バフ枠", "上弦"
					上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
					
					バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_攻撃力"
					バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					
					バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_防御力"
					バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
					DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメ軽減", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン"), "消去不可フラグ", 1
					
					IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
						バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30, 
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
					ENDIF
				ENDIF
			ENDIF
		NEXT


		IF トーラの書 > -1
			CALL アビ汎用変数文字列リセット
			CALL アビ対象選択テンプレート_味方全体_生者のみ
			アビ汎用文字列:バフ・デバフ枠 = 水強化
			アビ汎用文字列:バフ・デバフ対象能力 = 水強化
			アビ汎用変数:効果量 = 20
			アビ汎用変数:持続ターン = 2
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用文字列:バフ・デバフ枠 = 月狂の涙
			アビ汎用文字列:バフ・デバフ対象能力 = 月狂の涙
			アビ汎用変数:持続ターン = 2
			アビ汎用変数:効果量 = 0
			アビ汎用変数:特殊表示オプション = 1
			CALL アビテンプレート_有利効果_バフ効果セット
			
			CALL アビ汎用変数文字列リセット
			アビ汎用変数:効果量 = 15
			CALL アビテンプレート_有利効果_奥義ゲージUP
			
			IF 三日月 > -1 || 上弦 > -1
				WSTR:(K++) = 月の時間が少し進んだ…
				戦闘中カウント:隊列番号:0 += 1
			ENDIF
			
			FOR 対象キャラ, 0, 4
				三日月 = バフ存在チェック_枠("三日月", 対象キャラ)
				上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
				望 = バフ存在チェック_枠("望", 対象キャラ)
				
				IF 望 > -1
					バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
					
					バフ行数 = バフ存在チェック_枠("月狂の涙_与ダメ増加", 対象キャラ)
					IF バフ行数 > -1
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
					ELSE
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_与ダメ増加", "バフ対象能力", "与ダメ増加", "バフ効果量_割合", 10, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
					ENDIF
				ELSEIF 上弦 > -1
					DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン") - 1
					
					IF 戦闘中カウント:隊列番号:0 < 5
						バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")

						バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						
						IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
							バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")

						ENDIF
					ELSEIF 戦闘中カウント:隊列番号:0 == 5
						WSTR:(K++) = 月が満ちきった！
						
						DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "バフ枠", "望"
						望 = バフ存在チェック_枠("望", 対象キャラ)
						
						バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_攻撃力"
						バフ行数 = バフ存在チェック_枠("望_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

						バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_防御力"
						バフ行数 = バフ存在チェック_枠("望_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

						
						バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_追撃", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_与ダメ増加", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_与ダメ増加", "バフ対象能力", "与ダメ増加", "バフ効果量_割合", 10, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
						バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメカ", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン"), "消去不可フラグ", 1
						
						IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
							バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 40
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")

						ENDIF
					ENDIF
				ELSEIF 三日月 > -1
					IF 戦闘中カウント:隊列番号:0 < 3
						バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")

						バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
						
						IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
							バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 20
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
						ENDIF
					ELSEIF 戦闘中カウント:隊列番号:0 >= 3
						WSTR:(K++) = 月が満ちていく…！
						
						DT_CELL_SET @"バフデータベース_{対象キャラ}", 三日月, "バフ枠", "上弦"
						上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
						
						バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_攻撃力"
						バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						
						バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_防御力"
						バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_DA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_DA率", "バフ対象能力", "DA率", "バフ効果量_固定値", 100, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月狂の涙_TA率", 対象キャラ)
						IF バフ行数 > -1
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", 2
						ELSE
							DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_TA率", "バフ対象能力", "TA率", "バフ効果量_固定値", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン" ,2))
						ENDIF
						
						バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
						DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメ軽減", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン"), "消去不可フラグ", 1
						
						IF 陥落チェック(キャラ番号) && 基礎BATTLE_STATE:キャラ番号:Lv >= 80
							バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30, 
							DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
						ENDIF
					ENDIF
				ENDIF
			NEXT
		ENDIF
ENDSELECT



@固有アビ_63_4(ARGS, キャラ番号)
#DIM キャラ番号
#DIM 消費ＭＰ
#DIMS アビ名
#DIM 隊列番号
隊列番号 = キャラ隊列検索(キャラ番号)

;レベルなどの条件でアビを強化する場合、アビ名の文字列を条件分岐で変化させる
IF 基礎BATTLE_STATE:キャラ番号:Lv >= 80
	アビ名 = ルナティック・ヴェンデッタ
	消費ＭＰ = 300
ENDIF

SIF 隊列番号 > -1 && 戦闘中カウント:隊列番号:1
	アビテンプレート用_アビ封印用フラグ = 1

SELECTCASE ARGS
	CASE "アビ名"
		TSTR:コマンド名受渡 = %アビ名%
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 = 消費ＭＰ：{消費ＭＰ}<br>自身に月狂の鏡光効果［永続/消去不可］［再使用不可］
		詳細文文字列受け渡し変数 += @"<br>◆このアビリティは行動回数を消費しない"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_自己のみ
		アビ汎用文字列:バフ・デバフ枠 = 月狂の鏡光
		アビ汎用文字列:バフ・デバフ対象能力 = 月狂の鏡光
		アビ汎用変数:効果量 = 0
		アビ汎用変数:持続ターン = -1
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		戦闘中カウント:戦闘行動キャラ:1 = 1
		
		アビテンプレート用_行動消費無しフラグ = 1
ENDSELECT



@固有戦闘開始時処理_キャラ_63
#DIM バフ・デバフ行数
#DIM 隊列番号
#DIM 対象キャラ

対象キャラ = FINDCHARA(NO, 63)
隊列番号 = キャラ隊列検索(対象キャラ)

バフ・デバフ行数 = バフ存在チェック_枠("トーラの書", 隊列番号)
IF バフ・デバフ行数 < 0
	IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 70
		KSTR:(K++) = 「血祭りにしてやるわ……！」
	ELSEIF 陥落チェック(対象キャラ)
		KSTR:(K++) = 「さっさと片付けるわよ！」
	ELSE
		KSTR:(K++) = 「さぁ、参りましょう」
	ENDIF
	
	アビテンプレート用_アビ名 = 女教皇の正位置
	
	CALL アビ対象選択テンプレート_自己のみ
	アビ汎用文字列:バフ・デバフ枠 = トーラの書
	アビ汎用文字列:バフ・デバフ対象能力 = トーラの書
	アビ汎用変数:効果割合 = 0
	アビ汎用変数:持続ターン = -1
	アビ汎用変数:消去不可オプション = 1
	アビ汎用変数:特殊表示オプション = 1
	CALL アビテンプレート_有利効果_バフ効果セット
	
	IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 75
		CALL アビ汎用変数文字列リセット
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用文字列:バフ・デバフ枠 = 望
		アビ汎用文字列:バフ・デバフ対象能力 = 月
		アビ汎用変数:効果割合 = 0
		アビ汎用変数:持続ターン = 3
		アビ汎用変数:消去不可オプション = 1
		アビ汎用変数:特殊表示オプション = 1
		CALL アビテンプレート_有利効果_バフ効果セット
		
		戦闘中カウント:隊列番号:0 = 5
		
		FOR LOCAL, 0, 4
			DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "望_攻撃力", "バフ対象能力", "攻撃力", "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10, "持続ターン", 3, "消去不可フラグ", 1
			DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "望_防御力", "バフ対象能力", "防御力", "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10, "持続ターン", 3, "消去不可フラグ", 1
			
			DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "月海の羽衣_防御力", "バフ対象能力", "防御力", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", 3, "消去不可フラグ", 1
			DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "月海の羽衣_ダメ軽減", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", 3, "消去不可フラグ", 1
			DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "月海の羽衣_ダメカ", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", 3, "消去不可フラグ", 1
			
			IF 基礎BATTLE_STATE:対象キャラ:Lv >= 80
				DT_ROW_ADD @"バフデータベース_{LOCAL}", "バフ枠", "月の映鏡", "バフ対象能力", "追撃", "バフ効果量_割合", 40, "バフ名", "月の映鏡", "持続ターン", 3, "消去不可フラグ", 1
			ENDIF
		NEXT
	ENDIF
ENDIF



@固有ターン終了時処理_キャラ_63
#DIM 三日月
#DIM 上弦
#DIM 望
#DIM 月狂の涙
#DIM バフ行数
#DIM 隊列番号
#DIM 対象キャラ
#DIM ハーゼ

ハーゼ = FINDCHARA(NO, 63)
隊列番号 = キャラ隊列検索(ハーゼ)

戦闘中カウント:隊列番号:0 += 1

FOR 対象キャラ, 0, 4
	三日月 = バフ存在チェック_枠("三日月", 対象キャラ)
	上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
	望 = バフ存在チェック_枠("望", 対象キャラ)
	月狂の涙 = バフ存在チェック_枠("月狂の涙", 対象キャラ)
	
	IF 望 > -1
		戦闘中カウント:隊列番号:0 = 5
	ELSEIF 上弦 > -1
		DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン") - 1
		
		IF 戦闘中カウント:隊列番号:0 < 5
			バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			
			バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			
			IF 陥落チェック(ハーゼ) && 基礎BATTLE_STATE:ハーゼ:Lv >= 80
				バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30, 
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			ENDIF
		ELSEIF 戦闘中カウント:隊列番号:0 == 5
			WSTR:(K++) = 月が満ちきった！
			
			DT_CELL_SET @"バフデータベース_{対象キャラ}", 上弦, "バフ枠", "望"
			望 = バフ存在チェック_枠("望", 対象キャラ)
			
			バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_攻撃力"
			バフ行数 = バフ存在チェック_枠("望_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
			バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "望_防御力"
			バフ行数 = バフ存在チェック_枠("望_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
			
			IF 月狂の涙 > -1
				DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_与ダメ増加", "バフ対象能力", "与ダメ増加", "バフ効果量_割合", 10, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン"), DT_CELL_GET(@"バフデータベース_{対象キャラ}", 月狂の涙, "持続ターン"))
			ENDIF
			
			バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
			バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
			DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメカ", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン"), "消去不可フラグ", 1
			
			IF 陥落チェック(ハーゼ) && 基礎BATTLE_STATE:ハーゼ:Lv >= 80
				バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 40
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン")
			ENDIF
		ENDIF
	ELSEIF 三日月 > -1
		IF 戦闘中カウント:隊列番号:0 < 3
			バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
			バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
			
			バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
			
			IF 陥落チェック(ハーゼ) && 基礎BATTLE_STATE:ハーゼ:Lv >= 80
				バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 20
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 三日月, "持続ターン")
			ENDIF
		ELSEIF 戦闘中カウント:隊列番号:0 >= 3
			WSTR:(K++) = 月が満ちていく…！
			
			DT_CELL_SET @"バフデータベース_{対象キャラ}", 三日月, "バフ枠", "上弦"
			上弦 = バフ存在チェック_枠("上弦", 対象キャラ)
			
			バフ行数 = バフ存在チェック_枠("三日月_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_攻撃力"
			バフ行数 = バフ存在チェック_枠("上弦_攻撃力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			バフ行数 = バフ存在チェック_枠("三日月_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ枠", "上弦_防御力"
			バフ行数 = バフ存在チェック_枠("上弦_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", (戦闘中カウント:隊列番号:0 * 5) + 10
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			
			IF 月狂の涙 > -1
				DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月狂の涙_追撃", "バフ対象能力", "追撃", "バフ効果量_割合", 20, "バフ名", "月狂の涙", "持続ターン", MIN(DT_CELL_GET(@"バフデータベース_{対象キャラ}", 望, "持続ターン"), DT_CELL_GET(@"バフデータベース_{対象キャラ}", 月狂の涙, "持続ターン"))
			ENDIF
			
			バフ行数 = バフ存在チェック_枠("月海の羽衣_防御力", 対象キャラ)
			DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			バフ行数 = バフ存在チェック_枠("月海の羽衣_ダメ軽減", 対象キャラ)
			DT_ROW_ADD @"バフデータベース_{対象キャラ}", "バフ枠", "月海の羽衣_ダメ軽減", "バフ対象能力", "ダメージ増減", "バフ効果量_割合", 20, "バフ名", "月海の羽衣", "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン"), "消去不可フラグ", 1
			
			IF 陥落チェック(ハーゼ) && 基礎BATTLE_STATE:ハーゼ:Lv >= 80
				バフ行数 = バフ存在チェック_枠("月の映鏡", 対象キャラ)
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "バフ効果量_割合", 30
				DT_CELL_SET @"バフデータベース_{対象キャラ}", バフ行数, "持続ターン", DT_CELL_GET(@"バフデータベース_{対象キャラ}", 上弦, "持続ターン")
			ENDIF
		ENDIF
	ELSE
		戦闘中カウント:隊列番号:0 = 0
	ENDIF
NEXT



@バフ・デバフ特殊表示_トーラの書(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML トーラの書
PRINTFORML アビリティが2回発動する状態［消去不可］
PRINTFORML 持続ターン：永続



@バフ・デバフ特殊表示_三日月(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 三日月
PRINTFORML 月が満ち始めた状態［消去不可］
PRINTFORML 持続ターン：{DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ・デバフ行数, "持続ターン")}



@バフ・デバフ特殊表示_上弦(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 上弦
PRINTFORML 月が満ちかけている状態［消去不可］
PRINTFORML 持続ターン：{DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ・デバフ行数, "持続ターン")}



@バフ・デバフ特殊表示_望(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 望
PRINTFORML 月が満ちきった状態［消去不可］
PRINTFORML 持続ターン：{DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ・デバフ行数, "持続ターン")}



@バフ・デバフ特殊表示_月狂の涙(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
#DIM ハーゼ
VARSET LOCALS

ハーゼ = FINDCHARA(NO, 63)

PRINTFORML 月狂の涙
PRINTFORML 月の満ち欠けに応じて攻撃性能が上昇する状態
PRINTFORML 持続ターン：{DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ・デバフ行数, "持続ターン")}



@バフ・デバフ特殊表示_月狂の鏡光(隊列番号, バフ・デバフ行数)
#DIM 隊列番号
#DIM バフ・デバフ行数
VARSET LOCALS

PRINTFORML 月狂の鏡光
PRINTFORML 奥義が2回発動/味方が連続攻撃時、月の満ち欠けに応じて敵に水属性ダメージを与える状態［消去不可］
PRINTFORML 持続ターン：{DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ・デバフ行数, "持続ターン")}



@固有通常攻撃後処理_バフ_望(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM ハーゼ隊列番号
#DIM 月狂の鏡光
#DIM ハーゼ

ハーゼ = FINDCHARA(NO, 63)

SIF 全滅フラグ
	RETURN 0

ハーゼ隊列番号 = キャラ隊列検索(ハーゼ)
月狂の鏡光 = バフ存在チェック_枠("月狂の鏡光", ハーゼ隊列番号) 

IF ハーゼ隊列番号 > -1 && BATTLE_STATE:ハーゼ隊列番号:ＨＰ > 0 && 月狂の鏡光 > -1 && 連撃数 > 1
	アビテンプレート用_アビ名 = 月狂の鏡光
	
	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 350
	FOR LOCAL, 0, 4
		CALL アビテンプレート_ダメージ処理_水属性
	NEXT
ENDIF



@固有通常攻撃後処理_バフ_上弦(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM ハーゼ隊列番号
#DIM 月狂の鏡光
#DIM ハーゼ

ハーゼ = FINDCHARA(NO, 63)

SIF 全滅フラグ
	RETURN 0

ハーゼ隊列番号 = キャラ隊列検索(ハーゼ)
月狂の鏡光 = バフ存在チェック_枠("月狂の鏡光", ハーゼ隊列番号) 

IF ハーゼ隊列番号 > -1 && BATTLE_STATE:ハーゼ隊列番号:ＨＰ > 0 && 月狂の鏡光 > -1 && 連撃数 > 1
	アビテンプレート用_アビ名 = 月狂の鏡光
	
	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 350
	FOR LOCAL, 0, 3
		CALL アビテンプレート_ダメージ処理_水属性
	NEXT
ENDIF



@固有通常攻撃後処理_バフ_三日月(全滅フラグ, 連撃数)
#DIM 連撃数
#DIM 全滅フラグ
#DIM ハーゼ隊列番号
#DIM 月狂の鏡光
#DIM ハーゼ

ハーゼ = FINDCHARA(NO, 63)

SIF 全滅フラグ
	RETURN 0

ハーゼ隊列番号 = キャラ隊列検索(ハーゼ)
月狂の鏡光 = バフ存在チェック_枠("月狂の鏡光", ハーゼ隊列番号) 

IF ハーゼ隊列番号 > -1 && BATTLE_STATE:ハーゼ隊列番号:ＨＰ > 0 && 月狂の鏡光 > -1 && 連撃数 > 1
	アビテンプレート用_アビ名 = 月狂の鏡光
	
	CALL アビ汎用変数文字列リセット
	アビ汎用変数:効果割合 = 350
	FOR LOCAL, 0, 2
		CALL アビテンプレート_ダメージ処理_水属性
	NEXT
ENDIF

;--------------------------------------------------
;戦闘能力画面に表示されるキャラごとの固有処理説明
;--------------------------------------------------
;・使い方
;「XXXX」をキャラクター番号に置換し、それぞれの関数に処理を入れる
;　口上と同じ感覚で使う為に書式を統一しているが、ステータス画面で表示されるので
;　基本的にWAIT系列は使わないことを推奨
;--------------------------------------------------
@口上_ステータス画面_固有特性解説_63(対象キャラ)
#DIM 対象キャラ
CALL 口上変数初期化

KSTR:(K++) = □ 特性：『月海の羽衣』 □---------------------------------------------------------------
KSTR:(K++) = 　月の満ち欠けに応じて味方全体の防御性能が上昇
KSTR:(K++) = 　
IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 70
	KSTR:(K++) = □ 特性：『月の映鏡』 □-----------------------------------------------------------------
	KSTR:(K++) = 　月の満ち欠けに応じて味方全体に水属性追撃効果
	KSTR:(K++) = 　
ENDIF
KSTR:(K++) = □ 特性：『女教皇の正位置』 □----------------------------------------------------------
IF 陥落チェック(対象キャラ) && 基礎BATTLE_STATE:対象キャラ:Lv >= 75
	KSTR:(K++) = 　メインメンバー編成時、戦闘開始時に自身にトーラの書効果［永続/消去不可］/味方全体の月が完全に満ちる
ELSE
	KSTR:(K++) = 　メインメンバー編成時、戦闘開始時に自身にトーラの書効果［永続/消去不可］
ENDIF
KSTR:(K++) = 　◆再発動不可
KSTR:(K++) = 　
IF 基礎BATTLE_STATE:対象キャラ:Lv >= 70
	KSTR:(K++) = □ 特性：『至賢の領域・女教皇と月』 □--------------------------------------------------
	KSTR:(K++) = 　ボアズ/ヤヒン発動時、味方全体のHPを回復
	KSTR:(K++) = 　
ENDIF

CALL 口上変数表示(対象キャラ, 1)



