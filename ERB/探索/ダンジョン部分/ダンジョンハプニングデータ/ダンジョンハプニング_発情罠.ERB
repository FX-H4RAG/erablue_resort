@ダンジョンハプニング_発情罠(対象キャラ番号)
#DIM 対象キャラ番号
#DIM オナニー部位
#DIMS 部位名称
;覚えたてでＣを覚えた時に0になってしまうので定数だけずらす
#DIM CONST 覚えたて定数 = 100

WSTR:(K++) = 発情ガスの罠だ！
KSTR:(K++) = %CALLNAME:対象キャラ番号%がガスを吸い、発情状態になってしまった！

CALL メッセージ欄表示用関数()
CALL 口上変数初期化

IF 陥落チェック(対象キャラ番号) && 初体験日:対象キャラ番号:初うふふ
	TRYCCALLFORM KOJO_ハプニング_発情罠セックス_{NO:対象キャラ番号}(対象キャラ番号)
	CATCH
		KSTR:(K++) = %CALLNAME:対象キャラ番号%は%CALLNAME:PLAYER%を物陰に連れ込み、一緒に体の火照りを鎮めた……
		CALL メッセージ欄表示用関数()
	ENDCATCH

	CALL SOURCE_CALC_接触(対象キャラ番号, PLAYER, 180)
	CALL SOURCE_CALC_快Ｃ(対象キャラ番号, PLAYER, RAND:100 + 500)

	IF HAS_VAGINA(対象キャラ番号)
		IF 初体験日:対象キャラ番号:Ｖ挿入初体験
			CALL SOURCE_CALC_快Ｖ(対象キャラ番号, PLAYER, RAND:100 + 500)
		ENDIF
		CALL SOURCE_CALC_快Ｂ(対象キャラ番号, PLAYER, RAND:100 + 500)
	ENDIF

	IF EXP:対象キャラ番号:Ａ性交経験
		CALL SOURCE_CALC_快Ａ(対象キャラ番号, PLAYER, RAND:100 + 500)
	ENDIF

	CALL SOURCE_CALC_快Ｓ(対象キャラ番号, PLAYER, RAND:50)

ELSE
	オナニー部位 = RANDOM_PART(対象キャラ番号)
	IF 知識素質:対象キャラ番号:性知識 < 0 && EXP:対象キャラ番号:自慰経験 <= 0
		TRYCCALLFORM KOJO_ハプニング_発情罠オナニー_{NO:対象キャラ番号}(対象キャラ番号)
		CATCH
			;無知
			WSTR:(K++) = %CALLNAME:対象キャラ番号%は何が起こっているのか分からず、自分の肉体の変化に戸惑っている。
			KSTR:(K++) = %CALLNAME:PLAYER%は%CALLNAME:対象キャラ番号%を物陰に連れ込み、火照りの鎮め方を教えてあげた……
		ENDCATCH
		CALL SOURCE_CALC_接触(対象キャラ番号, PLAYER, 200)
		CFLAG:対象キャラ番号:オナニー覚えたて = オナニー部位 + 覚えたて定数
	ELSE
		TRYCCALLFORM KOJO_ハプニング_発情罠オナニー_{NO:対象キャラ番号}(対象キャラ番号)
		CATCH
			WSTR:(K++) = %CALLNAME:対象キャラ番号%は物陰に隠れ、こっそりと自らの火照りを鎮めた……
		ENDCATCH
	ENDIF
	CALL メッセージ欄表示用関数()
	CALL オナニー実処理(対象キャラ番号, オナニー部位)
ENDIF

;共通ソース増減部分
CALL SOURCE_CALC_露出(対象キャラ番号, PLAYER, 120)



@ダンジョンハプニング_ABLE_発情罠(判定キャラ番号)
#DIM 判定キャラ番号

SIF TALENT:判定キャラ番号:性別 == 2
	RETURN 0
;性欲無い場合駄目
SIF TALENT:判定キャラ番号:性欲 == -2
	RETURN 0
;性感帯無い場合も駄目
SIF RANDOM_PART(判定キャラ番号) == -1
	RETURN 0

RETURN 1
