

@ダンジョン初期処理_名前を亡くした遺跡
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンサブタイトル = ANCIENT RUINS
ダンジョンマス画像URL_伏せ状態 = 壁_遺跡
ダンジョン現在位置:0 = 0
ダンジョン現在位置:1 = 4
ダンジョン背景画像 = 背景_遺跡

;スタート地点は必ず存在
;初期からオープン済みなので3を入れる
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:0:4") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:0:4", 3
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョン解説文_名前を亡くした遺跡

詳細文文字列受け渡し変数 = 
詳細文文字列受け渡し変数 += "ルーマシー群島に存在する古代の遺跡。覇空戦争時代前後に作られたと見られる。<br>"
詳細文文字列受け渡し変数 += "内部にはゴーレムやマイコニドなどの魔物が住み着いており、わざわざ訪れる者は殆どいない。<br>"
詳細文文字列受け渡し変数 += "また、どうやらこの遺跡を拠点にしようと時折ゴブリンが侵入してくることもあるようだ。<br>"
詳細文文字列受け渡し変数 += "古代米やレンズ豆など、少し変わった素材を入手出来るだろう。<br>"

;推奨レベルを返す
RETURN 8



@敵討伐後処理_ダンジョン固有_名前を亡くした遺跡(討伐エネミー数)
;ダンジョン内で戦闘した後に呼ばれる関数、主にダンジョンごとのドロップアイテム取得に使用
;まだ敵データはリセットしていないので敵BATTLE_STATEで色々情報は取得可能
#DIM 討伐エネミー数
#DIM ドロップ確率
#DIMS ドロップアイテム

ドロップ確率 = 10 * 討伐エネミー数
ドロップアイテム = 壁画の破片
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 5 * 討伐エネミー数
ドロップアイテム = 古代米
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 10 * 討伐エネミー数
ドロップアイテム = レンズ豆
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 5 * 討伐エネミー数
ドロップアイテム = 星晶の破片
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

ドロップ確率 = 1 * 討伐エネミー数
ドロップアイテム = 赤銅の古紋
CALL ドロップ判定処理(ドロップ確率, ドロップアイテム)

;---------------------------------------------------------------------
;マップ構造
;---------------------------------------------------------------------
;四角形に配置された４つのマップを巡り、ミニイベをクリアしてゆぐゆぐの信頼度を稼ぐ
;稼ぎ終わったら最初のマップから隠された道が開き、ゆぐゆぐがいる場所に行けるようになる
;ボスは一番奥のマップにおり、ゆぐゆぐルートが開く前に接敵する
;---------------------------------------------------------------------
@ダンジョンマス情報_名前を亡くした遺跡_0_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_4")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%は名前を亡くした遺跡へと足を踏み入れた。
			WSTR:(K++) = 星晶獣eraが言うには、ここには創世樹と呼ばれる星晶獣が暮らしているそうだ。
			WSTR:(K++) = 心優しいが社交的ではなく、信頼していない相手には姿を見せないのだとか。
			WSTR:(K++) = COLOR_FFD900_木々や動物を尊重し、大切に扱えば信用してもらえるかもしれない。
			WSTR:(K++) = 蒼の少女や星晶獣の友人に案内してもらう手はあるが、%CALLNAME:PLAYER%自身が認められなければロクに話も出来ないだろう。
			WSTR:(K++) = まずは正攻法で、この遺跡をぐるっと回ってみるとしよう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			IF GETBIT(ダンジョン構造配列_人食い鳥の島:22:5, 4)
				KSTR:(K++) = 既に星晶獣の住処への道は開いている。
			ELSE
				KSTR:(K++) = この遺跡をぐるっと回ってみるとしよう。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_1_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_4")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡は古く、植物に侵食されて一部が崩れてさえいる。
			WSTR:(K++) = しかし手入れはされているのか瓦礫などは片付けられており、足場はしっかりとしているようだ。
			WSTR:(K++) = 周囲の魔力は土属性が色濃く出ている。住み着いている魔物も土属性が多いだろう。
			WSTR:(K++) = COLOR_FFD900_仲間には耳飾りを使って風属性になってもらうと有利に戦えそうだ。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 土属性の魔力が色濃い。魔物も土属性が多いだろう。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_2_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_1")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_2")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = 遺跡を進むと、巨大な人形のような彫刻が鎮座している。
			WSTR:(K++) = 比較的保存状態が良く、表面に細かいヒビがある以外に損傷は見当たらない。
			WSTR:(K++) = 岩肌を生かした荒削りなデザインは、今にも動き出しそうなほどに迫力がある。
			WSTR:(K++) = ……いや、実際に動き出している！　この彫刻は遺跡を守るゴーレムだ！
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_ゴーレム
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ先へ進む
				CALL 口上変数初期化
				WSTR:(K++) = 君たちはゴーレムを打倒した。
				WSTR:(K++) = しかし、打ち砕いた瓦礫は少しずつ集まり、元に戻ろうとしている。
				WSTR:(K++) = 恐らく周囲に魔力がある限り再生するのだろう。
				WSTR:(K++) = 君たちはゴーレムが再生するまでの隙に道を通り抜け、先へと進む。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:3:エネミー名 = Lv10_ゴーレム
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_3_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_0")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の通路には時折壁画のようなものが描かれている。
			WSTR:(K++) = 恐ろしい怪物と、武器を持った人々が戦っているような絵柄だ。
			WSTR:(K++) = この遺跡は覇空戦争の頃に作られたと聞く。この壁画も戦争のことを描いているのだろう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 通路には壁画のようなものが描かれている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_5_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡を進むと、倉庫のような場所に出た。
			WSTR:(K++) = めぼしい物は無く、ガラクタばかりが残されていたが……唯一価値のありそうな磁器の壺を見つける。
			WSTR:(K++) = 昔の時代に作られたアンティークであり、売れば１万ルピ程度にはなるだろう。
			KSTR:(K++) = しかし、壺の中にはリスのような動物が巣を作っていた。_PAGE
			KSTR:(K++) = %CALLNAME:PLAYER%は……
			KSTR:(K++) = BUTTON_[リスを追い出して壺を持っていく]
			KSTR:(K++) = BUTTON_[巣があるならしょうがない。壺を諦める]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[リスを追い出して壺を持っていく]"
					CALL 口上変数初期化
					WSTR:(K++) = しっしっ、とリスを追い払って巣を壺から取り出し、軽く磨く。
					WSTR:(K++) = リゾート経営に金はいくらあっても困らない。帰ったらよろず屋経由で好事家に売ってもらおう。
					WSTR:(K++) = %CALLNAME:PLAYER%は10,000ルピを手に入れた！
					CALL メッセージ欄表示用関数(,,,0)
					MONEY += 10000
				CASE "[巣があるならしょうがない。壺を諦める]"
					CALL 口上変数初期化
					WSTR:(K++) = ルピは欲しいが、わざわざ巣を壊すほどではない。
					WSTR:(K++) = この壺はそっとしておこう。
					SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
					ゆぐゆぐ信頼度_名前を亡くした遺跡 += 10
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL 口上変数初期化
		ELSE
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
				;リスを見逃したルート
				KSTR:(K++) = 壺の中には小動物の巣がある。
			ELSE
				;壺を拾ったルート
				KSTR:(K++) = もう価値のありそうな物は何もない。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_3_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_3")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			WSTR:(K++) = 通路にはゴブリンの死体が転がっていた。
			WSTR:(K++) = 剣や盾で武装しており、この遺跡に住み着いている個体とは思えない。
			WSTR:(K++) = 障害が増えているのは面倒な状況だが、逆にゴブリンを叩き出せば星晶獣に恩を売れるかもしれない。
			WSTR:(K++) = 見かけたら倒していこう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = ゴブリンの死体が転がっている。
		ENDIF
		CALL メッセージ欄表示用関数(,,,0)
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_5_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
		ELSE
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
			;ポーション入手済み
			KSTR:(K++) = もう特に気になるものはない。
			CALL メッセージ欄表示用関数(,,,0)
		ELSEIF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の壁際に、妙な植物が群生しているのを発見した。
			CALL 知識技能所持者検索("錬金知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は、その草はポーションの原料になると気づいた。
				WSTR:(K++) = 取り尽くさない程度に採取させてもらい、加工しよう。
				WSTR:(K++) = ポーションを３個手に入れた！
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
				CALL アイテム増減汎用処理("ポーション", 3)
			ELSE
				WSTR:(K++) = 見たことのない植物だし、毒があっても面倒だ。
				WSTR:(K++) = 錬金術の知識があれば何かわかるかもしれないが。
				WSTR:(K++) = 気にせず先に進もう。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 妙な植物が群生している。
			KSTR:(K++) = 錬金術の知識があれば何かわかるかもしれない。
			CALL 知識技能所持者検索("錬金知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は、その草はポーションの原料になると気づいた。
				WSTR:(K++) = 取り尽くさない程度に採取させてもらい、加工しよう。
				WSTR:(K++) = ポーションを３個手に入れた！
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
				CALL アイテム増減汎用処理("ポーション", 3)
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_7_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 7
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡は奥に進むほど原型を留めているようだ。
			WSTR:(K++) = ここからは魔物だけでなく、遺跡に仕掛けられた罠などにも気をつけた方がいいだろう。
			WSTR:(K++) = COLOR_FFD900_魔法知識_や_COLOR_FFD900_機械知識_があると安全に進めるかもしれない。
			WSTR:(K++) = あるいは、一度引っかかっても撤退して日を改めて進めばいい。慎重に進んでいこう。
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(8, 7)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 8
		ダンジョン現在位置:1 = 7
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_4_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_3")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡には時折キノコなども生えている。
			WSTR:(K++) = 食用になるものがないかと軽く探してみると、%CALLNAME:PLAYER%の背丈よりも大きなキノコを見つけた！
			WSTR:(K++) = キノコは動き出し、君たちに襲いかかってくる！
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:0:エネミー名 = Lv9_マイコニド
			敵BATTLE_STATE_STR:2:エネミー名 = Lv9_マイコニド
			CALL 雑魚敵遭遇汎用処理
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv9_マイコニド
			敵BATTLE_STATE_STR:2:エネミー名 = Lv9_マイコニド
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_6_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "7_1")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = また覇空戦争の頃の壁画を見つけた。
			WSTR:(K++) = 整備して見学出来るようにすれば、良い観光資源になりそうだが……
			WSTR:(K++) = わざわざ星晶獣の住処をそうするのもリスクが高い。
			WSTR:(K++) = 大人しく探索に戻るとしよう。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 覇空戦争の頃の壁画が並んでいる。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_名前を亡くした遺跡_2_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		SIF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "7_4")
	CASE "マスイベント"
		;奥へと続く扉
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
			;既に扉が開いている
			KSTR:(K++) = 巨大な扉は既に開いている。
			CALL メッセージ欄表示用関数(,,,0)
		ELSEIF GETBIT(ダンジョン構造配列_人食い鳥の島:22:5, 4)
			;ボス倒した
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 眼の前には巨大な扉が鎮座している。
				WSTR:(K++) = 扉に触れると、音も立てずひとりでに開いた。
			ELSE
				WSTR:(K++) = 閉じられていた扉に触れると、音も立てずひとりでに開いた。
			ENDIF
			WSTR:(K++) = まるで奥へと導かれているようだ。先に進んでみよう。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
		ELSE
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 眼の前には巨大な扉が鎮座している。
				WSTR:(K++) = 押しても引いても開きそうにない。何か仕掛けがあるのだろうか。
				WSTR:(K++) = 別の場所を先に探索しよう。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ELSE
				KSTR:(K++) = 巨大な扉は開きそうにない。
				CALL メッセージ欄表示用関数(,,,0)
			ENDIF
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_2_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_7")
	CASE "マスイベント"
		;こっちは過去に遺跡作った人たちの居住区画
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 他よりも少し狭く作られた道を進む。
			WSTR:(K++) = 石の寝台らしき物が置かれた部屋が幾つか並んでいた。
			WSTR:(K++) = 遺跡に住んでいた住民の生活スペースだったのだろうか。
			WSTR:(K++) = 少し見回ってみたが、既に何者かに荒らされていてめぼしいものは何も無いようだ。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 遺跡に住んでいた住民の生活スペースのようだ。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_3_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_7")
	CASE "マスイベント"
		;ゴブリンいるぞー話
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 奥に進むにつれ、遺跡の壁に真新しい傷のようなものが多くなってきた。
			CALL 知識技能所持者検索("魔物知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = ……！
				WSTR:(K++) = %CALLNAME:LOCAL%はこの傷は、ゴブリンが縄張りを主張する時の傷に似ていると看破した。
				WSTR:(K++) = 改めて周囲を警戒すると、近くにゴブリンが屯している姿を見つける。
				KSTR:(K++) = %CALLNAME:PLAYER%たちは先手を打って奇襲し、被害なくゴブリンたちを退けることが出来た！_PAGE
				WSTR:(K++) = ゴブリンたちは何やら宝石のようなものを持っていたようだ。
				WSTR:(K++) = %CALLNAME:PLAYER%たちは渦琥珀を手に入れた。
				CALL 素材入手処理("渦琥珀", 1)
			ELSE
				WSTR:(K++) = ……！
				WSTR:(K++) = %CALLNAME:PLAYER%たちが先に進むと、ゴブリンたちから奇襲を受けた！
				WSTR:(K++) = なんとか勝利したものの、少なくない被害を受けてしまった……。
				WSTR:(K++) = どうやら壁の傷は、ゴブリンが縄張りを主張する時の傷らしい。
				WSTR:(K++) = 魔物の知識を持つ仲間がいれば避けられたかもしれないが……。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 全員のＨＰが１００減少した。
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					SIF BATTLE_STATE:LOCAL:ＨＰ < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＨＰ = MAX(BATTLE_STATE:LOCAL:ＨＰ - 100, 1)
				NEXT
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 遺跡の壁に真新しい傷のようなものがある。
			KSTR:(K++) = ゴブリンたちはもういない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_4_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "5_5")
	CASE "マスイベント"
		;遺跡の石材置き場
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 少し広めの部屋に入ってみると、風化してボロボロになった石材が積まれていた。
			WSTR:(K++) = 形が残っているものを見てみれば石板や石像のような痕跡が見て取れる。
			WSTR:(K++) = 遺跡の装飾を作る部屋だったのだろうか？
			WSTR:(K++) = どちらにせよ、風化が進みすぎてまともに形を保っているものはなさそうだ。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 風化してボロボロになった石材が積まれている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_5_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		;砕けた石材に混じって宝石が落ちてる
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 奥の部屋もまた、風化した石材ばかりが転がっている。
			WSTR:(K++) = ……？　ボロボロの石の中に、輝くものを見つけた。
			WSTR:(K++) = これは宝石の原石だろうか。売れば多少の金になりそうだ。
			WSTR:(K++) = %CALLNAME:PLAYER%は懐に宝石をしまい込み、帰還してから売ることにした。
			WSTR:(K++) = %CALLNAME:PLAYER%は10,000ルピを手に入れた！
			MONEY += 10000
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = めぼしいものはなにもない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_5_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 5
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_8")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_6")
	CASE "マスイベント"
		;ゴブリン部隊
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 道の先から金属の擦れる音が聞こえてくる。
				WSTR:(K++) = 身を隠して覗いてみると、剣や盾で武装したゴブリン部隊の姿が見えた。
				WSTR:(K++) = 彼らは油断なく周囲を警戒しており、戦闘無しに切り抜けるのは難しいだろう。
				WSTR:(K++) = 君たちは準備を整え、ゴブリンたちと戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_6_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF ダンジョン内一時変数:0 == 0
			ダンジョンマス画像URL_重ね表示 = えっちハート
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		;えっちイベ
		CALL 口上変数初期化
		SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
		IF ダンジョン内一時変数:0
		ELSE
			CALL ダンジョンハプニング基本処理()
			IF RESULT
				ダンジョン内一時変数:0 = 1
			ENDIF
			CALL 口上変数初期化
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_6_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;25-0へ
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道にゴブリン部隊の痕跡が多く残っている。
			WSTR:(K++) = この遺跡を縄張りにする気なのだろうか。となればどこかに群れのリーダーがいるはずだが。
			WSTR:(K++) = おそらく、この先は戦闘が多くなる。気をつけて進もう。
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(25, 0)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 25
		ダンジョン現在位置:1 = 0
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_7_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 7
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;33-4へ
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(33, 4)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 33
		ダンジョン現在位置:1 = 4
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_8_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "9_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_6")
	CASE "マスイベント"
		;7_1へ
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 7
		ダンジョン現在位置:1 = 1
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_9_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 9
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_3")
	CASE "マスイベント"
		;エネミーゴブリン
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の奥へ進むと、壁にある仕掛けを弄っているゴブリンの姿を見つけた。
			WSTR:(K++) = 何をしているかはわからないが、妙なことをされる前に倒した方がいいだろう。
			WSTR:(K++) = 君たちは武器を構え、戦いを始める。
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL 口上変数初期化
			WSTR:(K++) = どうやらこの種類のゴブリンは、罠を仕掛ける役割を持っているらしい。
			WSTR:(K++) = 元々遺跡にあった罠を都合の良い形に改造したり、自前の罠を仕掛けたり。
			WSTR:(K++) = 他のゴブリンと比較して弱めだが、トラップの威力だけは侮れない。
			WSTR:(K++) = 優先して倒した方が被害は少なくなるだろう。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_10_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF ダンジョン内一時変数:1
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
		ELSE
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱
		ENDIF
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_0")
	CASE "マスイベント"
		;りんごの木
		;プレゼントアイテムりんご入手
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の外は多くの草木で覆われている。
			WSTR:(K++) = %CALLNAME:PLAYER%はその中に、野生のりんごの木を発見した。
			KSTR:(K++) = ちょうど良くりんごの実が成っている。一つ貰っていこう。_PAGE
			WSTR:(K++) = %CALLNAME:PLAYER%たちはりんごを一つ手に入れた！
			CALL 素材入手処理("りんご", 1)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			WSTR:(K++) = この木は土の星晶獣の影響を受けているからか、成長がかなり速いようだ。
			WSTR:(K++) = 翌日以降にはまた新しい実を付けているだろう。
			WSTR:(K++) = りんごが欲しい時は覚えておくと良いかもしれない。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			ダンジョン内一時変数:1 = 1
		ELSEIF ダンジョン内一時変数:1 == 0
			;翌日以降
			WSTR:(K++) = りんごの木はまた実を付けていた。
			KSTR:(K++) = %CALLNAME:PLAYER%は手を伸ばし、その実を一つもぎ取る。_PAGE
			WSTR:(K++) = %CALLNAME:PLAYER%たちはりんごを一つ手に入れた！
			CALL 素材入手処理("りんご", 1)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			ダンジョン内一時変数:1 = 1
		ELSE
			KSTR:(K++) = 木にはまだ実はついていない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_10_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_3")
	CASE "マスイベント"
		;罠、機械知識
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の壁に妙な出っ張りがある。扉を開くための仕掛けのようだ。
			CALL 知識技能所持者検索("機械知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%が出っ張りの周りを簡単に調査すると、仕掛けに連動した罠を発見した。
				WSTR:(K++) = 罠の部分だけ妙に新しい。ゴブリンが後付けした罠なのだろう。
				KSTR:(K++) = %CALLNAME:LOCAL%は手際よく罠を解除し、使われていた資材を回収した。_PAGE
				WSTR:(K++) = %CALLNAME:PLAYER%たちは火の宝珠を３個手に入れた！
				CALL 素材入手処理("火の宝珠", 3)
			ELSE
				WSTR:(K++) = 仕掛けを動かすと、君たちに炎の罠が襲いかかる！
				WSTR:(K++) = 全員のＨＰが１００減少した。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					SIF BATTLE_STATE:LOCAL:ＨＰ < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＨＰ = MAX(BATTLE_STATE:LOCAL:ＨＰ - 100, 1)
				NEXT
				WSTR:(K++) = どうやら遺跡にあった仕掛けをゴブリンたちが改造したようだ。
				WSTR:(K++) = 機械の知識があれば避けられたかもしれない。
				WSTR:(K++) = 危険なので、ここの扉は開けっ放しにしておこう…
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = 自動で扉が動く仕掛けがある。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_10_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_7")
	CASE "マスイベント"
		;分かれ道、イベントなし
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路の壁には、覇空戦争時代の壁画が残っている。
			WSTR:(K++) = ……珍しく、壁画だけではなく文章も残されているようだ。古い文字だが読むことは出来る。
			WSTR:(K++) = 「快楽の獣を探し出せ。あれは単体で空を滅ぼしうるもの。決して気を許すな。必ず消滅させろ」
			WSTR:(K++) = %CALLNAME:PLAYER%はその文章の部分を削り取った。
			WSTR:(K++) = そして壁画に背を向けて、探索に戻る。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 覇空戦争時代の壁画が残っている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_11_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_5")
	CASE "マスイベント"
		;エネミー
		;ゴブリン部隊
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 道を進むと、何かを探している様子のゴブリンたちを見つけた。
				WSTR:(K++) = 他のゴブリンたちより、心なしかこざっぱりしているような気がする……。
				WSTR:(K++) = 周囲に泉でもあるのだろうか？
				WSTR:(K++) = どちらにせよ、遺跡の探索には邪魔だ。君たちはゴブリンとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_11_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_7")
	CASE "マスイベント"
		;鍵が掛かってる
		;機械知識か魔法知識で解錠可能
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%たちが通路を進むと、鍵の掛かった扉の前に出た。
			CALL 知識技能所持者検索("機械知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は鍵の構造を観察し、手持ちの道具でささっと鍵を開けてしまった。
				WSTR:(K++) = どうやら鍵の部分はゴブリンがつけたものでちゃちな錠前だったらしい。
				KSTR:(K++) = しかし、わざわざ鍵をつけて何を隠しているのだろうか。
				KSTR:(K++) = 先に進んでみよう。
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
				CALL 接続ルート全開放処理(マス深度, マス分岐)
			ELSE
				CALL 知識技能所持者検索("魔法知識", 1)
				LOCAL = RESULT
				IF LOCAL > -1
					WSTR:(K++) = %CALLNAME:LOCAL%は鍵開けの魔法を使い、鍵を開けてしまった。
					WSTR:(K++) = どうやら鍵の部分はゴブリンがつけたものでちゃちな錠前だったらしい。
					KSTR:(K++) = しかし、わざわざ鍵をつけて何を隠しているのだろうか。
					KSTR:(K++) = 先に進んでみよう。
					SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
					CALL 接続ルート全開放処理(マス深度, マス分岐)
				ELSE
					WSTR:(K++) = 鍵の当てもないし、扉を壊すのも気が引ける。
					WSTR:(K++) = 機械か魔法、どちらかの知識があれば開けられそうだが……
					WSTR:(K++) = ここは一旦置いといて、別の場所から探索しよう。
				ENDIF
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 既に扉は開いている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_12_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 12
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		;ゆぐゆぐ好感度イベント
		;小鳥を巣に戻す
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の外側を回ると、ちぃちぃと小鳥が鳴いている声が聞こえた。
			WSTR:(K++) = 声のする方を見てみると、強風で煽られたのか鳥の巣が地面に落ちてしまっていた。
			WSTR:(K++) = よく見ると、小鳥は「ユバメ」という鳥のようだ。
			KSTR:(K++) = ユバメの巣は高級珍味として扱われており、売れば１万ルピは下らないだろう。_PAGE
			KSTR:(K++) = %CALLNAME:PLAYER%は……
			KSTR:(K++) = BUTTON_[無くなってもまた新しく作るだろう。巣を持っていく]
			KSTR:(K++) = BUTTON_[住処を奪うのは可哀想だ。巣を戻してやる]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[無くなってもまた新しく作るだろう。巣を持っていく]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%は巣を拾い、荷物袋の中に入れる。
					WSTR:(K++) = ユバメは悲しそうな声で一つ鳴き、どこかへと飛んでいってしまった。
					WSTR:(K++) = リゾート経営に金はいくらあっても困らない。帰ったらよろず屋経由で好事家に売ってもらおう。
					WSTR:(K++) = %CALLNAME:PLAYER%は10,000ルピを手に入れた！
					CALL メッセージ欄表示用関数(,,,0)
					MONEY += 10000
				CASE "[住処を奪うのは可哀想だ。巣を戻してやる]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%はゆっくりとユバメに近づき、巣を拾い上げて戻してやった。
					WSTR:(K++) = ユバメは嬉しそうな声で一つ鳴き、直った巣でくつろいでいる。
					WSTR:(K++) = 寄り道はこのくらいにして遺跡の探索に戻ろう。
					SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
					ゆぐゆぐ信頼度_名前を亡くした遺跡 += 10
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL 口上変数初期化
		ELSE
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
				;リスを見逃したルート
				KSTR:(K++) = ユバメが透き通るような声で鳴いている。
			ELSE
				;壺を拾ったルート
				KSTR:(K++) = もう価値のありそうな物は何もない。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_12_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 12
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_1")
	CASE "マスイベント"
		;遺跡の穴からちょっと外に出る感じ
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の壁が崩れ、外へと通じる道のようになっている。
			WSTR:(K++) = 無視してまっすぐ進めば奥へ向かうことが出来るだろうが、少し寄り道してみるのも良いかもしれない。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 外へと通じる道がある。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_12_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 12
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_3")
	CASE "マスイベント"
		;壁画、eraに似てる絵があるきがする
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 遺跡の通路には相変わらず壁画が掘られている。
			WSTR:(K++) = 暴風によって空の民を蹴散らす星晶獣らしき絵や、光る剣を持ってそれに立ち向かう英雄らしき絵…
			KSTR:(K++) = 詳しい状況はわからないが、当時の戦いを思うと感じ入るものがある。_PAGE
			WSTR:(K++) = 壁画の一つに、幼い童女のような姿が書かれているものを見つけた。
			WSTR:(K++) = その童女は周囲の人間を悦楽に浸らせ、集めた力で様々な天変地異を起こしたらしい。
			WSTR:(K++) = ……どこかで聞いたような力だ。%CALLNAME:PLAYER%はその絵に背を向けて、壁画の通路を後にする。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 覇空戦争の様子を描いた壁画がある。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_13_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_3")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "15_5")
	CASE "マスイベント"
		;分かれ道
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			SETBIT ダンジョン構造配列_名前を亡くした遺跡:15:3, 3
			CALL 画面再描画
			WSTR:(K++) = 君たちが道を進んでいると、前方から強烈なプレッシャーを感じた！！
			WSTR:(K++) = どうやらこのダンジョンに似つかわしくない強敵がこの先に潜んでいるようだ…
			KSTR:(K++) = 相当腕に自信がなければ、近づかない方が良いだろう。_PAGE
			WSTR:(K++) = 恐らく、_COLOR_%カラーパレット_HTML("真っ赤")%_Lv25前後_は無いと厳しいだろう。
			WSTR:(K++) = 幸い、遺跡の奥へは別の道が続いている。まずはそちらに向かおう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSEIF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:15:3, 4)
			;強敵撃破後
			KSTR:(K++) = 強敵は既に打倒した。
		ELSE
			KSTR:(K++) = 強敵の気配を感じる……_COLOR_%カラーパレット_HTML("真っ赤")%_Lv25前後_は無いと厳しいだろう。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_13_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_6")
	CASE "マスイベント"
		;なんもない通路
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 狭い通路に、ゴブリンの荷物が雑多に放置されている。
			WSTR:(K++) = 荷物と言ってもほとんどはガラクタだ。めぼしいものはない。
			WSTR:(K++) = しかし、荷物を保持出来る知能があるということは、ゴブリンたちを統率するリーダーがいるということだ。
			WSTR:(K++) = そのリーダーを倒せば、ゴブリンの群れも追い払うことが出来るだろう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 狭い通路に、ゴブリンの荷物が雑多に放置されている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_13_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF ダンジョン内一時変数:2 == 0
			ダンジョンマス画像URL_重ね表示 = 回復アビ
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		;回復の泉
		IF ダンジョン内一時変数:2
		ELSE
			KSTR:(K++) = 遺跡の一室に、清浄な水が湧く部屋があった。
			KSTR:(K++) = 少し休憩していきますか？
			KSTR:(K++) = （PTメンバー全回復・ダンジョンを一度出るまで消滅）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					KSTR:(K++) = 君たちは遺跡の一室で十分な休息を取り、体力を回復した！
					CALL メッセージ欄表示用関数()
					ダンジョン内一時変数:2 = 1
					FOR LOCAL, 0, 4
						IF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
							BREAK
						ENDIF
						BATTLE_STATE:LOCAL:ＨＰ = BATTLE_STATE:LOCAL:最大ＨＰ
						BATTLE_STATE:LOCAL:ＭＰ = BATTLE_STATE:LOCAL:最大ＭＰ
					NEXT
				CASE "[いいえ]"
					KSTR:(K++) = まだ休憩するほど疲れてはいない。先に進もう。
					CALL メッセージ欄表示用関数()
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_13_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		;魔石の鉱脈
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 扉の奥には、床が破壊された部屋があった。
			WSTR:(K++) = 床下には洞穴が掘られており、中では岩肌がぼんやりと光を放っている。
			WSTR:(K++) = 魔石の鉱脈だ。ゴブリンたちが鍵を掛けていたのは、この魔石で魔力を高めていたからだろう。
			WSTR:(K++) = 幾つか手頃な大きさのものを拝借していこう。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは魔石を５個手に入れた。
			CALL アイテム増減汎用処理("魔石", 5)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = めぼしいものはもう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT



@ダンジョンマス情報_名前を亡くした遺跡_15_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
	CASE "マスイベント"
		;戦わなくてもいい強敵
		;Lv20くらいを想定
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			CALL 強敵マス確認
			SIF RESULT == 1
				RETURN 0
			WSTR:(K++) = %CALLNAME:PLAYER%たちの前に、巨大に成長したキノコの魔物が姿を現す。
			WSTR:(K++) = 怪しく輝く瞳の模様は、まるで本物の目が君たちを睨みつけているかのようだ。
			WSTR:(K++) = 魔物は身を大きく震わせ、%CALLNAME:PLAYER%たちに襲いかかってきた！
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			敵BATTLE_STATE_STR:0:エネミー名 = Lv25_ヒトミダケ
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
				WSTR:(K++) = %CALLNAME:PLAYER%たちはなんとか強敵を打倒することに成功した！
				WSTR:(K++) = 強敵は幾つかの装飾品と、財宝を持っていた。
				WSTR:(K++) = ヒトミダケから「魅惑食いの指輪」を手に入れた！
				WSTR:(K++) = ヒトミダケから「誘惑の耳飾り」を手に入れた！
				WSTR:(K++) = ヒトミダケから50,000ルピを手に入れた！
				MONEY += 50000
				CALL 汎用指輪取得処理("魅惑食いの指輪", 3)
				CALL 汎用耳飾り取得処理("誘惑の耳飾り")
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ELSEIF RESULT == -1
				;逃走時
				WSTR:(K++) = %CALLNAME:PLAYER%たちはなんとか強敵から逃げ出すことに成功する。
				WSTR:(K++) = 次はもう少し強くなってから挑戦しよう…
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ENDIF
		ELSE
			KSTR:(K++) = 強敵は既に打倒した後だ。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_15_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 15
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		;16-0へ
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道に粗雑なバリケードが貼られている。
			WSTR:(K++) = 簡単に壊せるようなガラクタではあるが、陣地の概念を持つということは高位のゴブリンがいるということだ。
			WSTR:(K++) = 流石にゴブリンキングほどの大物ではないだろうが、警戒するに越したことはない。
			WSTR:(K++) = 気をつけて進もう。
			;移動直後はマスイベント発動しないので、移動先のルート開放をここで行う
			CALL 接続ルート全開放処理(16, 0)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ENDIF
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 0
		;移動直後はマスイベント発動しないので、移動先のマス開放をここで行う
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_16_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_1")
	CASE "マスイベント"
		;15-5へ
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 15
		ダンジョン現在位置:1 = 5
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_16_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 16
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
	CASE "マスイベント"
		;31-1へ
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 31
		ダンジョン現在位置:1 = 1
		CALL 接続ルート全開放処理(31, 1)
		CALL 踏破マス開放処理
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_17_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = エネミーアイコン
		ENDIF
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "17_5")
	CASE "マスイベント"
		;ゴブリン拠点発見、潰す場合は連戦
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
			KSTR:(K++) = ゴブリンの姿はもうない。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			WSTR:(K++) = 遺跡の中に、広い円状の部屋を見つけた。
			WSTR:(K++) = 礼拝に使われていたのだろうか、壁には精緻な彫刻が見て取れる。
			WSTR:(K++) = しかし、今はゴブリンたちに占拠されてしまっているようだ。
			KSTR:(K++) = 獣の皮や食料を持ち込み、我が物顔で拠点として使われてしまっている。_PAGE
			WSTR:(K++) = ここのゴブリンたちを追い払えば、ゴブリンのボスと戦う時に邪魔される心配が無くなるだろう。
			WSTR:(K++) = だが相手の数が多い。戦いを挑むのならば連戦になる。
			KSTR:(K++) = 魔物の群れと戦いますか？（３連戦）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
					敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリンソルジャー
					敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
					CALL 雑魚敵遭遇汎用処理
					IF RESULT == 0
						敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
						敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
						敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンソルジャー
						CALL 雑魚敵遭遇汎用処理
						IF RESULT == 0
							敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
							敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
							敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
							敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
							敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
							CALL 雑魚敵遭遇汎用処理
							IF RESULT == 0
								SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
								CALL 接続ルート全開放処理(マス深度, マス分岐)
								CALL 口上変数初期化
								WSTR:(K++) = 君たちはゴブリンを追い払い、拠点を制圧した。
								KSTR:(K++) = 残りのゴブリンは散り散りに遺跡の外へと逃げ去っていった。もう戻ってくることはないだろう。
								CALL メッセージ欄表示用関数()
							ENDIF
						ENDIF
					ENDIF
					CALL 口上変数初期化
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT

		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_17_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 17
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		;ゴブリンの物資
		;どっかから奪ってきた指輪と耳飾り発見
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = ゴブリンの拠点の奥を探索すると、食料などの物資が貯蔵されていた。
			WSTR:(K++) = ほとんどはガラクタで使い道は無さそうだが……
			WSTR:(K++) = ……幾つか使えそうな装備を見つけた。貰っていこう。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは偉勲の指輪・力を手に入れた。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは疾風の耳飾りを手に入れた。
			CALL 汎用指輪取得処理("偉勲の指輪・力", 2)
			CALL 汎用耳飾り取得処理("疾風の耳飾り")
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = めぼしいものはもう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_18_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 18
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "19_2")
	CASE "マスイベント"
		;分かれ道
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道が二手に分かれている。
			WSTR:(K++) = 遺跡の構造からして、下側の道が奥へと続く道だろう。
			WSTR:(K++) = ただし、その先からは多くのゴブリンの気配を感じる。
			WSTR:(K++) = 体力を消耗しているなら回復してから進んだ方が良いかもしれない。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 道が二手に分かれている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_18_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 18
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
	CASE "マスイベント"
		;瓦礫に潰されて上手く動けないゴーレム
		;助けてあげるとゆぐゆぐ好感度＋
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路横の部屋を覗くと、そこは天井が崩れて瓦礫で埋まってしまっていた。
			WSTR:(K++) = その瓦礫の下にはゴーレムがうつ伏せに倒れている。
			WSTR:(K++) = 壊れているわけではないが、瓦礫が重たくて動けないようだ。
			KSTR:(K++) = 瓦礫をどかしてやれば再び動けるようになるだろうが……。_PAGE
			KSTR:(K++) = %CALLNAME:PLAYER%は……
			KSTR:(K++) = BUTTON_[襲いかかられては危険だ。このままにしておく]
			KSTR:(K++) = BUTTON_[瓦礫をどかしてゴーレムを助けてあげる]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[襲いかかられては危険だ。このままにしておく]"
					CALL 口上変数初期化
					WSTR:(K++) = ゴーレムは強敵だ。無力化出来ているならそれに越したことはない。
					WSTR:(K++) = %CALLNAME:PLAYER%たちは瓦礫をそのままにして部屋を後にする。
					CALL メッセージ欄表示用関数(,,,0)
				CASE "[瓦礫をどかしてゴーレムを助けてあげる]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%たちは瓦礫を苦労してどかし、ゴーレムを自由にした。
					WSTR:(K++) = 動けるようになったゴーレムは起き上がり、君たちのことをじっと見ている。
					WSTR:(K++) = 襲いかかってくる様子はないようだ。
					WSTR:(K++) = 攻撃してこないのなら戦う理由もない。君たちはゴーレムに手を振り、部屋を後にした。
					SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
					ゆぐゆぐ信頼度_名前を亡くした遺跡 += 10
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL 口上変数初期化
		ELSE
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
				;ゴーレムを助けた
				KSTR:(K++) = ゴーレムは君たちのことをじっと見ている。
			ELSE
				;ゴーレムを放置した
				KSTR:(K++) = ゴーレムはうつ伏せに倒れたままだ。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_18_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 18
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "16_8")
	CASE "マスイベント"
		;ゴブリンの死体とゴーレムの破片
		;罠、魔物知識
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路にゴーレムの破片とゴブリンの死体が転がっている。
			CALL 知識技能所持者検索("魔物知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は今は通らない方がいいと話し、皆で少し様子を見ることにした。
				WSTR:(K++) = …………しばらく待つと、違うゴブリンが仲間の死体を回収しようと近づいてきた。
				KSTR:(K++) = ゴーレムの破片はその途端に爆発し、生きているゴブリンをふっとばした！_PAGE
				WSTR:(K++) = ゴーレムは敵を倒した後に自身の損傷が致命的な場合、こうやって自身を罠にすることがあるらしい。
				WSTR:(K++) = %CALLNAME:PLAYER%たちは油断していては危ないと、気を引き締めて探索を再開した。
			ELSE
				WSTR:(K++) = %CALLNAME:PLAYER%たちがそこに近づくと、ゴーレムの破片がいきなり爆発した！！
				WSTR:(K++) = 全員のＨＰが１５０減少した！
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＨＰ = MAX(BATTLE_STATE:LOCAL:ＨＰ - 150, 0)
				NEXT
				WSTR:(K++) = どうやら損傷したゴーレムが最後の力で自らを罠と化したらしい。
				WSTR:(K++) = 魔物の知識があれば危険を察知出来たかもしれないが……
				WSTR:(K++) = %CALLNAME:PLAYER%たちは厄介な習性もあるものだと思いながら、探索を再開した。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			KSTR:(K++) = もう通路には何も残っていない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_19_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 19
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "20_4")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "17_4")
	CASE "マスイベント"
		;ゴブリン
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 遺跡の奥の方まで来たからか、ゴブリンたちの数も多くなってきている。
				WSTR:(K++) = 特に盾を持っているゴブリンは味方をかばってきて邪魔だ。
				WSTR:(K++) = 全体を攻撃する技か、かばうを無視して攻撃出来る技があると便利かもしれない。
				WSTR:(K++) = そう思いながら、君たちは眼の前のゴブリンたちとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_19_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 19
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "21_8")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "18_7")
	CASE "マスイベント"
		;ゴブリン部隊
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 遺跡の奥の方まで来たからか、ゴブリンたちの数も多くなってきている。
				WSTR:(K++) = 特に盾を持っているゴブリンは味方をかばってきて邪魔だ。
				WSTR:(K++) = 全体を攻撃する技か、かばうを無視して攻撃出来る技があると便利かもしれない。
				WSTR:(K++) = そう思いながら、君たちは眼の前のゴブリンたちとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_20_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		;弱気なゴブリン
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 狭い脇道を進むと、何やら妙なゴブリンがいた。
			WSTR:(K++) = 武器を持っておらず、背中のカバンにガラクタをぱんぱんに詰め込んでいる。
			KSTR:(K++) = 君たちの姿を見ると、ゴブリンは驚いて逃げ出してしまった。_PAGE
			WSTR:(K++) = あれは何だったのだろうか。
			WSTR:(K++) = ……逃げた際にアイテムを落としていったようだ。
			WSTR:(K++) = %CALLNAME:PLAYER%たちはありふれた娯楽本を手に入れた。
			CALL 素材入手処理("ありふれた娯楽本", 1)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = めぼしいものはもう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_20_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 20
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "21_5")
	CASE "マスイベント"
		;ゴブリンとマイコニドが戦っている
		;奇襲すれば全滅出来る
		;ゴブリンだけ倒すとマイコニドからお礼のきのこがもらえる
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 道の先から戦闘音が聞こえる……。
			WSTR:(K++) = こっそりと影から覗いてみると、ゴブリンたちとマイコニドたちが争っているようだ。
			WSTR:(K++) = マイコニドたちの後ろには、小さなマイコニドがいる。子供を守っているらしい。
			KSTR:(K++) = 両者は戦闘に夢中になっている。今奇襲を掛ければ損耗なくどちらも全滅させることが出来るだろう。_PAGE
			KSTR:(K++) = %CALLNAME:PLAYER%は……
			KSTR:(K++) = BUTTON_[漁夫の利だ。両方とも倒す]
			KSTR:(K++) = BUTTON_[子を守る親は悪くない。義によってマイコニドに助太刀いたす]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[漁夫の利だ。両方とも倒す]"
					CALL 口上変数初期化
					WSTR:(K++) = 下手に残して敵対されても面倒だ。
					WSTR:(K++) = %CALLNAME:PLAYER%たちは奇襲し、両方ともを全滅させた。
					WSTR:(K++) = 子供のマイコニドは逃げていったが、敵対しないのなら問題ないだろう。
					CALL メッセージ欄表示用関数(,,,0)
				CASE "[子を守る親は悪くない。義によってマイコニドに助太刀いたす]"
					CALL 口上変数初期化
					WSTR:(K++) = %CALLNAME:PLAYER%たちはゴブリンの後方から奇襲し、マイコニドたちと挟撃を行う。
					WSTR:(K++) = 混乱したゴブリンたちはロクな抵抗も出来ずに壊滅した。
					KSTR:(K++) = 残ったマイコニドたちはしばらくこちらを警戒していたが、敵対しないとわかると
					WSTR:(K++) = お辞儀をするかのように体をぺこりと折り曲げている。
					KSTR:(K++) = 更にお礼のつもりなのか、幾つかのキノコをこちらに差し出してきた。_PAGE
					WSTR:(K++) = 人里でも食べられているポピュラーなキノコだ。せっかくなので頂いていこう。
					WSTR:(K++) = %CALLNAME:PLAYER%たちはおいしいキノコを３つ手に入れた！
					CALL 素材入手処理("おいしいキノコ", 3)
					SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
					ゆぐゆぐ信頼度_名前を亡くした遺跡 += 10
					CALL メッセージ欄表示用関数(,,,0)
				CASEELSE
					CLEARLINE 1
					REUSELASTLINE  
					GOTO LOOP_MESSAGE
			ENDSELECT
			CALL 口上変数初期化
			CALL 接続ルート全開放処理(マス深度, マス分岐)
		ELSE
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4)
				;マイコニドを助けた
				KSTR:(K++) = マイコニドたちが見送ってくれている。
			ELSE
				;全滅させた
				KSTR:(K++) = 激しい戦闘の跡が残っている。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_21_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 21
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "22_5")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "19_6")
	CASE "マスイベント"
		;強敵がいるけど行く？みたいな前フリとザコ敵
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 通路を塞ぐように横に並んだゴブリンたちの姿がある。
				WSTR:(K++) = ゴブリンたちは移動する気配はなく、奥にいるなにかを守っているかのようだ。
				WSTR:(K++) = 恐らくはこの奥にゴブリンたちのリーダーがいるのだろう。
				WSTR:(K++) = 蹴散らさねければ先には進めないようだ。君たちは眼の前のゴブリンたちとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:7:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:9:エネミー名 = Lv8_ゴブリンシールダー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:7:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:9:エネミー名 = Lv8_ゴブリンシールダー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_21_8(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 21
マス分岐 = 8

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
	CASE "マスイベント"
		;壁画発見
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 覇空戦争時代の壁画がある。
			WSTR:(K++) = 星晶獣と戦う時の心構えや戦法が彫られているようだ。
			WSTR:(K++) = ……%CALLNAME:PLAYER%たちは壁画を見て、戦いへの造詣を深めた！
			WSTR:(K++) = %CALLNAME:PLAYER%たちは経験値を1000手に入れた！
			FOR LOCAL, 0, 4
				SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
					CONTINUE
				基礎BATTLE_STATE:(BATTLE_STATE:LOCAL:キャラ登録番号):蓄積EXP += 1000
				CALL レベルアップ処理(BATTLE_STATE:LOCAL:キャラ登録番号)
			NEXT
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 覇空戦争時代の壁画がある。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_22_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 22
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF ダンジョン内一時変数:4 == 0
			ダンジョンマス画像URL_重ね表示 = エネミーアイコン_赤
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		;ゴブリンジェネラル
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4) == 0
			CALL 強敵マス確認
			SIF RESULT == 1
				RETURN 0
			IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 5) == 0
				WSTR:(K++) = %CALLNAME:PLAYER%たちが遺跡の奥までたどり着くと、無骨な鎧に身を包んだゴブリンが配下と共に君たちを待っていた。
				WSTR:(K++) = 通常のゴブリンよりも大きな体躯を持ったそれは、ぎろりと%CALLNAME:PLAYER%を睨みつける。
				WSTR:(K++) = 「遺跡の制圧を妨害しているのは、お前たちか」
				KSTR:(K++) = 「なぜ邪魔をする？　この島に人間はいない。弱腰の星晶獣が一匹住み着いているだけの遺跡だぞ」_PAGE
				WSTR:(K++) = %CALLNAME:PLAYER%はその星晶獣に頼み事がある。お前たちを叩き出せば恩を売れるかもしれない、と返す。
				WSTR:(K++) = 「なるほど、その身勝手さ。まさに人間だな」
				WSTR:(K++) = 他人の住処を勝手に占拠しようとするのは身勝手ではないのか？
				WSTR:(K++) = 「違うさ、ゴブリンの文化ではな。強いものが全てを得る権利を持つ」
				WSTR:(K++) = 「故に人間。我らを追い出したいのなら、力で上回るのだな！」
				WSTR:(K++) = 鎧のゴブリンが巨大な剣を構え、配下とともに君たちへと戦いを挑んでくる！
				SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 5
			ELSE
				WSTR:(K++) = 「またも訪れたか人間」
				WSTR:(K++) = 「何度来ようと同じことよ。幾度でも叩きのめしてくれる！」
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			敵BATTLE_STATE_STR:2:エネミー名 = Lv14_ゴブリンジェネラル
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:6:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:7:エネミー名 = Lv8_ゴブリンソルジャー
			CALL BATTLE_MAIN_LOOP
			IF RESULT == 0
				;勝利時
				ダンジョン表示モード = マップ画面
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%はゴブリンジェネラルの討伐に成功した！！
				LOCAL = RAND:5
				SELECTCASE LOCAL
					CASE 0
						WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・重」を手に入れた！
						CALL 汎用指輪取得処理("偉勲の指輪・重", 1)
					CASE 1
						WSTR:(K++) = ブリンジェネラルから「偉勲の指輪・速」を手に入れた！
						CALL 汎用指輪取得処理("偉勲の指輪・速", 1)
					CASE 2
						WSTR:(K++) = ブリンジェネラルから「偉勲の指輪・壁」を手に入れた！
						CALL 汎用指輪取得処理("偉勲の指輪・壁", 1)
					CASE 3
						WSTR:(K++) = ブリンジェネラルから「偉勲の指輪・癒」を手に入れた！
						CALL 汎用指輪取得処理("偉勲の指輪・癒", 1)
					CASE 4
						WSTR:(K++) = ブリンジェネラルから「偉勲の指輪・力」を手に入れた！
						CALL 汎用指輪取得処理("偉勲の指輪・力", 1)
				ENDSELECT
				WSTR:(K++) = ゴブリンジェネラルから「猛禽の耳飾り」を手に入れた！
				CALL 汎用耳飾り取得処理("猛禽の耳飾り")
				CALL メッセージ欄表示用関数()
				探索中全体カウント:追加信頼度 += 1000
				SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
				ダンジョン内一時変数:4 = 1
				CALL 口上変数初期化
				WSTR:(K++) = 「……負けたか。ならば力の論理に従い、この遺跡から撤収しよう」
				WSTR:(K++) = 「人間、お前の顔は覚えたぞ」
				WSTR:(K++) = 「いずれまた、この借りは返させてもらう」
				KSTR:(K++) = ゴブリンジェネラルは部隊を取りまとめ、遺跡から出ていった……_PAGE
				WSTR:(K++) = ……遺跡のどこかで、仕掛けが動いたような音がした。
				WSTR:(K++) = COLOR_%カラーパレット_HTML("真っ赤")%_どこかで変化が起こっているかもしれない。
				WSTR:(K++) = 今まで回った場所をもう一度見てみよう。
				ゆぐゆぐ信頼度_名前を亡くした遺跡 += 30
				CALL メッセージ欄表示用関数(,,,0)
			ELSEIF RESULT == 1
				;全滅時
				ダンジョン表示モード = マップ画面
				CALL 口上変数初期化
				KSTR:(K++) = %CALLNAME:PLAYER%は力尽きた仲間たちを連れ、なんとか逃げ出した…
				CALL メッセージ欄表示用関数()
				ダンジョン終了状況 = 全滅
			ELSEIF RESULT == -1
				;逃走時
				ダンジョン表示モード = マップ画面
			ENDIF
			CALL 口上変数初期化
		ELSE
			IF ダンジョン内一時変数:4 == 0
				KSTR:(K++) = ゴブリンジェネラルとの戦いの記憶を思い起こしますか？
				KSTR:(K++) = （ボスと再戦）
				KSTR:(K++) = BUTTON_[はい]
				KSTR:(K++) = BUTTON_[いいえ]
				CALL メッセージ欄表示用関数(,,,0)
				$LOOP_MESSAGE2
				INPUTS
				SELECTCASE RESULTS
					CASE "[はい]"
						敵BATTLE_STATE_STR:2:エネミー名 = Lv14_ゴブリンジェネラル
						敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリンソルジャー
						敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
						敵BATTLE_STATE_STR:6:エネミー名 = Lv8_ゴブリンソルジャー
						敵BATTLE_STATE_STR:7:エネミー名 = Lv8_ゴブリンソルジャー
						CALL BATTLE_MAIN_LOOP
						IF RESULT == 0
							;勝利時
							ダンジョン表示モード = マップ画面
							CALL 口上変数初期化
							WSTR:(K++) = %CALLNAME:PLAYER%はゴブリンジェネラルの討伐に成功した！！
							LOCAL = RAND:5
							SELECTCASE LOCAL
								CASE 0
									WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・重」を手に入れた！
									CALL 汎用指輪取得処理("偉勲の指輪・重", 1)
								CASE 1
									WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・速」を手に入れた！
									CALL 汎用指輪取得処理("偉勲の指輪・速", 1)
								CASE 2
									WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・壁」を手に入れた！
									CALL 汎用指輪取得処理("偉勲の指輪・壁", 1)
								CASE 3
									WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・癒」を手に入れた！
									CALL 汎用指輪取得処理("偉勲の指輪・癒", 1)
								CASE 4
									WSTR:(K++) = ゴブリンジェネラルから「偉勲の指輪・力」を手に入れた！
									CALL 汎用指輪取得処理("偉勲の指輪・力", 1)
							ENDSELECT
							CALL メッセージ欄表示用関数()
							ダンジョン内一時変数:4 = 1
							探索中全体カウント:追加信頼度 += 1000
						ELSEIF RESULT == 1
							;全滅時
							ダンジョン表示モード = マップ画面
							CALL 口上変数初期化
							KSTR:(K++) = %CALLNAME:PLAYER%は力尽きた仲間たちを連れ、なんとか逃げ出した…
							CALL メッセージ欄表示用関数()
							ダンジョン終了状況 = 全滅
						ELSEIF RESULT == -1
							;逃走時
							ダンジョン表示モード = マップ画面
						ENDIF
						CALL 口上変数初期化
					CASE "[いいえ]"
						CALL 口上変数初期化
					CASEELSE
						CLEARLINE 1
						REUSELASTLINE  
						GOTO LOOP_MESSAGE2
				ENDSELECT
			ENDIF
		ENDIF
ENDSELECT




@ダンジョンマス情報_名前を亡くした遺跡_25_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 25
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "26_1")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "26_3")
	CASE "マスイベント"
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 6
		ダンジョン現在位置:1 = 8
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_26_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 26
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "27_1")
	CASE "マスイベント"
		;ゴブリン部隊
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = ゴブリンたちが獣を狩って食料を調達している姿が見える。
				WSTR:(K++) = 食料調達班なのか、獣だけでなくキノコや果実なども大量に集めているようだ。
				WSTR:(K++) = 食べ物を探して周囲をうろつくゴブリンをやり過ごすことは難しそうだ。蹴散らして進もう。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンソルジャー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンシールダー
			敵BATTLE_STATE_STR:5:エネミー名 = Lv8_ゴブリンソルジャー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_26_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 26
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "27_5")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路には戦闘があったような跡が残っている。
			WSTR:(K++) = ゴブリンたちと在来の魔物が戦った跡だろうか？
			WSTR:(K++) = ……いや、折れた矢が何本か転がっている。ゴブリンアーチャーはこれまでの道中で見なかったはずだ。
			WSTR:(K++) = 道の先に誰かがいるのかもしれない。慎重に進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 折れた矢が転がっている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_27_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 27
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "27_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "29_0")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 居住区と思しきこの区画には多くの部屋があるが、家具の類は殆ど残っていない。
			WSTR:(K++) = 元の所有者が去った時に持ち去ったのか、盗掘者に持っていかれてしまったのか。
			WSTR:(K++) = どちらにせよ、何も残っていない寂しい場所だ。土の星晶獣はなぜこんなところに住んでいるのだろうか。
			WSTR:(K++) = 歴史に思いを馳せながら、%CALLNAME:PLAYER%たちは更に奥へと進む。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 特に何も残っていない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_27_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 27
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		IF ダンジョン内一時変数:3 == 0
			ダンジョンマス画像URL_重ね表示 = えっちハート
		ENDIF
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_3")
	CASE "マスイベント"
		;えっちイベ
		CALL 口上変数初期化
		SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
		IF ダンジョン内一時変数:3
		ELSE
			CALL ダンジョンハプニング基本処理()
			IF RESULT
				ダンジョン内一時変数:3 = 1
			ENDIF
			CALL 口上変数初期化
		ENDIF
		CALL 接続ルート全開放処理(マス深度, マス分岐)
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_27_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 27
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "28_6")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "29_5")
	CASE "マスイベント"
		;ゴブリン部隊
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 道を進むと、何かを探している様子のゴブリンたちを見つけた。
				WSTR:(K++) = ゴブリンたちの話をこっそり聞いてみるとしきりに「メス！メス！」と喚いている。
				WSTR:(K++) = ゴブリン種のメスが近くにいるのだろうか？
				WSTR:(K++) = どちらにせよ、遺跡の探索には邪魔だ。君たちはゴブリンとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:0:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:2:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_28_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "29_2")
	CASE "マスイベント"
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = この辺りは劣化が激しいのか、遺跡の損傷も多くなってきた。
			WSTR:(K++) = 床材が剥がれて土が見えている程度ならともかく、陥没して大穴が開いているところもある。
			WSTR:(K++) = 罠ならともかく、床の崩れで怪我をするのも馬鹿らしい。気をつけて進もう。
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 劣化が激しいのか、遺跡の損傷も多くなってきた。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_28_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 28
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "29_6")
	CASE "マスイベント"
		;魔法罠
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = %CALLNAME:PLAYER%たちが通路を進んでいると、いきなり足元に魔法陣が現れた！
			CALL 知識技能所持者検索("魔法知識", 1)
			LOCAL = RESULT
			IF LOCAL > -1
				WSTR:(K++) = %CALLNAME:LOCAL%は咄嗟に魔力を放出し、魔法陣の効果を打ち消す。
				WSTR:(K++) = どうやらここに仕掛けられていたのは「ぼんやりする魔法」のようだ。
				KSTR:(K++) = 引っかかっていたら、魔力を大きく損耗していたところだった。_PAGE
			ELSE
				WSTR:(K++) = 魔法陣は「ぼんやりする魔法」を発動した！
				WSTR:(K++) = 効果に抵抗するため、全員のＭＰが５０減少した。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				FOR LOCAL, 0, 4
					SIF BATTLE_STATE:LOCAL:キャラ登録番号 < 1
						CONTINUE
					BATTLE_STATE:LOCAL:ＭＰ = MAX(BATTLE_STATE:LOCAL:ＭＰ - 50, 0)
				NEXT
			ENDIF
			WSTR:(K++) = この魔法陣は、明らかに低級ゴブリンが仕掛けた罠ではない。
			WSTR:(K++) = むしろゴブリンを追い返すための魔法陣のように思える。
			WSTR:(K++) = 先に進めばこの魔法を仕掛けた者がいるかもしれない。準備をしてから進もう。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 接続ルート全開放処理(マス深度, マス分岐)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = もう魔法陣は動いていない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_29_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 29
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
	CASE "マスイベント"
		;ゴブリン部隊に襲われる獣たち
		;倒すとゆぐゆぐ好感度UP
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4) == 0
			IF 初来訪マス判定用フラグ
				;最初に訪れた時
				WSTR:(K++) = 遺跡の部屋の中で、獣を追いかけ回すゴブリンたちの姿があった。
				WSTR:(K++) = 獣はこの部屋に巣を作っているようで、なんとかゴブリンたちを追い返そうと威嚇している。
				WSTR:(K++) = どちらにせよゴブリンたちは探索の邪魔だ。君たちはゴブリンとの戦いを始める。
			ELSE
				;まだ倒してない
				WSTR:(K++) = ゴブリンたちは肉を焼いて食事の準備をしているようだ。
				WSTR:(K++) = 君たちは再びゴブリンとの戦いを始める。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)

			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:6:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵遭遇汎用処理
			IF RESULT == 0
				;勝利時のみ進行
				CALL 接続ルート全開放処理(マス深度, マス分岐)
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:マス深度:マス分岐, 4
				IF 初来訪マス判定用フラグ
					;初来訪の時に勝利したなら信頼度＋
					ゆぐゆぐ信頼度_名前を亡くした遺跡 += 10
				ENDIF
			ENDIF
		ELSE
			敵BATTLE_STATE_STR:1:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv8_ゴブリンソルジャー
			敵BATTLE_STATE_STR:4:エネミー名 = Lv8_ゴブリントラッパー
			敵BATTLE_STATE_STR:6:エネミー名 = Lv8_ゴブリントラッパー
			CALL 雑魚敵繰り返し戦闘処理
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_29_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 29
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 会話アイコン
	CASE "接続先"
	CASE "マスイベント"
		;向こう側になんかあるけどこっから行けないなー的な
		;30-2を表示だけする
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:30:2, 2)
				WSTR:(K++) = あちら側から見た通り、部屋のこっち側には特に何もないようだ。
				WSTR:(K++) = 探索に戻ろう。
			ELSE
				WSTR:(K++) = 部屋に入ると、なんと中央が完全に崩落してしまっていた。
				WSTR:(K++) = 地下の洞窟にでも繋がってしまったのか、底が見えないくらいに穴は深い。
				KSTR:(K++) = 向こう側に進むことは難しいだろう。_PAGE
				WSTR:(K++) = しかし、崩落で区切られた向こう側には状態の良さそうな像や壺などがあるように見える……。
				WSTR:(K++) = 崩落したことで逆に盗掘から逃れられたのだろうか。違う場所からぐるりと回り込んでみよう。
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:30:2, 3
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = 部屋の中央が崩落してしまっている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_29_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 29
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		;プレゼントアイテム
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			WSTR:(K++) = 通路の突き当りには地下に進む階段があった。
			WSTR:(K++) = 階段を降りてみると、小さな部屋に続いている。部屋の中はなんとなく上よりも涼しい気がする。
			KSTR:(K++) = 部屋の隅に、厳重に封がされた樽が一つだけ残されている……_PAGE
			WSTR:(K++) = ……どうやら遥か昔に仕込まれた醸造酒のようだ。
			WSTR:(K++) = 腐敗臭などはしない。正しく熟成した上物のワインだろう。
			WSTR:(K++) = このままここで朽ち果てさせるには余りにももったいない。回収していこう。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは100年物のワインを手に入れた。
			CALL 素材入手処理("100年物のワイン", 1)
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = めぼしいものはもう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_名前を亡くした遺跡_29_6(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 29
マス分岐 = 6

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
	CASE "マスイベント"
		;フィーナとミニゴブ登場
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[ゴブリンハンター]フィーナ"),100,,,1,1)
			LOCALS = %立ち絵リソース記録%
			;最初に訪れた時
			WSTR:(K++) = 突き当りの部屋に入ると、突然奥から矢が飛んでくる！
			WSTR:(K++) = %CALLNAME:(BATTLE_STATE:0:キャラ登録番号)%がその矢を弾くと、驚いたような声が響いてきた。
			WSTR:(K++) = 「あっちゃ、ごめん！　てっきりゴブリンが押し入ってきたのかと……」
			WSTR:(K++) = たはは、と苦笑いしながら部屋にいた少女が謝罪してくる。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「アタシはゴブリンハンターのフィーナ」
			WSTR:(K++) = 「ここの遺跡に住み着いたゴブリンの討伐に来てたんだけど……ちょっと予定外のことが起こってさ」
			CALL メッセージ欄表示用関数(LOCALS,"フィーナ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = フィーナと名乗った少女の後ろには、小さな子供がいる。
			WSTR:(K++) = 緑のローブと輝く宝石が付いた杖を持つ姿は魔法使いのようだ。
			WSTR:(K++) = 一見して人間のようだが、耳は長く尖っている。
			WSTR:(K++) = どうにも、ゴブリンの雌のように見えるが……。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「この子、ミニゴブっていうんだけど」
			WSTR:(K++) = 「ここのゴブリンたちのリーダーに、無理やり嫁にされそうになってたの」
			WSTR:(K++) = 「こんなに小さい子に酷いと思うでしょ？」
			WSTR:(K++) = 「だからちょっと……攫ってきちゃった☆」
			CALL メッセージ欄表示用関数(LOCALS,"フィーナ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ゴブリンハンターとしてそれでいいのか。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「ミニゴブはまだちっちゃい子で悪いことしてないからノーカン！」
			WSTR:(K++) = 「それに本人も嫌がってたし」
			CALL メッセージ欄表示用関数(LOCALS,"フィーナ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = ミニゴブの方を見ると、フィーナの背にぎゅっとしがみついている。
			WSTR:(K++) = フィーナの言うことが真実かはともかく、彼女に懐いていることは間違いないようだ。
			WSTR:(K++) = しかし、そういった経緯なら撤退の支援が必要だろう。
			WSTR:(K++) = 遺跡の外まで送っていこうか、と%CALLNAME:PLAYER%は申し出た。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「えっ、実はこっちからお願いしようかと思ってたんだけど……」
			WSTR:(K++) = 「いいの？　アタシは助かるけど、そっちにだって目的はあるんじゃ」
			CALL メッセージ欄表示用関数(LOCALS,"フィーナ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = もちろんタダではない、と%CALLNAME:PLAYER%は一枚の紙をフィーナに差し出す。
			WSTR:(K++) = リゾートの広告と島の座標が乗ったチラシだ。
			WSTR:(K++) = うちに遊びに来てくれることが条件だ。ついでに知り合いに宣伝してくれると助かる。
			WSTR:(K++) = %CALLNAME:PLAYER%がそう言うと、フィーナは思わず吹き出した。
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「あっはははは！　こんな状況で宣伝って……！」
			WSTR:(K++) = ツボにハマったのか、ひとしきり愉快げに笑って
			WSTR:(K++) = 「OKOK、任せて！　顔なじみにオススメしとくし、アタシも遊びに行くよ」
			WSTR:(K++) = 「天才フィーナちゃんは約束を守るゴブリンハンターだからね！」
			CALL メッセージ欄表示用関数(LOCALS,"フィーナ",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 取引成立だと、%CALLNAME:PLAYER%たちはフィーナたち二人を連れて一旦遺跡の外まで出る。
			WSTR:(K++) = 二人は個人用の艇で近くの島まで撤退するようだ。
			KSTR:(K++) = %CALLNAME:PLAYER%たちはそれを見送り、また探索へと戻る。_PAGE
			WSTR:(K++) = リゾートに[ゴブリンハンター]フィーナが訪れるようになった！
			WSTR:(K++) = リゾートに[純真なる獣人]ミニゴブが訪れるようになった！
			CFLAG:(GETCHARA(122)):招待不可フラグ = 0
			CFLAG:(GETCHARA(123)):招待不可フラグ = 0
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = もう誰もいない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_30_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 30
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;最初に訪れた時
			IF GETBIT(ダンジョン構造配列_名前を亡くした遺跡:29:2, 2)
				;向こう側からこっちを見た事がある
				WSTR:(K++) = %CALLNAME:PLAYER%たちはぐるりと回り込んで大穴の向こう側に来た。
				KSTR:(K++) = あちらから見た通り、古代の像や壺が多く残されている。_PAGE
			ELSE
				WSTR:(K++) = 部屋に入ると、中央辺りの床が崩落して大穴が開いてしまっていた。
				WSTR:(K++) = 向こう側に渡ることは難しいだろう。
				KSTR:(K++) = 部屋の中には古代の像や壺が多く残されている。_PAGE
				SETBIT ダンジョン構造配列_名前を亡くした遺跡:29:2, 3
			ENDIF
			WSTR:(K++) = 流石にこれらを抱えて帰るわけにもいかないが……と周囲を調べていると、耳飾りをつけた像を発見した。
			KSTR:(K++) = 魔力は既に使い切ってしまっているが、邪悪を退ける力がありそうだ。
			WSTR:(K++) = 持ち帰って魔力を充填し直せばまた使えるようになるだろう。
			WSTR:(K++) = %CALLNAME:PLAYER%たちは退魔の耳飾りを手に入れた。
			CALL 汎用耳飾り取得処理("退魔の耳飾り")
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
		ELSE
			KSTR:(K++) = めぼしいものはもう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_31_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 31
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "30_2")
	CASE "マスイベント"
		;16-8へ
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 8
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_33_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 33
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "36_4")
	CASE "マスイベント"
		;7-4へ
		CALL 口上変数初期化
		ダンジョン現在位置:0 = 7
		ダンジョン現在位置:1 = 4
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_名前を亡くした遺跡_36_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 36
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_遺跡
	CASE "接続先"
	CASE "マスイベント"
		;ゆぐゆぐ救出、ダンジョンクリア
		CALL 口上変数初期化
		IF 初来訪マス判定用フラグ
			;立ち絵リソース記録に必要な画像のリソースを生成する
			CALLF 顔グラ表示用文字列関数(キャラ検索("[創樹の守人]ユグドラシル"),100,,,1,1)
			LOCALS = %立ち絵リソース記録%
			;最初に訪れた時
			WSTR:(K++) = 閉じられていた遺跡の道を進むと、ドーム状の巨大な部屋に出た。
			WSTR:(K++) = 日光の差し込む明るい部屋の中心には、巨大な女性が眠りに就いている。
			WSTR:(K++) = 彼女が星晶獣なのだろうか。その非現実感に思わず見つめていると、いきなり目の前に光が集まりだした！
			WSTR:(K++) = 集まった光はヒューマンサイズの大きさにまとまり、巨大な女性と同じ姿の女性に変化する
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 「────」
			CALL メッセージ欄表示用関数(LOCALS,"光から現れた女性",,0)
			CALL 口上変数初期化
			WSTR:(K++) = 女性は言葉が話せないのか、喉から独特の音を鳴らす。
			WSTR:(K++) = しかし、%CALLNAME:PLAYER%にはなんとなく何を話しているのかがわかる……これも星晶獣eraとの契約の影響だろうか……？
			CALL メッセージ欄表示用関数(,,,0)
			CALL 口上変数初期化
			WSTR:(K++) = 女性は、自身が星晶獣ユグドラシルだと名乗った。
			WSTR:(K++) = また、自らが眠る遺跡からゴブリンを追い出してくれたことにお礼を言う。
			WSTR:(K++) = そして何故この遺跡を訪れたのかを問うているようだ。
			CALL メッセージ欄表示用関数(LOCALS,"星晶獣ユグドラシル",,0)
			CALL 口上変数初期化
			IF 温泉作成許可フラグ == 0
				WSTR:(K++) = %CALLNAME:PLAYER%は星晶獣に事情を話す。
				WSTR:(K++) = リゾート地に温泉を誘致したいため、星晶獣の力を借りたいということを。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = ユグドラシルは不思議そうな顔をしながら、了承の意図を籠めて頷く。
				WSTR:(K++) = 更に%CALLNAME:PLAYER%の隣に並び、移動を促した。
				WSTR:(K++) = 写身と共にリゾートへと来てくれるようだった。
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣ユグドラシル",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 協力が得られるのなら早い方がいい。
				KSTR:(K++) = %CALLNAME:PLAYER%は早速星晶獣ユグドラシルを連れてリゾートへと戻ることにした。_PAGE
				WSTR:(K++) = リゾートに[創樹の守人]ユグドラシルが訪れるようになった！
				WSTR:(K++) = 施設改造に「温泉系列を改装」が解放された！
				WSTR:(K++) = 道具屋に「土の魔石」が追加された！
				WSTR:(K++) = 名前を亡くした遺跡をクリアしました、帰還します。
				温泉作成許可フラグ = 1
				CALL イベント完了フラグ汎用処理("【条件確認】温泉を作るために")
				CALL メッセージ欄表示用関数(,,,0)
			ELSE
				WSTR:(K++) = %CALLNAME:PLAYER%は星晶獣に事情を話す。
				WSTR:(K++) = リゾート地に温泉を作るので、その参考になるだろうと勧められて来たのだと。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = ユグドラシルは不思議そうな顔をしながら、理解の意図を籠めて頷く。
				WSTR:(K++) = 「────」
				WSTR:(K++) = 彼女が何かを呟くと、部屋の床が音を立てて動き始めた！
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣ユグドラシル",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 床に開いた亀裂の奥を見ると、地面から熱い湯が湧いている様子が見える。
				WSTR:(K++) = 源泉の位置を自由に動かす術らしい。これは温泉の運営に使えそうだ！
				WSTR:(K++) = %CALLNAME:PLAYER%は温泉を自由に引く術を学んだ！
				WSTR:(K++) = 温泉施設による滞在キャラ上限が＋１０された！
				CALL 滞在可能キャラ数再計算
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「────」
				WSTR:(K++) = 再びユグドラシルの意図が%CALLNAME:PLAYER%に伝わる。
				WSTR:(K++) = どうやらリゾート島に興味があるようだ。
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣ユグドラシル",,0)
				CALL 口上変数初期化
				WSTR:(K++) = 星晶獣でもお客様は大歓迎だ。
				WSTR:(K++) = %CALLNAME:PLAYER%はユグドラシルにリゾート島の座標を伝え、いつでも歓迎すると告げる。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
				WSTR:(K++) = 「────♪」
				WSTR:(K++) = 喜んでくれているようだ。きっと近い内にリゾートを訪れてくれるだろう。
				WSTR:(K++) = リゾートに[創樹の守人]ユグドラシルが訪れるようになった！
				CALL メッセージ欄表示用関数(LOCALS,"星晶獣ユグドラシル",,0)
				CALL 口上変数初期化
				WSTR:(K++) = %CALLNAME:PLAYER%はユグドラシルと別れ、遺跡を後にする。
				WSTR:(K++) = 名前を亡くした遺跡をクリアしました、帰還します。
				CALL メッセージ欄表示用関数(,,,0)
				CALL 口上変数初期化
			ENDIF
			LOCAL = GETCHARA(124)
			CFLAG:LOCAL:招待不可フラグ = 0
			CFLAG:LOCAL:信頼度 = ゆぐゆぐ信頼度_名前を亡くした遺跡 * 200
			CALL FAVOR_LvUPCheck(LOCAL)
			CALL 口上変数初期化
			ダンジョン終了状況 = 討伐達成
			ダンジョンクリアフラグ_名前を亡くした遺跡 = 1
		ELSE
			KSTR:(K++) = 星晶獣ユグドラシルの本体が眠りについている。
			CALL メッセージ欄表示用関数(,,,0)
		ENDIF
		CALL 画面再描画
ENDSELECT
