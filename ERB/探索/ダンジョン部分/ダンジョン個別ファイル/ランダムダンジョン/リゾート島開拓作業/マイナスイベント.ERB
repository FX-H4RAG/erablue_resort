
@イベント_リゾート島開拓作業_ランダム_不意の地崩れ
#DIM ダメージ量

CALL 口上変数初期化
IF ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 == "イベント完了"
	KSTR:(K++) = 特に変わった様子はない。
	CALL メッセージ欄表示用関数(,,,0)
ELSE
	;最初に訪れた時
	WSTR:(K++) = %CALLNAME:MASTER%たちが探索していると、突然足元の地面が崩れて落ちてしまった！
	WSTR:(K++) = どうやら地下水の浸食かなにかで地中に穴が空いていたようだ。
	WSTR:(K++) = 幸いにしてそれほど深い穴ではなかったが、%CALLNAME:MASTER%たちは少なからず怪我を負ってしまった……
	ダメージ量 = ダンジョン階層記録 * 30
	KSTR:(K++) = 全員のＨＰが{ダメージ量, 4}減少した。
	;HPバーの表示タイミングを調整するためここで一旦メッセージ表示
	CALL メッセージ欄表示用関数()
	CALL 口上変数初期化
	
	CALL 探索中全体ダメージ_ＨＰ_非致死(ダメージ量)
	WSTR:(K++) = %CALLNAME:MASTER%たちは穴から這い上がり、気を取り直して探索を続ける。
	CALL メッセージ欄表示用関数(,,,0)
	
	CALL 接続ルート全開放処理((ダンジョン現在位置:0), (ダンジョン現在位置:1))
	ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 = イベント完了
	CALL 口上変数初期化
ENDIF
CALL 画面再描画

@イベント_リゾート島開拓作業_ランダム_魔物の不意打ち
#DIM ダメージ対象
#DIM ダメージ量

CALL 口上変数初期化
IF ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 == "イベント完了"
	KSTR:(K++) = 特に変わった様子はない。
	CALL メッセージ欄表示用関数(,,,0)
ELSE
	;最初に訪れた時
	WSTR:(K++) = %CALLNAME:MASTER%たちが探索していると、魔物の奇襲を受けてしまった！
	ダメージ対象 = 味方ランダム選出_前衛のみ()
	ダメージ量 = BATTLE_STATE:ダメージ対象:ＨＰ - MAX(1, (BATTLE_STATE:ダメージ対象:ＨＰ * (100 - 60) / 100))
	WSTR:(K++) = なんとか撃退に成功したが、最初の不意打ちで%CALLNAME:(BATTLE_STATE:ダメージ対象:0)%が大きな怪我を負ってしまった……
	KSTR:(K++) = %CALLNAME:(BATTLE_STATE:ダメージ対象:0)%のＨＰが{ダメージ量, 4}減少した。
	;HPバーの表示タイミングを調整するためここで一旦メッセージ表示
	CALL メッセージ欄表示用関数()
	CALL 口上変数初期化
	
	BATTLE_STATE:ダメージ対象:ＨＰ = MAX(1, (BATTLE_STATE:ダメージ対象:ＨＰ * (100 - 60) / 100))
	WSTR:(K++) = %CALLNAME:MASTER%たちは改めて周囲を警戒しながら、気を取り直して探索を続ける。
	CALL メッセージ欄表示用関数(,,,0)
	
	CALL 接続ルート全開放処理((ダンジョン現在位置:0), (ダンジョン現在位置:1))
	ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 = イベント完了
	CALL 口上変数初期化
ENDIF
CALL 画面再描画


@イベント_リゾート島開拓作業_ランダム_魔力災害
#DIM ダメージ量

CALL 口上変数初期化
IF ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 == "イベント完了"
	KSTR:(K++) = 特に変わった様子はない。
	CALL メッセージ欄表示用関数(,,,0)
ELSE
	;最初に訪れた時
	WSTR:(K++) = %CALLNAME:MASTER%たちが探索していると、近くから大きな魔力を感じる……！
	WSTR:(K++) = 自然発生した精霊たちが集まりすぎて、一つに合体しようとしているようだ！
	WSTR:(K++) = このままでは強い魔物が生まれてきてしまうだろう。%CALLNAME:MASTER%たちは魔力を放出し、手分けして精霊を散らしていく。
	ダメージ量 = ダンジョン階層記録 * 15
	KSTR:(K++) = 全員のＭＰが{ダメージ量, 4}減少した。
	;HPバーの表示タイミングを調整するためここで一旦メッセージ表示
	CALL メッセージ欄表示用関数()
	CALL 口上変数初期化
	
	CALL 探索中全体ダメージ_ＭＰ(ダメージ量)
	WSTR:(K++) = どうにか精霊たちを散らすことに成功したようだ。周囲の魔力も通常に戻っている。
	WSTR:(K++) = %CALLNAME:MASTER%たちは安心し、改めて探索に戻った。
	CALL メッセージ欄表示用関数(,,,0)
	
	CALL 接続ルート全開放処理((ダンジョン現在位置:0), (ダンジョン現在位置:1))
	ランダムダンジョン配列:(ダンジョン現在位置:0):(ダンジョン現在位置:1):イベント状態 = イベント完了
	CALL 口上変数初期化
ENDIF
CALL 画面再描画
