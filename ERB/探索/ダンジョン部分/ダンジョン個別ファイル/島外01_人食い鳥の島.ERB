

@ダンジョン初期処理_人食い鳥の島
;ダンジョン構造の読み込み
;0でない時、そのマスは存在する
#DIM 深度
#DIM 分岐

ダンジョンマス画像URL_伏せ状態 = 壁_岩
ダンジョン現在位置:0 = 0
ダンジョン現在位置:1 = 0

;スタート地点は必ず存在し、同深度に分岐無し
;初期からオープン済みなので3を入れるb ++
;ビット0：存在するか　ビット1：移動できるか　ビット2：マスをオープンするか（ビット１をONにしないと無意味）　ビット3：入れないがオープンする場合に使用
;ビット4以降：自由枠。主に宝箱の開閉やイベント達成フラグなどに使用
IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:0:0") == 0
	SETVAR @"ダンジョン構造配列_%ダンジョン名%:0:0", 3
	;巣の数を最初だけセット
	残り巣の数_人食い鳥の島 = 5
ENDIF

FOR 深度, 1, 100
	LOCAL = 0
	FOR 分岐, 0, 9
		IF GETVAR(@"ダンジョン構造配列_%ダンジョン名%:{深度}:{分岐}")
			;既にマス情報が入ってるなら飛ばす
			LOCAL = 1
			CONTINUE
		ELSEIF ENUMFUNCBEGINSWITH(@"ダンジョンマス情報_%ダンジョン名%_{深度}_{分岐}")
			LOCAL = 1
			SETVAR @"ダンジョン構造配列_%ダンジョン名%:深度:分岐", 1
		ENDIF
	NEXT
	IF LOCAL
		ダンジョン最大深度 = 深度
	ENDIF
NEXT

@ダンジョンマス情報_人食い鳥の島_0_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 0
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "1_1")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			IF 残り巣の数_人食い鳥の島 > 0
				KSTR:(K++) = まだ巣は{残り巣の数_人食い鳥の島}つほど残っているようだ。
			ELSE
				KSTR:(K++) = 人食い鳥の群れはもうどこか別の島へと移動したようだ。
			ENDIF
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = %CALLNAME:PLAYER%は人食い鳥の島へと足を踏み入れた。
			WSTR:(K++) = 空を見上げてみれば、大きな鳥が君たちを監視するように近くを飛んでいる。
			WSTR:(K++) = かなり統率の取れた手ごわい群れのようだ。
			WSTR:(K++) = COLOR_C0C070_探索メンバー全員に指輪を装備させておいた方がいいかもしれない。
			KSTR:(K++) = 指輪は空き店舗を装飾品店に改装して購入するか、ストーンイーターを討伐することで手に入る。_PAGE
			WSTR:(K++) = 事前に仕入れた情報によると、この島には少なくとも大型の巣が_COLOR_c07070_５つ_は存在するらしい。
			WSTR:(K++) = 全て潰せば島から人食い鳥たちは去っていくだろう。
			KSTR:(K++) = 島はそれなりに広く、探索するにも手間が掛かりそうだ。地道に進めていこう。
			CALL メッセージ欄表示用関数()
			CALL 口上変数初期化
			SETBIT ダンジョン構造配列_人食い鳥の島:1:1, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_1_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 1
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_2")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "2_4")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 島の内部は荒野が広がっている。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 島の内部は荒野が広がっている。
			WSTR:(K++) = 草や木々は殆ど無く、土や風の魔力を含む魔物が多い。
			WSTR:(K++) = この島に住む人食い鳥たちは魔物や人間を集団で狩る習性を持つ厄介な魔物だ。
			WSTR:(K++) = COLOR_0xc0c070_戦闘が長引くと仲間を呼ぶことがあるかもしれない。
			KSTR:(K++) = 多少無理してでも早めに戦闘を終わらせた方がいいだろう。
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:2:0, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:2:2, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:2:4, 1
		ENDIF
		CALL 画面再描画
ENDSELECT

;---------------------------------------------------------------------------
;上ルート（巣一個）
;洞窟＋門＋魔物使い宝石
;---------------------------------------------------------------------------


@ダンジョンマス情報_人食い鳥の島_2_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_0")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 敵を探しますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:0:エネミー名 = Lv4_人食い鳥
					敵BATTLE_STATE_STR:1:エネミー名 = Lv4_人食い鳥
					CALL 雑魚敵遭遇汎用処理
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					GOTO LOOP_MESSAGE
			ENDSELECT
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			KSTR:(K++) = 荒野を進んでいると、空から人食い鳥が君たちに襲い掛かってきた！
			CALL メッセージ欄表示用関数()

			敵BATTLE_STATE_STR:0:エネミー名 = Lv4_人食い鳥
			敵BATTLE_STATE_STR:1:エネミー名 = Lv4_人食い鳥
			CALL 雑魚敵遭遇汎用処理
			
			SETBIT ダンジョン構造配列_人食い鳥の島:3:0, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_3_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_0")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 荒野の北側には幾つもの岩山、それに空いた洞穴が見える。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			WSTR:(K++) = 荒野を北の方へと進む。
			WSTR:(K++) = 岩山が幾つも並んでおり、山肌には僅かな緑と多くの洞穴が見える。
			WSTR:(K++) = 人食い鳥がそのうちの一つに入っていく姿が見えた……。
			KSTR:(K++) = どうやらこちら側の巣は、洞窟の中にあるらしい。
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			SETBIT ダンジョン構造配列_人食い鳥の島:4:0, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_4_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 岩山を登り、人食い鳥が入っていった洞窟にたどり着く。
			WSTR:(K++) = 幸いにも穴は広く、普通に歩いて内部を探索することが出来るだろう。
			CALL 知識技能所持者検索("魔法知識", 1)
			IF RESULT > -1
				WSTR:(K++) = %CALLNAME:RESULT%は魔術で明かりを付けた。
			ELSE
				WSTR:(K++) = %CALLNAME:PLAYER%は持ってきたたいまつに火を付けた。
			ENDIF
			KSTR:(K++) = 油断せずに探索を進めよう。
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:8:0, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:8:0, 2
			SETBIT ダンジョン構造配列_人食い鳥の島:9:0, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:9:3, 1
		ENDIF
		ダンジョンマス画像URL_伏せ状態 = 壁_洞窟
		ダンジョン現在位置:0 = 8
		ダンジョン現在位置:1 = 0
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_8_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 8
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		ダンジョンマス画像URL_重ね表示 = 左アイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "9_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "9_3")
	CASE "マスイベント"
		ダンジョンマス画像URL_伏せ状態 = 壁_岩
		ダンジョン現在位置:0 = 4
		ダンジョン現在位置:1 = 0
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_9_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 9
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_1")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 洞窟の中は肌寒い。水属性の魔物が住んでいるかもしれない。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟の中は肌寒い。どこからか水が流れる音も聞こえてくる。
			WSTR:(K++) = 近くに地下水の川があるようで、洞窟内部にも水の魔力を多く感じる。
			WSTR:(K++) = COLOR_c0c070_洞窟の中には水属性の魔物が住んでいるかもしれない。
			KSTR:(K++) = 耳飾りで属性を変更すると楽に戦えるだろう。
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:10:1, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_10_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4)
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱_開
		ELSE
			ダンジョンマス画像URL_重ね表示 = 宝箱アイコン_木箱
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4)
			KSTR:(K++) = もう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟の奥に、土の魔力が溜まった鉱石を見つけた。
			WSTR:(K++) = 地下水の川で水の魔力が増えた分、押しのけられた土の魔力が堆積したらしい。
			WSTR:(K++) = 簡単に削って金具を付ければ耳飾りになるだろう。
			KSTR:(K++) = %CALLNAME:PLAYER%は土の耳飾りを手に入れた！
			CALL メッセージ欄表示用関数()
			CALL 汎用耳飾り取得処理("土の耳飾り")

			CALL 口上変数初期化
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_10_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = エネミーアイコン
		ENDIF
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "14_0")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_2")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4)
			KSTR:(K++) = 魔物の姿はもうない。川は安全に渡ることが出来る。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			SETBIT ダンジョン構造配列_人食い鳥の島:11:2, 1
			WSTR:(K++) = 洞窟を進むと地下水の川に行き当たった。川の中には多くの魔物の姿が見える……。
			WSTR:(K++) = COLOR_c0c070_複数回の戦闘になるだろう_が、すべて倒さなければ向こう側に渡ることは難しい。
			KSTR:(K++) = しかし下流に沿って進めば、回り道だが戦いを避けて奥に進むことができるかもしれない。_PAGE
			KSTR:(K++) = 魔物の群れと戦いますか？（３連戦）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:1:エネミー名 = Lv4_水のエレメンタル
					敵BATTLE_STATE_STR:2:エネミー名 = Lv3_スニッパー
					敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
					CALL 雑魚敵遭遇汎用処理
					IF RESULT == 0
						敵BATTLE_STATE_STR:1:エネミー名 = Lv4_水のエレメンタル
						敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
						敵BATTLE_STATE_STR:5:エネミー名 = Lv4_水のエレメンタル
						CALL 雑魚敵遭遇汎用処理
						IF RESULT == 0
							敵BATTLE_STATE_STR:1:エネミー名 = Lv4_水のエレメンタル
							敵BATTLE_STATE_STR:2:エネミー名 = Lv3_スニッパー
							敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
							敵BATTLE_STATE_STR:4:エネミー名 = Lv3_スニッパー
							敵BATTLE_STATE_STR:5:エネミー名 = Lv4_水のエレメンタル
							CALL 雑魚敵遭遇汎用処理
							IF RESULT == 0
								SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
								SETBIT ダンジョン構造配列_人食い鳥の島:14:0, 1
								CALL 口上変数初期化
								WSTR:(K++) = 君たちは魔物を追い払い、無事に川を渡ることが出来た。
								KSTR:(K++) = あれだけ倒せばしばらくここに魔物の群れが戻ってくることはないだろう。
								CALL メッセージ欄表示用関数()
							ENDIF
						ENDIF
					ENDIF
					CALL 口上変数初期化
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					GOTO LOOP_MESSAGE
			ENDSELECT

		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_11_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
		ENDIF
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "12_1")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4) == 0
				CALL 知識技能所持者検索("調合知識", 1)
				IF RESULT > -1
					WSTR:(K++) = %CALLNAME:RESULT%は、ここに生えているキノコが爆発物の原料になることに気づいた。
					WSTR:(K++) = 簡単な調合をすれば魔物相手に使えるアイテムになる。少し採取していこう。
					WSTR:(K++) = 手投げ爆弾を３個手に入れた！
					SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
					CALL アイテム増減汎用処理("手投げ爆弾", 3)
				ELSE
					KSTR:(K++) = 淡く光るキノコが生えている。
				ENDIF
				CALL メッセージ欄表示用関数(,,,0)
			ELSE
				KSTR:(K++) = これ以上キノコを採取すると乱獲になる。そっとしておこう。
				CALL メッセージ欄表示用関数(,,,0)
			ENDIF
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 川に沿って下流へ進んでいくと、魔物の姿がない浅瀬に出た。
			WSTR:(K++) = 周囲には淡く光るキノコが生えており、幻想的な風景を作り出している。
			CALL 知識技能所持者検索("調合知識", 1)
			IF RESULT > -1
				WSTR:(K++) = %CALLNAME:RESULT%は、そのキノコが爆発物の原料になることに気づいた。
				KSTR:(K++) = 簡単な調合をすれば魔物相手に使えるアイテムになる。少し採取していこう。_PAGE
				KSTR:(K++) = 手投げ爆弾を３個手に入れた！
				SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
				CALL アイテム増減汎用処理("手投げ爆弾", 3)
			ELSE
				KSTR:(K++) = 他は特に変わった様子はないようだ。先に進もう。
			ENDIF
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:12:1, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_12_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 12
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_1")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "13_2")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 敵を探しますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:0:エネミー名 = Lv4_ジェリー
					敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
					敵BATTLE_STATE_STR:4:エネミー名 = Lv4_ジェリー
					CALL 雑魚敵遭遇汎用処理
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					GOTO LOOP_MESSAGE
			ENDSELECT
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟は奥に進むにつれ、じめじめと湿気が増してきている。
			WSTR:(K++) = 同時に、湿気を好む魔物がうろついている姿も増えてきた。
			KSTR:(K++) = 退路をふさがれても面倒だ。ここで倒してしまおう。
			CALL メッセージ欄表示用関数()

			敵BATTLE_STATE_STR:0:エネミー名 = Lv4_ジェリー
			敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
			敵BATTLE_STATE_STR:4:エネミー名 = Lv4_ジェリー
			CALL 雑魚敵遭遇汎用処理

			SETBIT ダンジョン構造配列_人食い鳥の島:13:1, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:13:2, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_13_1(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 1

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		IF ダンジョン内一時変数:0 == 0
			ダンジョンマス画像URL_重ね表示 = えっちハート
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF ダンジョン内一時変数:0
		ELSE
			CALL ダンジョンハプニング_スカート捲れ()
			IF RESULT
				ダンジョン内一時変数:0 = 1
			ENDIF
			CALL 口上変数初期化
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_13_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 13
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "14_0")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 洞窟の隅に砕けた骨が落ちている。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟の隅に砕けた骨が落ちている。
			WSTR:(K++) = 何の骨かはわからないが、人食い鳥の犠牲になった魔物か人間のどちらかだろう。
			KSTR:(K++) = 君たちは短く犠牲者の冥福を祈り、先に進む。
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:14:0, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_14_0(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 14
マス分岐 = 0

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4)
			KSTR:(K++) = もう人食い鳥はどこかへと去っていった後だ。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟の奥には、天井が高く開けた部屋があった。
			WSTR:(K++) = その部屋には大きな鳥の巣が幾つも並んでおり、人食い鳥が何羽も屯している。
			KSTR:(K++) = 巣を駆除するには鳥たちとの連戦になるだろう。準備はいいだろうか。_PAGE
			KSTR:(K++) = 魔物の群れと戦いますか？（２連戦）
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:1:エネミー名 = Lv4_人食い鳥
					敵BATTLE_STATE_STR:2:エネミー名 = Lv4_人食い鳥
					敵BATTLE_STATE_STR:4:エネミー名 = Lv4_人食い鳥
					CALL 雑魚敵遭遇汎用処理
					IF RESULT == 0
						敵BATTLE_STATE_STR:1:エネミー名 = Lv4_人食い鳥
						敵BATTLE_STATE_STR:3:エネミー名 = Lv4_人食い鳥
						敵BATTLE_STATE_STR:5:エネミー名 = Lv4_人食い鳥
						敵BATTLE_STATE_STR:7:エネミー名 = Lv4_人食い鳥
						CALL 雑魚敵遭遇汎用処理
						IF RESULT == 0
							SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
							残り巣の数_人食い鳥の島 -= 1
							CALL 口上変数初期化
							WSTR:(K++) = 君たちは人食い鳥を倒し、巣を破壊した。
							WSTR:(K++) = 危険を知った人食い鳥たちはもうこの場所に戻ってくることはないだろう。
							KSTR:(K++) = 残りの巣の数：{残り巣の数_人食い鳥の島}つ
							CALL メッセージ欄表示用関数()
						ENDIF
					ENDIF
					CALL 口上変数初期化
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					GOTO LOOP_MESSAGE
			ENDSELECT
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_9_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 9
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		ダンジョンマス画像URL_重ね表示 = エネミーアイコン
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "10_3")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 敵を探しますか？
			KSTR:(K++) = BUTTON_[はい]
			KSTR:(K++) = BUTTON_[いいえ]
			CALL メッセージ欄表示用関数(,,,0)
			$LOOP_MESSAGE
			INPUTS
			SELECTCASE RESULTS
				CASE "[はい]"
					敵BATTLE_STATE_STR:0:エネミー名 = Lv4_水のエレメンタル
					敵BATTLE_STATE_STR:1:エネミー名 = Lv4_水のエレメンタル
					敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
					CALL 雑魚敵遭遇汎用処理
				CASE "[いいえ]"
					CALL 口上変数初期化
				CASEELSE
					CLEARLINE 1
					GOTO LOOP_MESSAGE
			ENDSELECT
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 洞窟の中を進むうち、水音と共に何かが近づいてくる気配がする……！
			KSTR:(K++) = 精霊型のエネミーだ！　それらは侵入者である君たちへと襲い掛かってくる！
			CALL メッセージ欄表示用関数()

			敵BATTLE_STATE_STR:0:エネミー名 = Lv4_水のエレメンタル
			敵BATTLE_STATE_STR:1:エネミー名 = Lv4_水のエレメンタル
			敵BATTLE_STATE_STR:3:エネミー名 = Lv4_水のエレメンタル
			CALL 雑魚敵遭遇汎用処理
			
			SETBIT ダンジョン構造配列_人食い鳥の島:10:3, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_10_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 10
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_4")
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "11_5")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 道は滑らかに整えられ、人工的な通路になっている。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 精霊の群れがいた先の道は滑らかに整えられ、明らかに人工的な通路になっていた。
			WSTR:(K++) = この島は記録上、５０年以上は無人島のはずだが……。
			KSTR:(K++) = 過去の採掘路か何かだろうか？
			CALL メッセージ欄表示用関数()
			
			SETBIT ダンジョン構造配列_人食い鳥の島:11:4, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:11:5, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_11_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 巨大な門が開く気配はない。※門の先は未実装です
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 通路を進んでいった先には、宗教的装飾が施された巨大な門が鎮座していた。
			WSTR:(K++) = 取っ手や鍵穴などは見当たらず、押しても引いても開く気配はない。
			KSTR:(K++) = 今はこの先を探索する方法はないだろう……。※門の先は未実装です
			CALL メッセージ欄表示用関数()
			
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_11_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 11
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_洞窟
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4) == 0
			ダンジョンマス画像URL_重ね表示 = 会話アイコン
		ENDIF
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4)
			KSTR:(K++) = 宝石は外されている。もう何もない。
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 道の突き当りには不思議な輝きを放つ宝石が壁に埋め込まれていた。
			CALL 知識技能所持者検索("錬金知識", 1)
			IF RESULT > -1
				WSTR:(K++) = %CALLNAME:RESULT%は、その宝石が魔物を操る力を持っていることに気づく。
				WSTR:(K++) = この洞窟にいる水のエレメンタルたちは宝石に引き寄せられて集まったのだろう。
				WSTR:(K++) = これを使えば、魔物を手懐けることが出来るかもしれない……。（※未実装です）
				KSTR:(K++) = %CALLNAME:PLAYER%は宝石を持ち帰り、研究してみることにした。_PAGE
				KSTR:(K++) = %CALLNAME:PLAYER%は魔物使いの宝石・ランクEを手に入れた！
				ITEM:魔物使いの宝石・ランクE = 1
				SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 4
			ELSE
				WSTR:(K++) = お宝のように思えるが、こういった宝石に迂闊に触るのは危険だ。
				WSTR:(K++) = 少なくとも、どんな力を秘めているかわからないと近づくべきではないだろう。
				KSTR:(K++) = 錬金術の知識があれば解析出来そうだが……。
			ENDIF
			CALL メッセージ欄表示用関数()
		ENDIF
		CALL 画面再描画
ENDSELECT

;---------------------------------------------------------------------------
;真ん中ルート（巣一個＋ボス巣）
;砂漠
;---------------------------------------------------------------------------

@ダンジョンマス情報_人食い鳥の島_2_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "4_2")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:4:2, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_4_2(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 2

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_3")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 
			WSTR:(K++) = 
			WSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:6:3, 1
		ENDIF
		CALL 画面再描画
ENDSELECT


@ダンジョンマス情報_人食い鳥の島_6_3(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 6
マス分岐 = 3

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
		ダンジョンマス画像URL_重ね表示 = 右アイコン
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 君たちは荒野を東へと進む。
			WSTR:(K++) = 進むたびに岩は少なくなり、地面は更に乾燥し、粒が小さくなっていく。
			KSTR:(K++) = 丘を一つ越える頃には、周囲の地形は砂漠へと様変わりしていた。_PAGE
			WSTR:(K++) = 君たちの真上を人食い鳥が悠々と飛んでいく。
			KSTR:(K++) = 砂漠のどこかに巣があるのだろう。すぐに見つかればいいのだが……
			CALL メッセージ欄表示用関数()

			SETBIT ダンジョン構造配列_人食い鳥の島:16:3, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:16:3, 2
			SETBIT ダンジョン構造配列_人食い鳥の島:17:2, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:17:3, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:17:4, 1
		ENDIF
		ダンジョンマス画像URL_伏せ状態 = 壁_砂漠
		ダンジョン現在位置:0 = 16
		ダンジョン現在位置:1 = 3
		CALL 画面再描画
ENDSELECT

;---------------------------------------------------------------------------
;下ルート（巣２個）
;雨季で雨メイン
;---------------------------------------------------------------------------

@ダンジョンマス情報_人食い鳥の島_2_4(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 2
マス分岐 = 4

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "3_5")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:3:5, 1
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_人食い鳥の島_3_5(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 3
マス分岐 = 5

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
		CALL ダンジョン分岐線描画(@"{マス深度}_{マス分岐}", "6_7")
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:4:7, 1
		ENDIF
		CALL 画面再描画
ENDSELECT

@ダンジョンマス情報_人食い鳥の島_4_7(ARGS)
#DIM マス深度
#DIM マス分岐
マス深度 = 4
マス分岐 = 7

SELECTCASE ARGS
	CASE "マス画像"
		ダンジョンマス画像URL = 床_荒野
	CASE "接続先"
	CASE "マスイベント"
		CALL 口上変数初期化
		IF GETBIT(ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2)
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数(,,,0)
		ELSE
			;最初に訪れた時
			SETBIT ダンジョン構造配列_人食い鳥の島:マス深度:マス分岐, 2
			WSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			WSTR:(K++) = 
			KSTR:(K++) = 
			CALL メッセージ欄表示用関数()
			SETBIT ダンジョン構造配列_人食い鳥の島:24:7, 1
			SETBIT ダンジョン構造配列_人食い鳥の島:24:7, 2
			SETBIT ダンジョン構造配列_人食い鳥の島:25:2, 1
		ENDIF
		ダンジョン現在位置:0 = 24
		ダンジョン現在位置:1 = 7
		CALL 画面再描画
ENDSELECT
