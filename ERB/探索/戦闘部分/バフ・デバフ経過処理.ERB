@バフターン経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM バフ番号
#DIM 持続ターン保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF バフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF バフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"バフデータベース_{隊列番号}")
FOR バフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続ターン保存 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "持続ターン")
	IF 持続ターン保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続ターン保存 > 1
		DT_CELL_SET @"バフデータベース_{隊列番号}", バフ番号, "持続ターン", 持続ターン保存 - 1
	ENDIF
NEXT

FOR バフ番号, 0, 消滅配列番号
	CALL バフ削除(隊列番号, 消滅番号保存:バフ番号, 1)
NEXT

@デバフターン経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM デバフ番号
#DIM 持続ターン保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF デバフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF デバフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"デバフデータベース_{隊列番号}")
FOR デバフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続ターン保存 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "持続ターン")
	IF 持続ターン保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続ターン保存 > 1
		DT_CELL_SET @"デバフデータベース_{隊列番号}", デバフ番号, "持続ターン", 持続ターン保存 - 1
	ENDIF
NEXT

FOR デバフ番号, 0, 消滅配列番号
	CALL デバフ削除(隊列番号, 消滅番号保存:デバフ番号, 1)
NEXT

@バフ回数経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM バフ番号
#DIM 持続回数保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF バフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF バフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"バフデータベース_{隊列番号}")
FOR バフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続回数保存 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "持続回数")
	IF 持続回数保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続回数保存 > 1
		DT_CELL_SET @"バフデータベース_{隊列番号}", バフ番号, "持続回数", 持続回数保存 - 1
	ENDIF
NEXT

FOR バフ番号, 0, 消滅配列番号
	CALL バフ削除(隊列番号, 消滅番号保存:バフ番号, 1)
NEXT

@デバフ回数経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM デバフ番号
#DIM 持続回数保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF デバフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF デバフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"デバフデータベース_{隊列番号}")
FOR デバフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続回数保存 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "持続回数")
	IF 持続回数保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続回数保存 > 1
		DT_CELL_SET @"デバフデータベース_{隊列番号}", デバフ番号, "持続回数", 持続回数保存 - 1
	ENDIF
NEXT

FOR デバフ番号, 0, 消滅配列番号
	CALL デバフ削除(隊列番号, 消滅番号保存:デバフ番号, 1)
NEXT

@バフ行動回数経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM バフ番号
#DIM 持続行動回数保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF バフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF バフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"バフデータベース_{隊列番号}")
FOR バフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"バフデータベース_{隊列番号}", バフ番号, "バフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続行動回数保存 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "持続行動回数")
	IF 持続行動回数保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続行動回数保存 > 1
		DT_CELL_SET @"バフデータベース_{隊列番号}", バフ番号, "持続行動回数", 持続行動回数保存 - 1
	ENDIF
NEXT

FOR バフ番号, 0, 消滅配列番号
	CALL バフ削除(隊列番号, 消滅番号保存:バフ番号, 1)
NEXT

@デバフ行動回数経過処理(隊列番号, 経過能力 = "", 経過枠 = "")
#DIM 隊列番号
#DIMS 経過枠
#DIMS 経過能力
#DIM データベース行数
#DIM デバフ番号
#DIM 持続行動回数保存
#DIM 消滅配列番号
#DIM 消滅番号保存, 100

IF 経過能力 != ""
	SIF デバフ存在チェック(経過能力, 隊列番号) == -1
		RETURN 0
ENDIF
IF 経過枠 != ""
	SIF デバフ存在チェック_枠(経過枠, 隊列番号) == -1
		RETURN 0
ENDIF

VARSET 消滅番号保存
消滅配列番号 = 0
データベース行数 = DT_ROW_LENGTH(@"デバフデータベース_{隊列番号}")
FOR デバフ番号, 0, データベース行数
	IF 経過能力 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ対象能力") != 経過能力
			CONTINUE
	ENDIF
	IF 経過枠 != ""
		SIF DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ枠") != 経過枠
			CONTINUE
	ENDIF
	持続行動回数保存 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "持続行動回数")
	IF 持続行動回数保存 == 1
		;ここで削除しちゃうと行がズレるので一旦配列に退避
		消滅番号保存:消滅配列番号 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "id")
		消滅配列番号 += 1
	ELSEIF 持続行動回数保存 > 1
		DT_CELL_SET @"デバフデータベース_{隊列番号}", デバフ番号, "持続行動回数", 持続行動回数保存 - 1
	ENDIF
NEXT

FOR デバフ番号, 0, 消滅配列番号
	CALL デバフ削除(隊列番号, 消滅番号保存:デバフ番号, 1)
NEXT


@バフ削除(隊列番号, バフ番号, ID削除フラグ = 0)
#DIM 隊列番号
#DIM バフ番号
#DIM 消滅ID保存
#DIM ID削除フラグ

SIF バフ番号 < 0
	RETURN 0

IF ID削除フラグ
	消滅ID保存 = バフ番号
ELSE
	消滅ID保存 = DT_CELL_GET(@"バフデータベース_{隊列番号}", バフ番号, "id")
ENDIF

TRYCALLFORM バフ消滅時処理_%DT_CELL_GETS(@"バフデータベース_{隊列番号}", 消滅ID保存, "バフ枠", 1)%
DT_ROW_REMOVE @"バフデータベース_{隊列番号}", 消滅ID保存

@デバフ削除(隊列番号, デバフ番号, ID削除フラグ = 0)
#DIM 隊列番号
#DIM デバフ番号
#DIM 消滅ID保存
#DIM ID削除フラグ

SIF デバフ番号 < 0
	RETURN 0

IF ID削除フラグ
	消滅ID保存 = デバフ番号
ELSE
	消滅ID保存 = DT_CELL_GET(@"デバフデータベース_{隊列番号}", デバフ番号, "id")
ENDIF

TRYCALLFORM デバフ消滅時処理_%DT_CELL_GETS(@"デバフデータベース_{隊列番号}", デバフ番号, "デバフ枠", 1)%
DT_ROW_REMOVE @"デバフデータベース_{隊列番号}", 消滅ID保存

