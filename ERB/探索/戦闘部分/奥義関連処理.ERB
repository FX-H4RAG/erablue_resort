
@奥義名呼び出し(ARG)
TSTR:コマンド名受渡 = 
TRYCCALLFORM 固有奥義_{NO:ARG}("奥義名", ARG)
CATCH
	TRYCCALLFORM 奥義名補正_%DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "奥義名補正", 1), 26, LEFT%
	CATCH
		TRYCALLFORM 汎用奥義_%得意武器数値文字列変換(基礎BATTLE_STATE:ARG:得意武器)%("奥義名", ARG)
	ENDCATCH
ENDCATCH

@奥義威力呼び出し(ARG, バフ無しフラグ = 0)
#DIM 奥義威力計算値
#DIM バフ無しフラグ
#DIMS 文字列分割, 2

TRYCCALLFORM 固有奥義_{NO:ARG}("奥義説明文", ARG)
	奥義威力計算値 = RESULT
CATCH
	TRYCCALLFORM 汎用奥義_%得意武器数値文字列変換(基礎BATTLE_STATE:ARG:得意武器)%("奥義説明文", ARG)
		奥義威力計算値 = RESULT
	CATCH
		RETURN 0
	ENDCATCH
ENDCATCH
SIF 奥義威力計算値 == 0
	RETURN 0

;指輪補正部分
IF 装備ステータス補正保存:ARG:装備耳飾り番号 > 0
	;一旦受け渡し変数を退避
	LOCALS = %詳細文文字列受け渡し変数%
	;効果文章を呼び出してから必要ない部分をカット
	CALLFORM 耳飾り基礎効果文章表示_%DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "耳飾り名", 1)%(装備ステータス補正保存:ARG:装備耳飾り番号)
	SPLIT 詳細文文字列受け渡し変数, "【奥義補正】<br>", 文字列分割
	詳細文文字列受け渡し変数 = %LOCALS%<br>【指輪補正】　%文字列分割:1%

	RESULT = 0
	IF STRCOUNT(DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "奥義補正", 1), "奥義威力")
		CALLFORM 奥義威力_効果量_%DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "耳飾り名", 1)%
		奥義威力計算値 += RESULT
	ENDIF
ENDIF

IF バフ無しフラグ
	RESULT = 0
ELSE
	CALL バフ・デバフ測定(隊列算出_味方(ARG), "奥義ダメージ補正_割合")
ENDIF

奥義威力計算値 = 奥義威力計算値 * (RESULT + 100) / 100
IF 奥義威力計算値 > 0 && バフ無しフラグ == 0
	CALL バフ・デバフ測定(隊列算出_味方(ARG), "奥義ダメージ補正_固定値")
	奥義威力計算値 = 奥義威力計算値 + RESULT
ENDIF
RETURN 奥義威力計算値

@奥義前効果呼び出し(ARG)
VARSET LOCALS

;奥義の対象保存
アビテンプレート用_対象保存_一時退避用:0 = アビテンプレート用_対象保存:0

;一旦数値をリセットしてから奥義前部分を呼び出す
CALL アビ汎用変数文字列リセット
TRYCCALLFORM 固有奥義_{NO:ARG}("奥義前効果", ARG)
CATCH
	TRYCALLFORM 汎用奥義_%得意武器数値文字列変換(基礎BATTLE_STATE:ARG:得意武器)%("奥義前効果", ARG)
ENDCATCH

;対象を戻す
VARSET アビテンプレート用_対象保存, -1
アビテンプレート用_対象保存:0 = アビテンプレート用_対象保存_一時退避用:0

@奥義追加効果呼び出し(ARG)
VARSET LOCALS

;一旦数値をリセットしてから、文字列表示用に奥義名部分を呼び出す
CALL アビ汎用変数文字列リセット
CALL 奥義名呼び出し(ARG)
アビテンプレート用_アビ名 = 奥義：%TSTR:コマンド名受渡%

TRYCCALLFORM 固有奥義_{NO:ARG}("奥義追加効果", ARG)
	SIF RESULT == -1
		RETURN -1
CATCH
	TRYCCALLFORM 汎用奥義_%得意武器数値文字列変換(基礎BATTLE_STATE:ARG:得意武器)%("奥義追加効果", ARG)
		SIF RESULT == -1
			RETURN -1
	CATCH
	ENDCATCH
ENDCATCH
SPLIT DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "奥義補正", 1), "_", LOCALS
FOR LOCAL, 0, 10
	SIF LOCALS:LOCAL == ""
		BREAK
	SIF LOCALS:LOCAL == "奥義威力"
		CONTINUE
	CALL アビ汎用変数文字列リセット
	TRYCALLFORM 奥義補正処理関数_%LOCALS:LOCAL%_%DT_CELL_GETS("所持耳飾りデータベース", 装備ステータス補正保存:ARG:装備耳飾り番号, "耳飾り名", 1)%
NEXT


@汎用奥義_剣(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = ワイドブレード
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_短剣(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = ファストスライサー
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_槍(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = トゥルースラスト
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_斧(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = パワースウィング
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_杖(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = バニッシュ
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_銃(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = スリーバースト
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_格闘(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = 正拳突き
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_弓(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = ストレートショット
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_楽器(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = ペインメロディ
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT

@汎用奥義_刀(ARGS, キャラ番号)
#DIM キャラ番号

SELECTCASE ARGS
	CASE "奥義名"
		TSTR:コマンド名受渡 = 一文字斬り
	CASE "奥義説明文"
		詳細文文字列受け渡し変数 = 奥義威力：300％<br>敵単体に自属性の［攻撃力✕300％］ダメージを与える。
		RETURN 300
	CASE "奥義前効果"
		;NOOP
	CASE "奥義追加効果"
		;NOOP
ENDSELECT
