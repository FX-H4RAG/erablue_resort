@衣装関数_ナイトの服(処理モード)
#DIMS 処理モード
LOCALS = 

SELECTCASE 処理モード
	CASE "衣装種別"
		衣装関連文字列受け渡し = 通常衣装
	CASE "フレーバー"
		LOCALS += "守りを重視した全身鎧の服。<br>"
		LOCALS += "味方を守り、相手の隙を付く技に長けている。<br>"
		LOCALS += "金属鎧を全身に纏うので脱ぎ着はとても大変。<br>"
		詳細文文字列受け渡し変数 = %LOCALS%
ENDSELECT


@CLOTHES_CHANGE_ナイトの服(対象キャラ)
#DIM 対象キャラ

;一個前の服装を保持
SIF CSTR:対象キャラ:着せ替え服 != "ナイトの服"
	CSTR:対象キャラ:脱ぐ前の服 = %CSTR:対象キャラ:着せ替え服%

CSTR:対象キャラ:着せ替え服 = ナイトの服
CSTR:対象キャラ:着せ替え服追加名 = 
TEQUIP:対象キャラ:上半身鎧あり = 1
TEQUIP:対象キャラ:上半身服あり = 1
TEQUIP:対象キャラ:脇出し = 0
TEQUIP:対象キャラ:へそ出し = 0
TEQUIP:対象キャラ:はだけ可 = 0
TEQUIP:対象キャラ:手差し込み可 = 0
TEQUIP:対象キャラ:パイズリ可 = 0
TEQUIP:対象キャラ:上タイツあり = 0
TEQUIP:対象キャラ:上半身下着あり = 1
TEQUIP:対象キャラ:上半身下着抜き取り可 = 0
TEQUIP:対象キャラ:下腹部後鎧あり = 1
TEQUIP:対象キャラ:下腹部前鎧あり = 1
TEQUIP:対象キャラ:下半身服あり = 1
TEQUIP:対象キャラ:スカートめくり可 = 0
TEQUIP:対象キャラ:ずらし可 = 0
TEQUIP:対象キャラ:下タイツあり = 0
TEQUIP:対象キャラ:下半身下着あり = 1
TEQUIP:対象キャラ:下半身下着抜き取り可 = 0
TEQUIP:対象キャラ:上下一体服 = 0
TEQUIP:対象キャラ:上下一体タイツ = 0
TEQUIP:対象キャラ:上タイツ破れ = 0
TEQUIP:対象キャラ:下タイツ破れ = 0

@衣装アビ関数_ナイトの服_1(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM 消費ＭＰ = 45
LOCALS = 

SELECTCASE 処理モード
	CASE "アビ名"
		TSTR:コマンド名受渡 = ファランクス
	CASE "アビ説明文"
		LOCALS += "■ファランクス<br>"
		LOCALS += @"　消費MP：{消費ＭＰ}<br>"
		LOCALS += "　効果：味方全体にダメージカット［50%/1回］を付与する"
		詳細文文字列受け渡し変数 = %LOCALS%
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用変数:効果割合 = 50
		アビ汎用文字列:バフ・デバフ枠 = ダメージカット
		アビ汎用文字列:バフ・デバフ対象能力 = ダメージ増減
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT

@衣装アビ関数_ナイトの服_2(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM 消費ＭＰ = 20
LOCALS = 

SELECTCASE 処理モード
	CASE "アビ名"
		IF 基礎BATTLE_STATE:対象キャラ:得意武器 == 得意武器文字列数値変換("剣")
			TSTR:コマンド名受渡 = ドライブバースト
		ELSEIF 基礎BATTLE_STATE:対象キャラ:ステータスタイプ保存 == タイプ文字列数値変換("バランス")
			TSTR:コマンド名受渡 = ドライブバースト
		ENDIF
	CASE "アビ説明文"
		LOCALS += "■ドライブバースト（装備者が剣得意orバランスタイプの時）<br>"
		LOCALS += @"　消費MP：{消費ＭＰ}<br>"
		LOCALS += "　効果：敵横列に攻撃力の100%自属性ダメージを与える。<br>"
		LOCALS += "　　　　対象のチャージターン１つにつき30%威力が上昇する。"
		詳細文文字列受け渡し変数 = %LOCALS%
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		;本来「CALL アビ対象選択テンプレート_敵横列」を使うべきだが、相手によって威力が変動するため
		;手動で処理を行う
		SIF アビテンプレート用_キャンセルフラグ
			RETURN -1
		アビ汎用変数:効果割合 = 100 + (敵BATTLE_STATE:(アビテンプレート用_対象保存:0 - 10):チャージターン * 30)
		CALL アビテンプレート_ダメージ処理_自属性
		IF アビテンプレート用_対象保存:0 % 2
			アビテンプレート用_対象保存:0 -= 1
		ELSE
			アビテンプレート用_対象保存:0 += 1
		ENDIF
		IF 敵BATTLE_STATE:(アビテンプレート用_対象保存:0 - 10):ＨＰ > 0
			アビ汎用変数:効果割合 = 100 + (敵BATTLE_STATE:(アビテンプレート用_対象保存:0 - 10):チャージターン * 30)
			CALL アビテンプレート_ダメージ処理_自属性
		ENDIF
ENDSELECT

@衣装アビ関数_ナイトの服_3(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM 消費ＭＰ = 20
LOCALS = 

SELECTCASE 処理モード
	CASE "アビ名"
		IF 基礎BATTLE_STATE:対象キャラ:得意武器 == 得意武器文字列数値変換("槍")
			TSTR:コマンド名受渡 = かばう
		ELSEIF 基礎BATTLE_STATE:対象キャラ:ステータスタイプ保存 == タイプ文字列数値変換("防御")
			TSTR:コマンド名受渡 = かばう
		ENDIF
	CASE "アビ説明文"
		LOCALS += "■かばう（装備者が槍得意or防御タイプの時）<br>"
		LOCALS += @"　消費MP：{消費ＭＰ}<br>"
		LOCALS += "　効果：次の行動時まで、自身が全ての単体攻撃を受け持つ"
		詳細文文字列受け渡し変数 = %LOCALS%
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_自己のみ
		;1にするとかばう使った直後に消えてしまうので2で設定
		アビ汎用変数:持続行動回数 = 2
		アビ汎用文字列:バフ・デバフ枠 = 単体かばう
		アビ汎用文字列:バフ・デバフ対象能力 = 単体かばう
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT
