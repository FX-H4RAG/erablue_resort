@証関数_ナイトの証(処理モード)
#DIMS 処理モード

SELECTCASE 処理モード
	CASE "ジョブ証種別"
		証関連文字列受け渡し = 通常ジョブ
	CASE "証名"
		TSTR:コマンド名受渡 = ナイトの証
	CASE "フレーバー"
		詳細文文字列受け渡し変数 '= "守りを重視したタンク向けの証。<br>"
		詳細文文字列受け渡し変数 += "味方を守り、相手の隙を付く技に長けている。<br>"
		詳細文文字列受け渡し変数 += "人気は低いが重要な立ち回りが出来る。<br>"
ENDSELECT

;ランダム抽選では出現しない（入手法：ダンジョン「人食い鳥の島」のイベントで入手）
;@証出現率_ナイトの証(入手タイプ, 装備ランク)

@証アビ関数_ナイトの証_1(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM LEVEL
#DIM CONST 消費ＭＰ = 45
LEVEL = GET_JOBSKILL_LEVEL(対象キャラ)

SELECTCASE 処理モード
	CASE "アビ名"
		TSTR:コマンド名受渡 = ファランクス
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 '= "■ファランクス<br>"
		詳細文文字列受け渡し変数 += @"　消費ＭＰ：{消費ＭＰ}<br>"
		詳細文文字列受け渡し変数 += "　効果：味方全体に1回のダメージカット［50%］効果を与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_味方全体_生者のみ
		アビ汎用変数:効果割合 = 50
		アビ汎用文字列:バフ・デバフ枠 = ダメージカット
		アビ汎用文字列:バフ・デバフ対象能力 = 被ダメージ
		アビ汎用変数:持続回数 = 1
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT

@証アビ関数_ナイトの証_2(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM LEVEL
#DIM 攻撃対象
#DIM CONST 消費ＭＰ = 20
LEVEL = GET_JOBSKILL_LEVEL(対象キャラ)

SELECTCASE 処理モード
	CASE "アビ名"
		IF 得意武器判定(対象キャラ, "剣")
			TSTR:コマンド名受渡 = ドライブバースト
		ELSEIF 基礎BATTLE_STATE:対象キャラ:ステータスタイプ保存 == タイプ文字列数値変換("バランス")
			TSTR:コマンド名受渡 = ドライブバースト
		ENDIF
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 '= "■ドライブバースト（装備者が剣得意orバランスタイプの時）<br>"
		詳細文文字列受け渡し変数 += @"　消費ＭＰ：{消費ＭＰ}<br>"
		詳細文文字列受け渡し変数 += "　効果：敵横列に自属性の［攻撃力✕100％］ダメージを与える。<br>"
		詳細文文字列受け渡し変数 += "　　　　対象のチャージターン1つにつき威力が30％上昇する。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		アビ汎用文字列:選択時メッセージ１ = どの横列に使用しますか？
		CALL アビ対象選択テンプレート_敵単体
		;本来「CALL アビ対象選択テンプレート_敵横列」を使うべきだが、相手によって威力が変動するため
		;手動で処理を行う
		SIF アビテンプレート用_キャンセルフラグ
			RETURN -1
		攻撃対象 = アビテンプレート用_対象保存:0
		アビ汎用変数:効果割合 = 100 + (敵BATTLE_STATE:(攻撃対象 - 10):チャージターン * 30)
		CALL アビテンプレート_ダメージ処理_自属性
		IF 攻撃対象 % 2
			攻撃対象 -= 1
		ELSE
			攻撃対象 += 1
		ENDIF
		IF 敵BATTLE_STATE_STR:(攻撃対象 - 10):エネミー名 != "" && 敵BATTLE_STATE:(攻撃対象 - 10):ＨＰ > 0
			CALL アビ対象選択テンプレート_指定(攻撃対象)
			アビ汎用変数:効果割合 = 100 + (敵BATTLE_STATE:(攻撃対象 - 10):チャージターン * 30)
			CALL アビテンプレート_ダメージ処理_自属性
		ENDIF
ENDSELECT

@証アビ関数_ナイトの証_3(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM LEVEL
#DIM CONST 消費ＭＰ = 20
LEVEL = GET_JOBSKILL_LEVEL(対象キャラ)

SELECTCASE 処理モード
	CASE "アビ名"
		IF 得意武器判定(対象キャラ, "槍")
			TSTR:コマンド名受渡 = かばう
		ELSEIF 基礎BATTLE_STATE:対象キャラ:ステータスタイプ保存 == タイプ文字列数値変換("防御")
			TSTR:コマンド名受渡 = かばう
		ENDIF
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 '= "■かばう（装備者が槍得意or防御タイプの時）<br>"
		詳細文文字列受け渡し変数 += @"　消費ＭＰ：{消費ＭＰ}<br>"
		詳細文文字列受け渡し変数 += "　効果：自身に次の行動時まで、全ての単体攻撃を味方に代わって受ける効果を与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_自己のみ
		;1にするとかばう使った直後に消えてしまうので2で設定
		アビ汎用変数:持続行動回数 = 2
		アビ汎用文字列:バフ・デバフ枠 = 単体かばう
		アビ汎用文字列:バフ・デバフ対象能力 = 単体かばう
		CALL アビテンプレート_有利効果_バフ効果セット
ENDSELECT

@証アビ関数_ナイトの証_4(処理モード, 対象キャラ)
#DIM 対象キャラ
#DIMS 処理モード
#DIM CONST 消費ＭＰ = 0

SELECTCASE 処理モード
	CASE "アビ名"
		TSTR:コマンド名受渡 = シールドバッシュ
	CASE "アビ説明文"
		詳細文文字列受け渡し変数 '= "■シールドバッシュ<br>"
		詳細文文字列受け渡し変数 += @"　消費ＭＰ：{消費ＭＰ}<br>"
		詳細文文字列受け渡し変数 += "　効果：敵単体に自属性の［防御力✕100％］ダメージを与える。"
		RETURN 消費ＭＰ
	CASE "アビ効果"
		CALL アビ対象選択テンプレート_敵単体
		アビ汎用変数:効果割合 = 100
		アビ汎用文字列:攻撃側使用能力値 = 防御力
		CALL アビテンプレート_ダメージ処理_自属性
ENDSELECT
