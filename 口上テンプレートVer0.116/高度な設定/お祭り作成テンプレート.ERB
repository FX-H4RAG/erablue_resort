
;--------------------------------------------------
;お祭り開催時に選べるお祭りのテンプレート
;--------------------------------------------------
;・使い方
;「YYYY」をお祭りの名前に置換し、それぞれの関数に処理を入れる
;--------------------------------------------------

@MOVE_ROUTINE_FESTIVAL_YYYY(対象キャラ, ARGS)
#DIM 対象キャラ
#DIM 時間計算
#DIM CONST 開催費用 = ;＊＊＊＊＊＊＊＊ここを編集＊＊＊＊＊＊＊＊

SELECTCASE ARGS
	CASE "お祭り説明"
		LOCALS = <div rect='2125,500,3762,2812'>
		LOCALS += "■YYYY<br>"
		LOCALS += "<br>"
		LOCALS += ;＊＊＊＊＊＊＊＊ここを編集＊＊＊＊＊＊＊＊
		LOCALS += "<br>"
		IF 10000 > MONEY
			LOCALS += @"ルピが不足しています。（必要ルピ：%NUM_FORMAT(開催費用)%）<br>"
		ELSE
			LOCALS += @"<button value='0'>[0] このお祭りを企画する（必要ルピ：%NUM_FORMAT(開催費用)%）</button><br>"
		ENDIF
		LOCALS += "</div>"
		HTML_PRINT LOCALS, 1
	CASE "出現条件"
		;既に予定に入ってたらアウト
		SIF 開催予定祭り名 == "FESTIVAL_YYYY"
			RETURN 0
		; 季節限定の構文
		; SIF DAY % 120 / 30 != 1
		; 	RETURN 0
		RETURN 1
	CASE "参加判定"
		;参加キャラの条件を記載する
		;全員参加ならこのまま
		RETURN 1
	CASE "特設マップ"
		;存在しない場合はこのまま
		;作りたい場合は処理が激増するのでこのテンプレートにはまとめない
		RETURN 0
	CASE "起床時刻"
		;特別に行動ルーチンを設定しないのなら削除
		;設定する場合は時間を記載
		時間計算 = 480 - (TALENT:対象キャラ:早起き * 30)
		RETURN 時間計算
	CASE "就寝時刻"
		;特別に行動ルーチンを設定しないのなら削除
		;設定する場合は時間を記載
		時間計算 = 1320 - (TALENT:対象キャラ:早寝 * 60)
		RETURN 時間計算
	CASE "初期位置"
		;特別に行動ルーチンを設定しないのなら削除
		;設定する場合は場所を記載
		CFLAG:対象キャラ:現在位置 = 6
		CFLAG:対象キャラ:現在マップ種別 = 0
	CASE "移動処理"
		;特別に行動ルーチンを設定しないのなら削除
		;設定する場合はこのままで良い
		CALL MOVE_ROUTINE_移動処理(対象キャラ, "FESTIVAL_YYYY")
	CASE "お祭り補正条件"
		;下の「お祭り補正内容」を適用するキャラの条件
		;基本的に参加判定と一致
		RETURN 1
	CASE "お祭り補正内容"
		;ソースの発生時に呼ばれる
		;好感度要素や快楽リソースなどに影響
		NOWEX:対象キャラ:友情度上昇格納 = MAX(NOWEX:対象キャラ:友情度上昇格納 * 13 / 10, 0)
	CASE "服装変更"
		;参加したキャラの服装を変える場合に記載
		RSTR:服装名受け渡し = ;＊＊＊＊＊＊＊＊ここを編集＊＊＊＊＊＊＊＊
ENDSELECT


@ROUTINE_PLAN_FESTIVAL_YYYY(対象キャラ, マップ種別取得フラグ = 0)
#DIM マップ種別取得フラグ
#DIM 対象キャラ

;時間ごとにどの場所にいるべきかを決定
;既存のルーチンプランを参考に決めると良い
;ERB/リゾートマップ/キャラ移動ルーチン/汎用移動ルーチン.ERB
SELECTCASE TIME + TCVAR:対象キャラ:行動時間ゆらぎ
	;19時半まではお祭りにいる
	CASE IS < 1170
		SIF マップ種別取得フラグ
			RETURN 0
		RETURN 2
	;風呂の前後１５分は脱衣所
	CASE IS < 1185
		RETURN 脱衣所場所算出(対象キャラ, マップ種別取得フラグ)
	;21時までは風呂にいる
	CASE IS < 1260
		RETURN 風呂場算出(対象キャラ, マップ種別取得フラグ)
	;風呂の前後１５分は脱衣所
	CASE IS < 1275
		RETURN 脱衣所場所算出(対象キャラ, マップ種別取得フラグ)
	;着替え後１５分はロビーに居る
	CASE IS < 1290
		SIF マップ種別取得フラグ
			RETURN 0
		RETURN 2
	;寝るまでは自室にいる
	CASEELSE
		SIF マップ種別取得フラグ
			RETURN 999
		RETURN 999
ENDSELECT

